(()=>{"use strict";var e,t,s,r,i={907:(e,t,s)=>{s.r(t),s.d(t,{Headers:()=>o,Request:()=>a,Response:()=>l,default:()=>n,fetch:()=>i});var r=function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==s.g)return s.g;throw new Error("unable to locate global object")}();const i=r.fetch,n=r.fetch.bind(r),o=r.Headers,a=r.Request,l=r.Response},660:function(e,t,s){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=r(s(907)),n=r(s(818));t.default=class{constructor(e){this.shouldThrowOnError=!1,this.method=e.method,this.url=e.url,this.headers=e.headers,this.schema=e.schema,this.body=e.body,this.shouldThrowOnError=e.shouldThrowOnError,this.signal=e.signal,this.isMaybeSingle=e.isMaybeSingle,e.fetch?this.fetch=e.fetch:"undefined"==typeof fetch?this.fetch=i.default:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(e,t){return this.headers=Object.assign({},this.headers),this.headers[e]=t,this}then(e,t){void 0===this.schema||(["GET","HEAD"].includes(this.method)?this.headers["Accept-Profile"]=this.schema:this.headers["Content-Profile"]=this.schema),"GET"!==this.method&&"HEAD"!==this.method&&(this.headers["Content-Type"]="application/json");let s=(0,this.fetch)(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then((async e=>{var t,s,r;let i=null,o=null,a=null,l=e.status,c=e.statusText;if(e.ok){if("HEAD"!==this.method){const t=await e.text();""===t||(o="text/csv"===this.headers.Accept||this.headers.Accept&&this.headers.Accept.includes("application/vnd.pgrst.plan+text")?t:JSON.parse(t))}const r=null===(t=this.headers.Prefer)||void 0===t?void 0:t.match(/count=(exact|planned|estimated)/),n=null===(s=e.headers.get("content-range"))||void 0===s?void 0:s.split("/");r&&n&&n.length>1&&(a=parseInt(n[1])),this.isMaybeSingle&&"GET"===this.method&&Array.isArray(o)&&(o.length>1?(i={code:"PGRST116",details:`Results contain ${o.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},o=null,a=null,l=406,c="Not Acceptable"):o=1===o.length?o[0]:null)}else{const t=await e.text();try{i=JSON.parse(t),Array.isArray(i)&&404===e.status&&(o=[],i=null,l=200,c="OK")}catch(s){404===e.status&&""===t?(l=204,c="No Content"):i={message:t}}if(i&&this.isMaybeSingle&&(null===(r=null==i?void 0:i.details)||void 0===r?void 0:r.includes("0 rows"))&&(i=null,l=200,c="OK"),i&&this.shouldThrowOnError)throw new n.default(i)}return{error:i,data:o,count:a,status:l,statusText:c}}));return this.shouldThrowOnError||(s=s.catch((e=>{var t,s,r;return{error:{message:`${null!==(t=null==e?void 0:e.name)&&void 0!==t?t:"FetchError"}: ${null==e?void 0:e.message}`,details:`${null!==(s=null==e?void 0:e.stack)&&void 0!==s?s:""}`,hint:"",code:`${null!==(r=null==e?void 0:e.code)&&void 0!==r?r:""}`},data:null,count:null,status:0,statusText:""}}))),s.then(e,t)}}},961:function(e,t,s){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=r(s(45)),n=r(s(825)),o=s(530);class a{constructor(e,{headers:t={},schema:s,fetch:r}={}){this.url=e,this.headers=Object.assign(Object.assign({},o.DEFAULT_HEADERS),t),this.schemaName=s,this.fetch=r}from(e){const t=new URL(`${this.url}/${e}`);return new i.default(t,{headers:Object.assign({},this.headers),schema:this.schemaName,fetch:this.fetch})}schema(e){return new a(this.url,{headers:this.headers,schema:e,fetch:this.fetch})}rpc(e,t={},{head:s=!1,get:r=!1,count:i}={}){let o;const a=new URL(`${this.url}/rpc/${e}`);let l;s||r?(o=s?"HEAD":"GET",Object.entries(t).filter((([e,t])=>void 0!==t)).map((([e,t])=>[e,Array.isArray(t)?`{${t.join(",")}}`:`${t}`])).forEach((([e,t])=>{a.searchParams.append(e,t)}))):(o="POST",l=t);const c=Object.assign({},this.headers);return i&&(c.Prefer=`count=${i}`),new n.default({method:o,url:a,headers:c,schema:this.schemaName,body:l,fetch:this.fetch,allowEmpty:!1})}}t.default=a},818:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0});class s extends Error{constructor(e){super(e.message),this.name="PostgrestError",this.details=e.details,this.hint=e.hint,this.code=e.code}}t.default=s},825:function(e,t,s){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=r(s(261));class n extends i.default{eq(e,t){return this.url.searchParams.append(e,`eq.${t}`),this}neq(e,t){return this.url.searchParams.append(e,`neq.${t}`),this}gt(e,t){return this.url.searchParams.append(e,`gt.${t}`),this}gte(e,t){return this.url.searchParams.append(e,`gte.${t}`),this}lt(e,t){return this.url.searchParams.append(e,`lt.${t}`),this}lte(e,t){return this.url.searchParams.append(e,`lte.${t}`),this}like(e,t){return this.url.searchParams.append(e,`like.${t}`),this}likeAllOf(e,t){return this.url.searchParams.append(e,`like(all).{${t.join(",")}}`),this}likeAnyOf(e,t){return this.url.searchParams.append(e,`like(any).{${t.join(",")}}`),this}ilike(e,t){return this.url.searchParams.append(e,`ilike.${t}`),this}ilikeAllOf(e,t){return this.url.searchParams.append(e,`ilike(all).{${t.join(",")}}`),this}ilikeAnyOf(e,t){return this.url.searchParams.append(e,`ilike(any).{${t.join(",")}}`),this}is(e,t){return this.url.searchParams.append(e,`is.${t}`),this}in(e,t){const s=Array.from(new Set(t)).map((e=>"string"==typeof e&&new RegExp("[,()]").test(e)?`"${e}"`:`${e}`)).join(",");return this.url.searchParams.append(e,`in.(${s})`),this}contains(e,t){return"string"==typeof t?this.url.searchParams.append(e,`cs.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cs.{${t.join(",")}}`):this.url.searchParams.append(e,`cs.${JSON.stringify(t)}`),this}containedBy(e,t){return"string"==typeof t?this.url.searchParams.append(e,`cd.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cd.{${t.join(",")}}`):this.url.searchParams.append(e,`cd.${JSON.stringify(t)}`),this}rangeGt(e,t){return this.url.searchParams.append(e,`sr.${t}`),this}rangeGte(e,t){return this.url.searchParams.append(e,`nxl.${t}`),this}rangeLt(e,t){return this.url.searchParams.append(e,`sl.${t}`),this}rangeLte(e,t){return this.url.searchParams.append(e,`nxr.${t}`),this}rangeAdjacent(e,t){return this.url.searchParams.append(e,`adj.${t}`),this}overlaps(e,t){return"string"==typeof t?this.url.searchParams.append(e,`ov.${t}`):this.url.searchParams.append(e,`ov.{${t.join(",")}}`),this}textSearch(e,t,{config:s,type:r}={}){let i="";"plain"===r?i="pl":"phrase"===r?i="ph":"websearch"===r&&(i="w");const n=void 0===s?"":`(${s})`;return this.url.searchParams.append(e,`${i}fts${n}.${t}`),this}match(e){return Object.entries(e).forEach((([e,t])=>{this.url.searchParams.append(e,`eq.${t}`)})),this}not(e,t,s){return this.url.searchParams.append(e,`not.${t}.${s}`),this}or(e,{foreignTable:t,referencedTable:s=t}={}){const r=s?`${s}.or`:"or";return this.url.searchParams.append(r,`(${e})`),this}filter(e,t,s){return this.url.searchParams.append(e,`${t}.${s}`),this}}t.default=n},45:function(e,t,s){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=r(s(825));t.default=class{constructor(e,{headers:t={},schema:s,fetch:r}){this.url=e,this.headers=t,this.schema=s,this.fetch=r}select(e,{head:t=!1,count:s}={}){const r=t?"HEAD":"GET";let n=!1;const o=(null!=e?e:"*").split("").map((e=>/\s/.test(e)&&!n?"":('"'===e&&(n=!n),e))).join("");return this.url.searchParams.set("select",o),s&&(this.headers.Prefer=`count=${s}`),new i.default({method:r,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}insert(e,{count:t,defaultToNull:s=!0}={}){const r=[];if(this.headers.Prefer&&r.push(this.headers.Prefer),t&&r.push(`count=${t}`),s||r.push("missing=default"),this.headers.Prefer=r.join(","),Array.isArray(e)){const t=e.reduce(((e,t)=>e.concat(Object.keys(t))),[]);if(t.length>0){const e=[...new Set(t)].map((e=>`"${e}"`));this.url.searchParams.set("columns",e.join(","))}}return new i.default({method:"POST",url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}upsert(e,{onConflict:t,ignoreDuplicates:s=!1,count:r,defaultToNull:n=!0}={}){const o=[`resolution=${s?"ignore":"merge"}-duplicates`];if(void 0!==t&&this.url.searchParams.set("on_conflict",t),this.headers.Prefer&&o.push(this.headers.Prefer),r&&o.push(`count=${r}`),n||o.push("missing=default"),this.headers.Prefer=o.join(","),Array.isArray(e)){const t=e.reduce(((e,t)=>e.concat(Object.keys(t))),[]);if(t.length>0){const e=[...new Set(t)].map((e=>`"${e}"`));this.url.searchParams.set("columns",e.join(","))}}return new i.default({method:"POST",url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}update(e,{count:t}={}){const s=[];return this.headers.Prefer&&s.push(this.headers.Prefer),t&&s.push(`count=${t}`),this.headers.Prefer=s.join(","),new i.default({method:"PATCH",url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}delete({count:e}={}){const t=[];return e&&t.push(`count=${e}`),this.headers.Prefer&&t.unshift(this.headers.Prefer),this.headers.Prefer=t.join(","),new i.default({method:"DELETE",url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}}},261:function(e,t,s){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=r(s(660));class n extends i.default{select(e){let t=!1;const s=(null!=e?e:"*").split("").map((e=>/\s/.test(e)&&!t?"":('"'===e&&(t=!t),e))).join("");return this.url.searchParams.set("select",s),this.headers.Prefer&&(this.headers.Prefer+=","),this.headers.Prefer+="return=representation",this}order(e,{ascending:t=!0,nullsFirst:s,foreignTable:r,referencedTable:i=r}={}){const n=i?`${i}.order`:"order",o=this.url.searchParams.get(n);return this.url.searchParams.set(n,`${o?`${o},`:""}${e}.${t?"asc":"desc"}${void 0===s?"":s?".nullsfirst":".nullslast"}`),this}limit(e,{foreignTable:t,referencedTable:s=t}={}){const r=void 0===s?"limit":`${s}.limit`;return this.url.searchParams.set(r,`${e}`),this}range(e,t,{foreignTable:s,referencedTable:r=s}={}){const i=void 0===r?"offset":`${r}.offset`,n=void 0===r?"limit":`${r}.limit`;return this.url.searchParams.set(i,`${e}`),this.url.searchParams.set(n,""+(t-e+1)),this}abortSignal(e){return this.signal=e,this}single(){return this.headers.Accept="application/vnd.pgrst.object+json",this}maybeSingle(){return"GET"===this.method?this.headers.Accept="application/json":this.headers.Accept="application/vnd.pgrst.object+json",this.isMaybeSingle=!0,this}csv(){return this.headers.Accept="text/csv",this}geojson(){return this.headers.Accept="application/geo+json",this}explain({analyze:e=!1,verbose:t=!1,settings:s=!1,buffers:r=!1,wal:i=!1,format:n="text"}={}){var o;const a=[e?"analyze":null,t?"verbose":null,s?"settings":null,r?"buffers":null,i?"wal":null].filter(Boolean).join("|"),l=null!==(o=this.headers.Accept)&&void 0!==o?o:"application/json";return this.headers.Accept=`application/vnd.pgrst.plan+${n}; for="${l}"; options=${a};`,this}rollback(){var e;return(null!==(e=this.headers.Prefer)&&void 0!==e?e:"").trim().length>0?this.headers.Prefer+=",tx=rollback":this.headers.Prefer="tx=rollback",this}returns(){return this}}t.default=n},530:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DEFAULT_HEADERS=void 0;const r=s(519);t.DEFAULT_HEADERS={"X-Client-Info":`postgrest-js/${r.version}`}},279:function(e,t,s){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.PostgrestError=t.PostgrestBuilder=t.PostgrestTransformBuilder=t.PostgrestFilterBuilder=t.PostgrestQueryBuilder=t.PostgrestClient=void 0;const i=r(s(961));t.PostgrestClient=i.default;const n=r(s(45));t.PostgrestQueryBuilder=n.default;const o=r(s(825));t.PostgrestFilterBuilder=o.default;const a=r(s(261));t.PostgrestTransformBuilder=a.default;const l=r(s(660));t.PostgrestBuilder=l.default;const c=r(s(818));t.PostgrestError=c.default,t.default={PostgrestClient:i.default,PostgrestQueryBuilder:n.default,PostgrestFilterBuilder:o.default,PostgrestTransformBuilder:a.default,PostgrestBuilder:l.default,PostgrestError:c.default}},519:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.version=void 0,t.version="0.0.0-automated"}},n={};function o(e){var t=n[e];if(void 0!==t)return t.exports;var s=n[e]={exports:{}};return i[e].call(s.exports,s,s.exports,o),s.exports}o.m=i,o.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return o.d(t,{a:t}),t},t=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__,o.t=function(s,r){if(1&r&&(s=this(s)),8&r)return s;if("object"==typeof s&&s){if(4&r&&s.__esModule)return s;if(16&r&&"function"==typeof s.then)return s}var i=Object.create(null);o.r(i);var n={};e=e||[null,t({}),t([]),t(t)];for(var a=2&r&&s;"object"==typeof a&&!~e.indexOf(a);a=t(a))Object.getOwnPropertyNames(a).forEach((e=>n[e]=()=>s[e]));return n.default=()=>s,o.d(i,n),i},o.d=(e,t)=>{for(var s in t)o.o(t,s)&&!o.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})},o.f={},o.e=e=>Promise.all(Object.keys(o.f).reduce(((t,s)=>(o.f[s](e,t),t)),[])),o.u=e=>e+".js?ver=f69e9628a1c8f95846fb",o.miniCssF=e=>{},o.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),o.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),s={},r="ollie-pro:",o.l=(e,t,i,n)=>{if(s[e])s[e].push(t);else{var a,l;if(void 0!==i)for(var c=document.getElementsByTagName("script"),h=0;h<c.length;h++){var d=c[h];if(d.getAttribute("src")==e||d.getAttribute("data-webpack")==r+i){a=d;break}}a||(l=!0,(a=document.createElement("script")).charset="utf-8",a.timeout=120,o.nc&&a.setAttribute("nonce",o.nc),a.setAttribute("data-webpack",r+i),a.src=e),s[e]=[t];var u=(t,r)=>{a.onerror=a.onload=null,clearTimeout(p);var i=s[e];if(delete s[e],a.parentNode&&a.parentNode.removeChild(a),i&&i.forEach((e=>e(r))),t)return t(r)},p=setTimeout(u.bind(null,void 0,{type:"timeout",target:a}),12e4);a.onerror=u.bind(null,a.onerror),a.onload=u.bind(null,a.onload),l&&document.head.appendChild(a)}},o.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e;o.g.importScripts&&(e=o.g.location+"");var t=o.g.document;if(!e&&t&&(t.currentScript&&"SCRIPT"===t.currentScript.tagName.toUpperCase()&&(e=t.currentScript.src),!e)){var s=t.getElementsByTagName("script");if(s.length)for(var r=s.length-1;r>-1&&(!e||!/^http(s?):/.test(e));)e=s[r--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),o.p=e+"../"})(),(()=>{var e={502:0};o.f.j=(t,s)=>{var r=o.o(e,t)?e[t]:void 0;if(0!==r)if(r)s.push(r[2]);else{var i=new Promise(((s,i)=>r=e[t]=[s,i]));s.push(r[2]=i);var n=o.p+o.u(t),a=new Error;o.l(n,(s=>{if(o.o(e,t)&&(0!==(r=e[t])&&(e[t]=void 0),r)){var i=s&&("load"===s.type?"missing":s.type),n=s&&s.target&&s.target.src;a.message="Loading chunk "+t+" failed.\n("+i+": "+n+")",a.name="ChunkLoadError",a.type=i,a.request=n,r[1](a)}}),"chunk-"+t,t)}};var t=(t,s)=>{var r,i,[n,a,l]=s,c=0;if(n.some((t=>0!==e[t]))){for(r in a)o.o(a,r)&&(o.m[r]=a[r]);l&&l(o)}for(t&&t(s);c<n.length;c++)i=n[c],o.o(e,i)&&e[i]&&e[i][0](),e[i]=0},s=globalThis.webpackChunkollie_pro=globalThis.webpackChunkollie_pro||[];s.forEach(t.bind(null,0)),s.push=t.bind(null,s.push.bind(s))})();const a=window.wp.blocks,l=JSON.parse('{"UU":"ollie/pattern-block"}'),c=window.wp.primitives,h=window.ReactJSXRuntime,d=(0,h.jsx)(c.SVG,{viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:(0,h.jsx)(c.Path,{fillRule:"evenodd",clipRule:"evenodd",d:"M18.5 5.5V8H20V5.5H22.5V4H20V1.5H18.5V4H16V5.5H18.5ZM13.9624 4H6C4.89543 4 4 4.89543 4 6V18C4 19.1046 4.89543 20 6 20H18C19.1046 20 20 19.1046 20 18V10.0391H18.5V18C18.5 18.2761 18.2761 18.5 18 18.5H10L10 10.4917L16.4589 10.5139L16.4641 9.01389L5.5 8.97618V6C5.5 5.72386 5.72386 5.5 6 5.5H13.9624V4ZM5.5 10.4762V18C5.5 18.2761 5.72386 18.5 6 18.5H8.5L8.5 10.4865L5.5 10.4762Z"})}),u=window.wp.plugins,p=window.wp.data,f=window.wp.keyboardShortcuts,g=window.wp.element;(0,u.getPlugin)("ollie-add-library-shortcut-plugin")||(0,u.registerPlugin)("ollie-add-library-shortcut-plugin",{render:()=>{const e=wp.data.select("core/edit-site"),{registerShortcut:t}=(0,p.useDispatch)("core/keyboard-shortcuts");return void 0===e&&t({name:"ollie-add-library",category:"global",description:"Inserts the Ollie Cloud Library block into the editor.",keyCombination:{modifier:"ctrl",character:"o"}}),(0,f.useShortcut)("ollie-add-library",(0,g.useCallback)((()=>{let e=wp.data.select("core/block-editor").getSelectedBlock(),t=wp.blocks.createBlock("ollie/pattern-block");if(null!==e){if("ollie/pattern-block"===e.name)return;let s=wp.data.select("core/block-editor").getBlockOrder().indexOf(e.clientId)+1;wp.data.dispatch("core/block-editor").insertBlock(t,s)}else wp.data.dispatch("core/block-editor").insertBlock(t)}),[])),null}});const m=window.wp.components,v=window.wp.i18n;(0,u.getPlugin)("ollie-toolbar-library-plugin")||(0,u.registerPlugin)("ollie-toolbar-library-plugin",{render:function(){const e=wp.data.select("core/edit-site"),{insertBlock:t}=(0,p.useDispatch)("core/block-editor"),{getSelectedBlock:s,getBlockInsertionPoint:r}=(0,p.useSelect)("core/block-editor"),{getCurrentPostType:i}=(0,p.useSelect)("core/editor"),n=()=>(0,h.jsx)(h.Fragment,{children:void 0===e&&(0,h.jsx)(m.ToolbarButton,{icon:d,className:"ollie-toolbar-button",label:(0,v.__)("Ollie Pattern Library","ollie-pro"),onClick:()=>{let e=s(),i=r().index,n=wp.blocks.createBlock("ollie/pattern-block");if(null!==e){if("ollie/pattern-block"===e.name)return;t(n,i)}else t(n)}})});return(0,p.subscribe)((()=>{const e=document.querySelector(".edit-post-header-toolbar");if(!e)return null;"post"===i()&&(e.querySelector(".ollie-toolbar-library")||(e=>{const t=document.createElement("div");t.classList.add("ollie-toolbar-library"),e.appendChild(t),(0,g.render)((0,h.jsx)(n,{}),t)})(e))})),null}});const y=window.wp.blockEditor;class w extends Error{constructor(e,t="FunctionsError",s){super(e),this.name=t,this.context=s}}class _ extends w{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class b extends w{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class k extends w{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var x;!function(e){e.Any="any",e.ApNortheast1="ap-northeast-1",e.ApNortheast2="ap-northeast-2",e.ApSouth1="ap-south-1",e.ApSoutheast1="ap-southeast-1",e.ApSoutheast2="ap-southeast-2",e.CaCentral1="ca-central-1",e.EuCentral1="eu-central-1",e.EuWest1="eu-west-1",e.EuWest2="eu-west-2",e.EuWest3="eu-west-3",e.SaEast1="sa-east-1",e.UsEast1="us-east-1",e.UsWest1="us-west-1",e.UsWest2="us-west-2"}(x||(x={}));class j{constructor(e,{headers:t={},customFetch:s,region:r=x.Any}={}){this.url=e,this.headers=t,this.region=r,this.fetch=(e=>{let t;return t=e||("undefined"==typeof fetch?(...e)=>Promise.resolve().then(o.bind(o,907)).then((({default:t})=>t(...e))):fetch),(...e)=>t(...e)})(s)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e,t={}){var s,r,i,n,o;return r=this,i=void 0,o=function*(){try{const{headers:r,method:i,body:n}=t;let o,a={},{region:l}=t;l||(l=this.region),l&&"any"!==l&&(a["x-region"]=l),n&&(r&&!Object.prototype.hasOwnProperty.call(r,"Content-Type")||!r)&&("undefined"!=typeof Blob&&n instanceof Blob||n instanceof ArrayBuffer?(a["Content-Type"]="application/octet-stream",o=n):"string"==typeof n?(a["Content-Type"]="text/plain",o=n):"undefined"!=typeof FormData&&n instanceof FormData?o=n:(a["Content-Type"]="application/json",o=JSON.stringify(n)));const c=yield this.fetch(`${this.url}/${e}`,{method:i||"POST",headers:Object.assign(Object.assign(Object.assign({},a),this.headers),r),body:o}).catch((e=>{throw new _(e)})),h=c.headers.get("x-relay-error");if(h&&"true"===h)throw new b(c);if(!c.ok)throw new k(c);let d,u=(null!==(s=c.headers.get("Content-Type"))&&void 0!==s?s:"text/plain").split(";")[0].trim();return d="application/json"===u?yield c.json():"application/octet-stream"===u?yield c.blob():"text/event-stream"===u?c:"multipart/form-data"===u?yield c.formData():yield c.text(),{data:d,error:null}}catch(e){return{data:null,error:e}}},new((n=void 0)||(n=Promise))((function(e,t){function s(e){try{l(o.next(e))}catch(e){t(e)}}function a(e){try{l(o.throw(e))}catch(e){t(e)}}function l(t){var r;t.done?e(t.value):(r=t.value,r instanceof n?r:new n((function(e){e(r)}))).then(s,a)}l((o=o.apply(r,i||[])).next())}))}}var C=o(279);const{PostgrestClient:S,PostgrestQueryBuilder:P,PostgrestFilterBuilder:T,PostgrestTransformBuilder:E,PostgrestBuilder:O,PostgrestError:I}=C,$={"X-Client-Info":"realtime-js/2.11.2"};var A,R,L,N,M,F,B;!function(e){e[e.connecting=0]="connecting",e[e.open=1]="open",e[e.closing=2]="closing",e[e.closed=3]="closed"}(A||(A={})),(B=R||(R={})).closed="closed",B.errored="errored",B.joined="joined",B.joining="joining",B.leaving="leaving",function(e){e.close="phx_close",e.error="phx_error",e.join="phx_join",e.reply="phx_reply",e.leave="phx_leave",e.access_token="access_token"}(L||(L={})),function(e){e.websocket="websocket"}(N||(N={})),function(e){e.Connecting="connecting",e.Open="open",e.Closing="closing",e.Closed="closed"}(M||(M={}));class D{constructor(){this.HEADER_LENGTH=1}decode(e,t){return e.constructor===ArrayBuffer?t(this._binaryDecode(e)):t("string"==typeof e?JSON.parse(e):{})}_binaryDecode(e){const t=new DataView(e),s=new TextDecoder;return this._decodeBroadcast(e,t,s)}_decodeBroadcast(e,t,s){const r=t.getUint8(1),i=t.getUint8(2);let n=this.HEADER_LENGTH+2;const o=s.decode(e.slice(n,n+r));n+=r;const a=s.decode(e.slice(n,n+i));return n+=i,{ref:null,topic:o,event:a,payload:JSON.parse(s.decode(e.slice(n,e.byteLength)))}}}class U{constructor(e,t){this.callback=e,this.timerCalc=t,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=t}reset(){this.tries=0,clearTimeout(this.timer)}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout((()=>{this.tries=this.tries+1,this.callback()}),this.timerCalc(this.tries+1))}}!function(e){e.abstime="abstime",e.bool="bool",e.date="date",e.daterange="daterange",e.float4="float4",e.float8="float8",e.int2="int2",e.int4="int4",e.int4range="int4range",e.int8="int8",e.int8range="int8range",e.json="json",e.jsonb="jsonb",e.money="money",e.numeric="numeric",e.oid="oid",e.reltime="reltime",e.text="text",e.time="time",e.timestamp="timestamp",e.timestamptz="timestamptz",e.timetz="timetz",e.tsrange="tsrange",e.tstzrange="tstzrange"}(F||(F={}));const H=(e,t,s={})=>{var r;const i=null!==(r=s.skipTypes)&&void 0!==r?r:[];return Object.keys(t).reduce(((s,r)=>(s[r]=z(r,e,t,i),s)),{})},z=(e,t,s,r)=>{const i=t.find((t=>t.name===e)),n=null==i?void 0:i.type,o=s[e];return n&&!r.includes(n)?V(n,o):q(o)},V=(e,t)=>{if("_"===e.charAt(0)){const s=e.slice(1,e.length);return W(t,s)}switch(e){case F.bool:return J(t);case F.float4:case F.float8:case F.int2:case F.int4:case F.int8:case F.numeric:case F.oid:return G(t);case F.json:case F.jsonb:return K(t);case F.timestamp:return Z(t);case F.abstime:case F.date:case F.daterange:case F.int4range:case F.int8range:case F.money:case F.reltime:case F.text:case F.time:case F.timestamptz:case F.timetz:case F.tsrange:case F.tstzrange:default:return q(t)}},q=e=>e,J=e=>{switch(e){case"t":return!0;case"f":return!1;default:return e}},G=e=>{if("string"==typeof e){const t=parseFloat(e);if(!Number.isNaN(t))return t}return e},K=e=>{if("string"==typeof e)try{return JSON.parse(e)}catch(t){return console.log(`JSON parse error: ${t}`),e}return e},W=(e,t)=>{if("string"!=typeof e)return e;const s=e.length-1,r=e[s];if("{"===e[0]&&"}"===r){let r;const i=e.slice(1,s);try{r=JSON.parse("["+i+"]")}catch(e){r=i?i.split(","):[]}return r.map((e=>V(t,e)))}return e},Z=e=>"string"==typeof e?e.replace(" ","T"):e,Y=e=>{let t=e;return t=t.replace(/^ws/i,"http"),t=t.replace(/(\/socket\/websocket|\/socket|\/websocket)\/?$/i,""),t.replace(/\/+$/,"")};class X{constructor(e,t,s={},r=1e4){this.channel=e,this.event=t,this.payload=s,this.timeout=r,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,t){var s;return this._hasReceived(e)&&t(null===(s=this.receivedResp)||void 0===s?void 0:s.response),this.recHooks.push({status:e,callback:t}),this}startTimeout(){this.timeoutTimer||(this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref),this.channel._on(this.refEvent,{},(e=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=e,this._matchReceive(e)})),this.timeoutTimer=setTimeout((()=>{this.trigger("timeout",{})}),this.timeout))}trigger(e,t){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:t})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:t}){this.recHooks.filter((t=>t.status===e)).forEach((e=>e.callback(t)))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var Q,ee,te,se;!function(e){e.SYNC="sync",e.JOIN="join",e.LEAVE="leave"}(Q||(Q={}));class re{constructor(e,t){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const s=(null==t?void 0:t.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(s.state,{},(e=>{const{onJoin:t,onLeave:s,onSync:r}=this.caller;this.joinRef=this.channel._joinRef(),this.state=re.syncState(this.state,e,t,s),this.pendingDiffs.forEach((e=>{this.state=re.syncDiff(this.state,e,t,s)})),this.pendingDiffs=[],r()})),this.channel._on(s.diff,{},(e=>{const{onJoin:t,onLeave:s,onSync:r}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(e):(this.state=re.syncDiff(this.state,e,t,s),r())})),this.onJoin(((e,t,s)=>{this.channel._trigger("presence",{event:"join",key:e,currentPresences:t,newPresences:s})})),this.onLeave(((e,t,s)=>{this.channel._trigger("presence",{event:"leave",key:e,currentPresences:t,leftPresences:s})})),this.onSync((()=>{this.channel._trigger("presence",{event:"sync"})}))}static syncState(e,t,s,r){const i=this.cloneDeep(e),n=this.transformState(t),o={},a={};return this.map(i,((e,t)=>{n[e]||(a[e]=t)})),this.map(n,((e,t)=>{const s=i[e];if(s){const r=t.map((e=>e.presence_ref)),i=s.map((e=>e.presence_ref)),n=t.filter((e=>i.indexOf(e.presence_ref)<0)),l=s.filter((e=>r.indexOf(e.presence_ref)<0));n.length>0&&(o[e]=n),l.length>0&&(a[e]=l)}else o[e]=t})),this.syncDiff(i,{joins:o,leaves:a},s,r)}static syncDiff(e,t,s,r){const{joins:i,leaves:n}={joins:this.transformState(t.joins),leaves:this.transformState(t.leaves)};return s||(s=()=>{}),r||(r=()=>{}),this.map(i,((t,r)=>{var i;const n=null!==(i=e[t])&&void 0!==i?i:[];if(e[t]=this.cloneDeep(r),n.length>0){const s=e[t].map((e=>e.presence_ref)),r=n.filter((e=>s.indexOf(e.presence_ref)<0));e[t].unshift(...r)}s(t,n,r)})),this.map(n,((t,s)=>{let i=e[t];if(!i)return;const n=s.map((e=>e.presence_ref));i=i.filter((e=>n.indexOf(e.presence_ref)<0)),e[t]=i,r(t,i,s),0===i.length&&delete e[t]})),e}static map(e,t){return Object.getOwnPropertyNames(e).map((s=>t(s,e[s])))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce(((t,s)=>{const r=e[s];return t[s]="metas"in r?r.metas.map((e=>(e.presence_ref=e.phx_ref,delete e.phx_ref,delete e.phx_ref_prev,e))):r,t}),{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}!function(e){e.ALL="*",e.INSERT="INSERT",e.UPDATE="UPDATE",e.DELETE="DELETE"}(ee||(ee={})),function(e){e.BROADCAST="broadcast",e.PRESENCE="presence",e.POSTGRES_CHANGES="postgres_changes",e.SYSTEM="system"}(te||(te={})),function(e){e.SUBSCRIBED="SUBSCRIBED",e.TIMED_OUT="TIMED_OUT",e.CLOSED="CLOSED",e.CHANNEL_ERROR="CHANNEL_ERROR"}(se||(se={}));class ie{constructor(e,t={config:{}},s){this.topic=e,this.params=t,this.socket=s,this.bindings={},this.state=R.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:""},private:!1},t.config),this.timeout=this.socket.timeout,this.joinPush=new X(this,L.join,this.params,this.timeout),this.rejoinTimer=new U((()=>this._rejoinUntilConnected()),this.socket.reconnectAfterMs),this.joinPush.receive("ok",(()=>{this.state=R.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach((e=>e.send())),this.pushBuffer=[]})),this._onClose((()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=R.closed,this.socket._remove(this)})),this._onError((e=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,e),this.state=R.errored,this.rejoinTimer.scheduleTimeout())})),this.joinPush.receive("timeout",(()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=R.errored,this.rejoinTimer.scheduleTimeout())})),this._on(L.reply,{},((e,t)=>{this._trigger(this._replyEventName(t),e)})),this.presence=new re(this),this.broadcastEndpointURL=Y(this.socket.endPoint)+"/api/broadcast",this.private=this.params.config.private||!1}subscribe(e,t=this.timeout){var s,r;if(this.socket.isConnected()||this.socket.connect(),this.joinedOnce)throw"tried to subscribe multiple times. 'subscribe' can only be called a single time per channel instance";{const{config:{broadcast:i,presence:n,private:o}}=this.params;this._onError((t=>null==e?void 0:e(se.CHANNEL_ERROR,t))),this._onClose((()=>null==e?void 0:e(se.CLOSED)));const a={},l={broadcast:i,presence:n,postgres_changes:null!==(r=null===(s=this.bindings.postgres_changes)||void 0===s?void 0:s.map((e=>e.filter)))&&void 0!==r?r:[],private:o};this.socket.accessTokenValue&&(a.access_token=this.socket.accessTokenValue),this.updateJoinPayload(Object.assign({config:l},a)),this.joinedOnce=!0,this._rejoin(t),this.joinPush.receive("ok",(async({postgres_changes:t})=>{var s;if(this.socket.setAuth(),void 0!==t){const r=this.bindings.postgres_changes,i=null!==(s=null==r?void 0:r.length)&&void 0!==s?s:0,n=[];for(let s=0;s<i;s++){const i=r[s],{filter:{event:o,schema:a,table:l,filter:c}}=i,h=t&&t[s];if(!h||h.event!==o||h.schema!==a||h.table!==l||h.filter!==c)return this.unsubscribe(),void(null==e||e(se.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes")));n.push(Object.assign(Object.assign({},i),{id:h.id}))}return this.bindings.postgres_changes=n,void(e&&e(se.SUBSCRIBED))}null==e||e(se.SUBSCRIBED)})).receive("error",(t=>{null==e||e(se.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(t).join(", ")||"error")))})).receive("timeout",(()=>{null==e||e(se.TIMED_OUT)}))}return this}presenceState(){return this.presence.state}async track(e,t={}){return await this.send({type:"presence",event:"track",payload:e},t.timeout||this.timeout)}async untrack(e={}){return await this.send({type:"presence",event:"untrack"},e)}on(e,t,s){return this._on(e,t,s)}async send(e,t={}){var s,r;if(this._canPush()||"broadcast"!==e.type)return new Promise((s=>{var r,i,n;const o=this._push(e.type,e,t.timeout||this.timeout);"broadcast"!==e.type||(null===(n=null===(i=null===(r=this.params)||void 0===r?void 0:r.config)||void 0===i?void 0:i.broadcast)||void 0===n?void 0:n.ack)||s("ok"),o.receive("ok",(()=>s("ok"))),o.receive("error",(()=>s("error"))),o.receive("timeout",(()=>s("timed out")))}));{const{event:i,payload:n}=e,o={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:i,payload:n,private:this.private}]})};try{const e=await this._fetchWithTimeout(this.broadcastEndpointURL,o,null!==(s=t.timeout)&&void 0!==s?s:this.timeout);return await(null===(r=e.body)||void 0===r?void 0:r.cancel()),e.ok?"ok":"error"}catch(e){return"AbortError"===e.name?"timed out":"error"}}}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=R.leaving;const t=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(L.close,"leave",this._joinRef())};return this.rejoinTimer.reset(),this.joinPush.destroy(),new Promise((s=>{const r=new X(this,L.leave,{},e);r.receive("ok",(()=>{t(),s("ok")})).receive("timeout",(()=>{t(),s("timed out")})).receive("error",(()=>{s("error")})),r.send(),this._canPush()||r.trigger("ok",{})}))}async _fetchWithTimeout(e,t,s){const r=new AbortController,i=setTimeout((()=>r.abort()),s),n=await this.socket.fetch(e,Object.assign(Object.assign({},t),{signal:r.signal}));return clearTimeout(i),n}_push(e,t,s=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let r=new X(this,e,t,s);return this._canPush()?r.send():(r.startTimeout(),this.pushBuffer.push(r)),r}_onMessage(e,t,s){return t}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,t,s){var r,i;const n=e.toLocaleLowerCase(),{close:o,error:a,leave:l,join:c}=L;if(s&&[o,a,l,c].indexOf(n)>=0&&s!==this._joinRef())return;let h=this._onMessage(n,t,s);if(t&&!h)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(n)?null===(r=this.bindings.postgres_changes)||void 0===r||r.filter((e=>{var t,s,r;return"*"===(null===(t=e.filter)||void 0===t?void 0:t.event)||(null===(r=null===(s=e.filter)||void 0===s?void 0:s.event)||void 0===r?void 0:r.toLocaleLowerCase())===n})).map((e=>e.callback(h,s))):null===(i=this.bindings[n])||void 0===i||i.filter((e=>{var s,r,i,o,a,l;if(["broadcast","presence","postgres_changes"].includes(n)){if("id"in e){const n=e.id,o=null===(s=e.filter)||void 0===s?void 0:s.event;return n&&(null===(r=t.ids)||void 0===r?void 0:r.includes(n))&&("*"===o||(null==o?void 0:o.toLocaleLowerCase())===(null===(i=t.data)||void 0===i?void 0:i.type.toLocaleLowerCase()))}{const s=null===(a=null===(o=null==e?void 0:e.filter)||void 0===o?void 0:o.event)||void 0===a?void 0:a.toLocaleLowerCase();return"*"===s||s===(null===(l=null==t?void 0:t.event)||void 0===l?void 0:l.toLocaleLowerCase())}}return e.type.toLocaleLowerCase()===n})).map((e=>{if("object"==typeof h&&"ids"in h){const e=h.data,{schema:t,table:s,commit_timestamp:r,type:i,errors:n}=e,o={schema:t,table:s,commit_timestamp:r,eventType:i,new:{},old:{},errors:n};h=Object.assign(Object.assign({},o),this._getPayloadRecords(e))}e.callback(h,s)}))}_isClosed(){return this.state===R.closed}_isJoined(){return this.state===R.joined}_isJoining(){return this.state===R.joining}_isLeaving(){return this.state===R.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,t,s){const r=e.toLocaleLowerCase(),i={type:r,filter:t,callback:s};return this.bindings[r]?this.bindings[r].push(i):this.bindings[r]=[i],this}_off(e,t){const s=e.toLocaleLowerCase();return this.bindings[s]=this.bindings[s].filter((e=>{var r;return!((null===(r=e.type)||void 0===r?void 0:r.toLocaleLowerCase())===s&&ie.isEqual(e.filter,t))})),this}static isEqual(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const s in e)if(e[s]!==t[s])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(L.close,{},e)}_onError(e){this._on(L.error,{},(t=>e(t)))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=R.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const t={new:{},old:{}};return"INSERT"!==e.type&&"UPDATE"!==e.type||(t.new=H(e.columns,e.record)),"UPDATE"!==e.type&&"DELETE"!==e.type||(t.old=H(e.columns,e.old_record)),t}}const ne=()=>{},oe="undefined"!=typeof WebSocket;class ae{constructor(e,t){var s;this.accessTokenValue=null,this.apiKey=null,this.channels=[],this.endPoint="",this.httpEndpoint="",this.headers=$,this.params={},this.timeout=1e4,this.heartbeatIntervalMs=3e4,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.ref=0,this.logger=ne,this.conn=null,this.sendBuffer=[],this.serializer=new D,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._resolveFetch=e=>{let t;return t=e||("undefined"==typeof fetch?(...e)=>Promise.resolve().then(o.bind(o,907)).then((({default:t})=>t(...e))):fetch),(...e)=>t(...e)},this.endPoint=`${e}/${N.websocket}`,this.httpEndpoint=Y(e),(null==t?void 0:t.transport)?this.transport=t.transport:this.transport=null,(null==t?void 0:t.params)&&(this.params=t.params),(null==t?void 0:t.headers)&&(this.headers=Object.assign(Object.assign({},this.headers),t.headers)),(null==t?void 0:t.timeout)&&(this.timeout=t.timeout),(null==t?void 0:t.logger)&&(this.logger=t.logger),(null==t?void 0:t.heartbeatIntervalMs)&&(this.heartbeatIntervalMs=t.heartbeatIntervalMs);const r=null===(s=null==t?void 0:t.params)||void 0===s?void 0:s.apikey;if(r&&(this.accessTokenValue=r,this.apiKey=r),this.reconnectAfterMs=(null==t?void 0:t.reconnectAfterMs)?t.reconnectAfterMs:e=>[1e3,2e3,5e3,1e4][e-1]||1e4,this.encode=(null==t?void 0:t.encode)?t.encode:(e,t)=>t(JSON.stringify(e)),this.decode=(null==t?void 0:t.decode)?t.decode:this.serializer.decode.bind(this.serializer),this.reconnectTimer=new U((async()=>{this.disconnect(),this.connect()}),this.reconnectAfterMs),this.fetch=this._resolveFetch(null==t?void 0:t.fetch),null==t?void 0:t.worker){if("undefined"!=typeof window&&!window.Worker)throw new Error("Web Worker is not supported");this.worker=(null==t?void 0:t.worker)||!1,this.workerUrl=null==t?void 0:t.workerUrl}this.accessToken=(null==t?void 0:t.accessToken)||null}connect(){if(!this.conn)if(this.transport)this.conn=new this.transport(this.endpointURL(),void 0,{headers:this.headers});else{if(oe)return this.conn=new WebSocket(this.endpointURL()),void this.setupConnection();this.conn=new le(this.endpointURL(),void 0,{close:()=>{this.conn=null}}),o.e(591).then(o.t.bind(o,591,23)).then((({default:e})=>{this.conn=new e(this.endpointURL(),void 0,{headers:this.headers}),this.setupConnection()}))}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:"1.0.0"}))}disconnect(e,t){this.conn&&(this.conn.onclose=function(){},e?this.conn.close(e,null!=t?t:""):this.conn.close(),this.conn=null,this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.reset())}getChannels(){return this.channels}async removeChannel(e){const t=await e.unsubscribe();return 0===this.channels.length&&this.disconnect(),t}async removeAllChannels(){const e=await Promise.all(this.channels.map((e=>e.unsubscribe())));return this.disconnect(),e}log(e,t,s){this.logger(e,t,s)}connectionState(){switch(this.conn&&this.conn.readyState){case A.connecting:return M.Connecting;case A.open:return M.Open;case A.closing:return M.Closing;default:return M.Closed}}isConnected(){return this.connectionState()===M.Open}channel(e,t={config:{}}){const s=new ie(`realtime:${e}`,t,this);return this.channels.push(s),s}push(e){const{topic:t,event:s,payload:r,ref:i}=e,n=()=>{this.encode(e,(e=>{var t;null===(t=this.conn)||void 0===t||t.send(e)}))};this.log("push",`${t} ${s} (${i})`,r),this.isConnected()?n():this.sendBuffer.push(n)}async setAuth(e=null){let t=e||this.accessToken&&await this.accessToken()||this.accessTokenValue;if(t){let e=null;try{e=JSON.parse(atob(t.split(".")[1]))}catch(e){}if(e&&e.exp&&!(Math.floor(Date.now()/1e3)-e.exp<0))return this.log("auth",`InvalidJWTToken: Invalid value for JWT claim "exp" with value ${e.exp}`),Promise.reject(`InvalidJWTToken: Invalid value for JWT claim "exp" with value ${e.exp}`);this.accessTokenValue=t,this.channels.forEach((e=>{t&&e.updateJoinPayload({access_token:t}),e.joinedOnce&&e._isJoined()&&e._push(L.access_token,{access_token:t})}))}}async sendHeartbeat(){var e;if(this.isConnected()){if(this.pendingHeartbeatRef)return this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection"),void(null===(e=this.conn)||void 0===e||e.close(1e3,"hearbeat timeout"));this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef}),this.setAuth()}}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach((e=>e())),this.sendBuffer=[])}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let t=this.channels.find((t=>t.topic===e&&(t._isJoined()||t._isJoining())));t&&(this.log("transport",`leaving duplicate topic "${e}"`),t.unsubscribe())}_remove(e){this.channels=this.channels.filter((t=>t._joinRef()!==e._joinRef()))}setupConnection(){this.conn&&(this.conn.binaryType="arraybuffer",this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e))}_onConnMessage(e){this.decode(e.data,(e=>{let{topic:t,event:s,payload:r,ref:i}=e;i&&i===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null),this.log("receive",`${r.status||""} ${t} ${s} ${i&&"("+i+")"||""}`,r),this.channels.filter((e=>e._isMember(t))).forEach((e=>e._trigger(s,r,i))),this.stateChangeCallbacks.message.forEach((t=>t(e)))}))}async _onConnOpen(){if(this.log("transport",`connected to ${this.endpointURL()}`),this.flushSendBuffer(),this.reconnectTimer.reset(),this.worker){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const e=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(e),this.workerRef.onerror=e=>{this.log("worker","worker error",e.message),this.workerRef.terminate()},this.workerRef.onmessage=e=>{"keepAlive"===e.data.event&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}else this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval((()=>this.sendHeartbeat()),this.heartbeatIntervalMs);this.stateChangeCallbacks.open.forEach((e=>e()))}_onConnClose(e){this.log("transport","close",e),this._triggerChanError(),this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.scheduleTimeout(),this.stateChangeCallbacks.close.forEach((t=>t(e)))}_onConnError(e){this.log("transport",e.message),this._triggerChanError(),this.stateChangeCallbacks.error.forEach((t=>t(e)))}_triggerChanError(){this.channels.forEach((e=>e._trigger(L.error)))}_appendParams(e,t){if(0===Object.keys(t).length)return e;const s=e.match(/\?/)?"&":"?";return`${e}${s}${new URLSearchParams(t)}`}_workerObjectUrl(e){let t;if(e)t=e;else{const e=new Blob(['\n  addEventListener("message", (e) => {\n    if (e.data.event === "start") {\n      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);\n    }\n  });'],{type:"application/javascript"});t=URL.createObjectURL(e)}return t}}class le{constructor(e,t,s){this.binaryType="arraybuffer",this.onclose=()=>{},this.onerror=()=>{},this.onmessage=()=>{},this.onopen=()=>{},this.readyState=A.connecting,this.send=()=>{},this.url=null,this.url=e,this.close=s.close}}class ce extends Error{constructor(e){super(e),this.__isStorageError=!0,this.name="StorageError"}}function he(e){return"object"==typeof e&&null!==e&&"__isStorageError"in e}class de extends ce{constructor(e,t){super(e),this.name="StorageApiError",this.status=t}toJSON(){return{name:this.name,message:this.message,status:this.status}}}class ue extends ce{constructor(e,t){super(e),this.name="StorageUnknownError",this.originalError=t}}const pe=e=>{let t;return t=e||("undefined"==typeof fetch?(...e)=>Promise.resolve().then(o.bind(o,907)).then((({default:t})=>t(...e))):fetch),(...e)=>t(...e)},fe=e=>{if(Array.isArray(e))return e.map((e=>fe(e)));if("function"==typeof e||e!==Object(e))return e;const t={};return Object.entries(e).forEach((([e,s])=>{const r=e.replace(/([-_][a-z])/gi,(e=>e.toUpperCase().replace(/[-_]/g,"")));t[r]=fe(s)})),t};var ge=function(e,t,s,r){return new(s||(s=Promise))((function(i,n){function o(e){try{l(r.next(e))}catch(e){n(e)}}function a(e){try{l(r.throw(e))}catch(e){n(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,a)}l((r=r.apply(e,t||[])).next())}))};const me=e=>e.msg||e.message||e.error_description||e.error||JSON.stringify(e),ve=(e,t,s)=>ge(void 0,void 0,void 0,(function*(){const r=yield(i=void 0,n=void 0,a=void 0,l=function*(){return"undefined"==typeof Response?(yield Promise.resolve().then(o.bind(o,907))).Response:Response},new(a||(a=Promise))((function(e,t){function s(e){try{o(l.next(e))}catch(e){t(e)}}function r(e){try{o(l.throw(e))}catch(e){t(e)}}function o(t){var i;t.done?e(t.value):(i=t.value,i instanceof a?i:new a((function(e){e(i)}))).then(s,r)}o((l=l.apply(i,n||[])).next())})));var i,n,a,l;e instanceof r&&!(null==s?void 0:s.noResolveJson)?e.json().then((s=>{t(new de(me(s),e.status||500))})).catch((e=>{t(new ue(me(e),e))})):t(new ue(me(e),e))}));function ye(e,t,s,r,i,n){return ge(this,void 0,void 0,(function*(){return new Promise(((o,a)=>{e(s,((e,t,s,r)=>{const i={method:e,headers:(null==t?void 0:t.headers)||{}};return"GET"===e?i:(i.headers=Object.assign({"Content-Type":"application/json"},null==t?void 0:t.headers),r&&(i.body=JSON.stringify(r)),Object.assign(Object.assign({},i),s))})(t,r,i,n)).then((e=>{if(!e.ok)throw e;return(null==r?void 0:r.noResolveJson)?e:e.json()})).then((e=>o(e))).catch((e=>ve(e,a,r)))}))}))}function we(e,t,s,r){return ge(this,void 0,void 0,(function*(){return ye(e,"GET",t,s,r)}))}function _e(e,t,s,r,i){return ge(this,void 0,void 0,(function*(){return ye(e,"POST",t,r,i,s)}))}function be(e,t,s,r,i){return ge(this,void 0,void 0,(function*(){return ye(e,"DELETE",t,r,i,s)}))}var ke=function(e,t,s,r){return new(s||(s=Promise))((function(i,n){function o(e){try{l(r.next(e))}catch(e){n(e)}}function a(e){try{l(r.throw(e))}catch(e){n(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,a)}l((r=r.apply(e,t||[])).next())}))};const xe={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},je={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class Ce{constructor(e,t={},s,r){this.url=e,this.headers=t,this.bucketId=s,this.fetch=pe(r)}uploadOrUpdate(e,t,s,r){return ke(this,void 0,void 0,(function*(){try{let i;const n=Object.assign(Object.assign({},je),r);let o=Object.assign(Object.assign({},this.headers),"POST"===e&&{"x-upsert":String(n.upsert)});const a=n.metadata;"undefined"!=typeof Blob&&s instanceof Blob?(i=new FormData,i.append("cacheControl",n.cacheControl),a&&i.append("metadata",this.encodeMetadata(a)),i.append("",s)):"undefined"!=typeof FormData&&s instanceof FormData?(i=s,i.append("cacheControl",n.cacheControl),a&&i.append("metadata",this.encodeMetadata(a))):(i=s,o["cache-control"]=`max-age=${n.cacheControl}`,o["content-type"]=n.contentType,a&&(o["x-metadata"]=this.toBase64(this.encodeMetadata(a)))),(null==r?void 0:r.headers)&&(o=Object.assign(Object.assign({},o),r.headers));const l=this._removeEmptyFolders(t),c=this._getFinalPath(l),h=yield this.fetch(`${this.url}/object/${c}`,Object.assign({method:e,body:i,headers:o},(null==n?void 0:n.duplex)?{duplex:n.duplex}:{})),d=yield h.json();return h.ok?{data:{path:l,id:d.Id,fullPath:d.Key},error:null}:{data:null,error:d}}catch(e){if(he(e))return{data:null,error:e};throw e}}))}upload(e,t,s){return ke(this,void 0,void 0,(function*(){return this.uploadOrUpdate("POST",e,t,s)}))}uploadToSignedUrl(e,t,s,r){return ke(this,void 0,void 0,(function*(){const i=this._removeEmptyFolders(e),n=this._getFinalPath(i),o=new URL(this.url+`/object/upload/sign/${n}`);o.searchParams.set("token",t);try{let e;const t=Object.assign({upsert:je.upsert},r),n=Object.assign(Object.assign({},this.headers),{"x-upsert":String(t.upsert)});"undefined"!=typeof Blob&&s instanceof Blob?(e=new FormData,e.append("cacheControl",t.cacheControl),e.append("",s)):"undefined"!=typeof FormData&&s instanceof FormData?(e=s,e.append("cacheControl",t.cacheControl)):(e=s,n["cache-control"]=`max-age=${t.cacheControl}`,n["content-type"]=t.contentType);const a=yield this.fetch(o.toString(),{method:"PUT",body:e,headers:n}),l=yield a.json();return a.ok?{data:{path:i,fullPath:l.Key},error:null}:{data:null,error:l}}catch(e){if(he(e))return{data:null,error:e};throw e}}))}createSignedUploadUrl(e,t){return ke(this,void 0,void 0,(function*(){try{let s=this._getFinalPath(e);const r=Object.assign({},this.headers);(null==t?void 0:t.upsert)&&(r["x-upsert"]="true");const i=yield _e(this.fetch,`${this.url}/object/upload/sign/${s}`,{},{headers:r}),n=new URL(this.url+i.url),o=n.searchParams.get("token");if(!o)throw new ce("No token returned by API");return{data:{signedUrl:n.toString(),path:e,token:o},error:null}}catch(e){if(he(e))return{data:null,error:e};throw e}}))}update(e,t,s){return ke(this,void 0,void 0,(function*(){return this.uploadOrUpdate("PUT",e,t,s)}))}move(e,t,s){return ke(this,void 0,void 0,(function*(){try{return{data:yield _e(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:null==s?void 0:s.destinationBucket},{headers:this.headers}),error:null}}catch(e){if(he(e))return{data:null,error:e};throw e}}))}copy(e,t,s){return ke(this,void 0,void 0,(function*(){try{return{data:{path:(yield _e(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:null==s?void 0:s.destinationBucket},{headers:this.headers})).Key},error:null}}catch(e){if(he(e))return{data:null,error:e};throw e}}))}createSignedUrl(e,t,s){return ke(this,void 0,void 0,(function*(){try{let r=this._getFinalPath(e),i=yield _e(this.fetch,`${this.url}/object/sign/${r}`,Object.assign({expiresIn:t},(null==s?void 0:s.transform)?{transform:s.transform}:{}),{headers:this.headers});const n=(null==s?void 0:s.download)?`&download=${!0===s.download?"":s.download}`:"";return i={signedUrl:encodeURI(`${this.url}${i.signedURL}${n}`)},{data:i,error:null}}catch(e){if(he(e))return{data:null,error:e};throw e}}))}createSignedUrls(e,t,s){return ke(this,void 0,void 0,(function*(){try{const r=yield _e(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:t,paths:e},{headers:this.headers}),i=(null==s?void 0:s.download)?`&download=${!0===s.download?"":s.download}`:"";return{data:r.map((e=>Object.assign(Object.assign({},e),{signedUrl:e.signedURL?encodeURI(`${this.url}${e.signedURL}${i}`):null}))),error:null}}catch(e){if(he(e))return{data:null,error:e};throw e}}))}download(e,t){return ke(this,void 0,void 0,(function*(){const s=void 0!==(null==t?void 0:t.transform)?"render/image/authenticated":"object",r=this.transformOptsToQueryString((null==t?void 0:t.transform)||{}),i=r?`?${r}`:"";try{const t=this._getFinalPath(e),r=yield we(this.fetch,`${this.url}/${s}/${t}${i}`,{headers:this.headers,noResolveJson:!0});return{data:yield r.blob(),error:null}}catch(e){if(he(e))return{data:null,error:e};throw e}}))}info(e){return ke(this,void 0,void 0,(function*(){const t=this._getFinalPath(e);try{const e=yield we(this.fetch,`${this.url}/object/info/${t}`,{headers:this.headers});return{data:fe(e),error:null}}catch(e){if(he(e))return{data:null,error:e};throw e}}))}exists(e){return ke(this,void 0,void 0,(function*(){const t=this._getFinalPath(e);try{return yield function(e,t,s){return ge(this,void 0,void 0,(function*(){return ye(e,"HEAD",t,Object.assign(Object.assign({},s),{noResolveJson:!0}),undefined)}))}(this.fetch,`${this.url}/object/${t}`,{headers:this.headers}),{data:!0,error:null}}catch(e){if(he(e)&&e instanceof ue){const t=e.originalError;if([400,404].includes(null==t?void 0:t.status))return{data:!1,error:e}}throw e}}))}getPublicUrl(e,t){const s=this._getFinalPath(e),r=[],i=(null==t?void 0:t.download)?`download=${!0===t.download?"":t.download}`:"";""!==i&&r.push(i);const n=void 0!==(null==t?void 0:t.transform)?"render/image":"object",o=this.transformOptsToQueryString((null==t?void 0:t.transform)||{});""!==o&&r.push(o);let a=r.join("&");return""!==a&&(a=`?${a}`),{data:{publicUrl:encodeURI(`${this.url}/${n}/public/${s}${a}`)}}}remove(e){return ke(this,void 0,void 0,(function*(){try{return{data:yield be(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:e},{headers:this.headers}),error:null}}catch(e){if(he(e))return{data:null,error:e};throw e}}))}list(e,t,s){return ke(this,void 0,void 0,(function*(){try{const r=Object.assign(Object.assign(Object.assign({},xe),t),{prefix:e||""});return{data:yield _e(this.fetch,`${this.url}/object/list/${this.bucketId}`,r,{headers:this.headers},s),error:null}}catch(e){if(he(e))return{data:null,error:e};throw e}}))}encodeMetadata(e){return JSON.stringify(e)}toBase64(e){return"undefined"!=typeof Buffer?Buffer.from(e).toString("base64"):btoa(e)}_getFinalPath(e){return`${this.bucketId}/${e}`}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){const t=[];return e.width&&t.push(`width=${e.width}`),e.height&&t.push(`height=${e.height}`),e.resize&&t.push(`resize=${e.resize}`),e.format&&t.push(`format=${e.format}`),e.quality&&t.push(`quality=${e.quality}`),t.join("&")}}const Se={"X-Client-Info":"storage-js/2.7.1"};var Pe=function(e,t,s,r){return new(s||(s=Promise))((function(i,n){function o(e){try{l(r.next(e))}catch(e){n(e)}}function a(e){try{l(r.throw(e))}catch(e){n(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,a)}l((r=r.apply(e,t||[])).next())}))};class Te{constructor(e,t={},s){this.url=e,this.headers=Object.assign(Object.assign({},Se),t),this.fetch=pe(s)}listBuckets(){return Pe(this,void 0,void 0,(function*(){try{return{data:yield we(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(e){if(he(e))return{data:null,error:e};throw e}}))}getBucket(e){return Pe(this,void 0,void 0,(function*(){try{return{data:yield we(this.fetch,`${this.url}/bucket/${e}`,{headers:this.headers}),error:null}}catch(e){if(he(e))return{data:null,error:e};throw e}}))}createBucket(e,t={public:!1}){return Pe(this,void 0,void 0,(function*(){try{return{data:yield _e(this.fetch,`${this.url}/bucket`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(e){if(he(e))return{data:null,error:e};throw e}}))}updateBucket(e,t){return Pe(this,void 0,void 0,(function*(){try{const s=yield function(e,t,s,r){return ge(this,void 0,void 0,(function*(){return ye(e,"PUT",t,r,undefined,s)}))}(this.fetch,`${this.url}/bucket/${e}`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers});return{data:s,error:null}}catch(e){if(he(e))return{data:null,error:e};throw e}}))}emptyBucket(e){return Pe(this,void 0,void 0,(function*(){try{return{data:yield _e(this.fetch,`${this.url}/bucket/${e}/empty`,{},{headers:this.headers}),error:null}}catch(e){if(he(e))return{data:null,error:e};throw e}}))}deleteBucket(e){return Pe(this,void 0,void 0,(function*(){try{return{data:yield be(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(e){if(he(e))return{data:null,error:e};throw e}}))}}class Ee extends Te{constructor(e,t={},s){super(e,t,s)}from(e){return new Ce(this.url,this.headers,e,this.fetch)}}let Oe="";Oe="undefined"!=typeof Deno?"deno":"undefined"!=typeof document?"web":"undefined"!=typeof navigator&&"ReactNative"===navigator.product?"react-native":"node";const Ie={headers:{"X-Client-Info":`supabase-js-${Oe}/2.48.0`}},$e={schema:"public"},Ae={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},Re={};var Le=o(907);const Ne=e=>{let t;return t=e||("undefined"==typeof fetch?Le.default:fetch),(...e)=>t(...e)},Me=(e,t,s)=>{const r=Ne(s),i="undefined"==typeof Headers?Le.Headers:Headers;return(s,n)=>{return o=void 0,a=void 0,c=function*(){var o;const a=null!==(o=yield t())&&void 0!==o?o:e;let l=new i(null==n?void 0:n.headers);return l.has("apikey")||l.set("apikey",e),l.has("Authorization")||l.set("Authorization",`Bearer ${a}`),r(s,Object.assign(Object.assign({},n),{headers:l}))},new((l=void 0)||(l=Promise))((function(e,t){function s(e){try{i(c.next(e))}catch(e){t(e)}}function r(e){try{i(c.throw(e))}catch(e){t(e)}}function i(t){var i;t.done?e(t.value):(i=t.value,i instanceof l?i:new l((function(e){e(i)}))).then(s,r)}i((c=c.apply(o,a||[])).next())}));var o,a,l,c}};const Fe="2.67.3",Be={"X-Client-Info":`gotrue-js/${Fe}`},De="X-Supabase-Api-Version",Ue=Date.parse("2024-01-01T00:00:00.0Z"),He="2024-01-01",ze=()=>"undefined"!=typeof window&&"undefined"!=typeof document,Ve={tested:!1,writable:!1},qe=()=>{if(!ze())return!1;try{if("object"!=typeof globalThis.localStorage)return!1}catch(e){return!1}if(Ve.tested)return Ve.writable;const e=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(e,e),globalThis.localStorage.removeItem(e),Ve.tested=!0,Ve.writable=!0}catch(e){Ve.tested=!0,Ve.writable=!1}return Ve.writable},Je=e=>{let t;return t=e||("undefined"==typeof fetch?(...e)=>Promise.resolve().then(o.bind(o,907)).then((({default:t})=>t(...e))):fetch),(...e)=>t(...e)},Ge=async(e,t,s)=>{await e.setItem(t,JSON.stringify(s))},Ke=async(e,t)=>{const s=await e.getItem(t);if(!s)return null;try{return JSON.parse(s)}catch(e){return s}},We=async(e,t)=>{await e.removeItem(t)};class Ze{constructor(){this.promise=new Ze.promiseConstructor(((e,t)=>{this.resolve=e,this.reject=t}))}}function Ye(e){const t=e.split(".");if(3!==t.length)throw new Error("JWT is not valid: not a JWT structure");if(!/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}=?$|[a-z0-9_-]{2}(==)?$)$/i.test(t[1]))throw new Error("JWT is not valid: payload is not in base64url format");const s=t[1];return JSON.parse(function(e){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";let s,r,i,n,o,a,l,c="",h=0;for(e=e.replace("-","+").replace("_","/");h<e.length;)n=t.indexOf(e.charAt(h++)),o=t.indexOf(e.charAt(h++)),a=t.indexOf(e.charAt(h++)),l=t.indexOf(e.charAt(h++)),s=n<<2|o>>4,r=(15&o)<<4|a>>2,i=(3&a)<<6|l,c+=String.fromCharCode(s),64!=a&&0!=r&&(c+=String.fromCharCode(r)),64!=l&&0!=i&&(c+=String.fromCharCode(i));return c}(s))}function Xe(e){return("0"+e.toString(16)).substr(-2)}async function Qe(e,t,s=!1){const r=function(){const e=new Uint32Array(56);if("undefined"==typeof crypto){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",t=e.length;let s="";for(let r=0;r<56;r++)s+=e.charAt(Math.floor(Math.random()*t));return s}return crypto.getRandomValues(e),Array.from(e,Xe).join("")}();let i=r;s&&(i+="/PASSWORD_RECOVERY"),await Ge(e,`${t}-code-verifier`,i);const n=await async function(e){if("undefined"==typeof crypto||void 0===crypto.subtle||"undefined"==typeof TextEncoder)return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),e;const t=await async function(e){const t=(new TextEncoder).encode(e),s=await crypto.subtle.digest("SHA-256",t),r=new Uint8Array(s);return Array.from(r).map((e=>String.fromCharCode(e))).join("")}(e);return btoa(t).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}(r);return[n,r===n?"plain":"s256"]}Ze.promiseConstructor=Promise;const et=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;class tt extends Error{constructor(e,t,s){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=t,this.code=s}}function st(e){return"object"==typeof e&&null!==e&&"__isAuthError"in e}class rt extends tt{constructor(e,t,s){super(e,t,s),this.name="AuthApiError",this.status=t,this.code=s}}class it extends tt{constructor(e,t){super(e),this.name="AuthUnknownError",this.originalError=t}}class nt extends tt{constructor(e,t,s,r){super(e,s,r),this.name=t,this.status=s}}class ot extends nt{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}class at extends nt{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class lt extends nt{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}}class ct extends nt{constructor(e,t=null){super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class ht extends nt{constructor(e,t=null){super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class dt extends nt{constructor(e,t){super(e,"AuthRetryableFetchError",t,void 0)}}function ut(e){return st(e)&&"AuthRetryableFetchError"===e.name}class pt extends nt{constructor(e,t,s){super(e,"AuthWeakPasswordError",t,"weak_password"),this.reasons=s}}const ft=e=>e.msg||e.message||e.error_description||e.error||JSON.stringify(e),gt=[502,503,504];async function mt(e){var t,s;if(!("object"==typeof(s=e)&&null!==s&&"status"in s&&"ok"in s&&"json"in s&&"function"==typeof s.json))throw new dt(ft(e),0);if(gt.includes(e.status))throw new dt(ft(e),e.status);let r,i;try{r=await e.json()}catch(e){throw new it(ft(e),e)}const n=function(e){const t=e.headers.get(De);if(!t)return null;if(!t.match(et))return null;try{return new Date(`${t}T00:00:00.0Z`)}catch(e){return null}}(e);if(n&&n.getTime()>=Ue&&"object"==typeof r&&r&&"string"==typeof r.code?i=r.code:"object"==typeof r&&r&&"string"==typeof r.error_code&&(i=r.error_code),i){if("weak_password"===i)throw new pt(ft(r),e.status,(null===(t=r.weak_password)||void 0===t?void 0:t.reasons)||[]);if("session_not_found"===i)throw new ot}else if("object"==typeof r&&r&&"object"==typeof r.weak_password&&r.weak_password&&Array.isArray(r.weak_password.reasons)&&r.weak_password.reasons.length&&r.weak_password.reasons.reduce(((e,t)=>e&&"string"==typeof t),!0))throw new pt(ft(r),e.status,r.weak_password.reasons);throw new rt(ft(r),e.status||500,i)}async function vt(e,t,s,r){var i;const n=Object.assign({},null==r?void 0:r.headers);n[De]||(n[De]=He),(null==r?void 0:r.jwt)&&(n.Authorization=`Bearer ${r.jwt}`);const o=null!==(i=null==r?void 0:r.query)&&void 0!==i?i:{};(null==r?void 0:r.redirectTo)&&(o.redirect_to=r.redirectTo);const a=Object.keys(o).length?"?"+new URLSearchParams(o).toString():"",l=await async function(e,t,s,r,i,n){const o=((e,t,s,r)=>{const i={method:e,headers:(null==t?void 0:t.headers)||{}};return"GET"===e?i:(i.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},null==t?void 0:t.headers),i.body=JSON.stringify(r),Object.assign(Object.assign({},i),s))})(t,r,{},n);let a;try{a=await e(s,Object.assign({},o))}catch(e){throw console.error(e),new dt(ft(e),0)}if(a.ok||await mt(a),null==r?void 0:r.noResolveJson)return a;try{return await a.json()}catch(e){await mt(e)}}(e,t,s+a,{headers:n,noResolveJson:null==r?void 0:r.noResolveJson},0,null==r?void 0:r.body);return(null==r?void 0:r.xform)?null==r?void 0:r.xform(l):{data:Object.assign({},l),error:null}}function yt(e){var t;let s=null;var r;return function(e){return e.access_token&&e.refresh_token&&e.expires_in}(e)&&(s=Object.assign({},e),e.expires_at||(s.expires_at=(r=e.expires_in,Math.round(Date.now()/1e3)+r))),{data:{session:s,user:null!==(t=e.user)&&void 0!==t?t:e},error:null}}function wt(e){const t=yt(e);return!t.error&&e.weak_password&&"object"==typeof e.weak_password&&Array.isArray(e.weak_password.reasons)&&e.weak_password.reasons.length&&e.weak_password.message&&"string"==typeof e.weak_password.message&&e.weak_password.reasons.reduce(((e,t)=>e&&"string"==typeof t),!0)&&(t.data.weak_password=e.weak_password),t}function _t(e){var t;return{data:{user:null!==(t=e.user)&&void 0!==t?t:e},error:null}}function bt(e){return{data:e,error:null}}function kt(e){const{action_link:t,email_otp:s,hashed_token:r,redirect_to:i,verification_type:n}=e,o=function(e,t){var s={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(s[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(s[r[i]]=e[r[i]])}return s}(e,["action_link","email_otp","hashed_token","redirect_to","verification_type"]);return{data:{properties:{action_link:t,email_otp:s,hashed_token:r,redirect_to:i,verification_type:n},user:Object.assign({},o)},error:null}}function xt(e){return e}class jt{constructor({url:e="",headers:t={},fetch:s}){this.url=e,this.headers=t,this.fetch=Je(s),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)}}async signOut(e,t="global"){try{return await vt(this.fetch,"POST",`${this.url}/logout?scope=${t}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(e){if(st(e))return{data:null,error:e};throw e}}async inviteUserByEmail(e,t={}){try{return await vt(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:t.data},headers:this.headers,redirectTo:t.redirectTo,xform:_t})}catch(e){if(st(e))return{data:{user:null},error:e};throw e}}async generateLink(e){try{const{options:t}=e,s=function(e,t){var s={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(s[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(s[r[i]]=e[r[i]])}return s}(e,["options"]),r=Object.assign(Object.assign({},s),t);return"newEmail"in s&&(r.new_email=null==s?void 0:s.newEmail,delete r.newEmail),await vt(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:r,headers:this.headers,xform:kt,redirectTo:null==t?void 0:t.redirectTo})}catch(e){if(st(e))return{data:{properties:null,user:null},error:e};throw e}}async createUser(e){try{return await vt(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:_t})}catch(e){if(st(e))return{data:{user:null},error:e};throw e}}async listUsers(e){var t,s,r,i,n,o,a;try{const l={nextPage:null,lastPage:0,total:0},c=await vt(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:null!==(s=null===(t=null==e?void 0:e.page)||void 0===t?void 0:t.toString())&&void 0!==s?s:"",per_page:null!==(i=null===(r=null==e?void 0:e.perPage)||void 0===r?void 0:r.toString())&&void 0!==i?i:""},xform:xt});if(c.error)throw c.error;const h=await c.json(),d=null!==(n=c.headers.get("x-total-count"))&&void 0!==n?n:0,u=null!==(a=null===(o=c.headers.get("link"))||void 0===o?void 0:o.split(","))&&void 0!==a?a:[];return u.length>0&&(u.forEach((e=>{const t=parseInt(e.split(";")[0].split("=")[1].substring(0,1)),s=JSON.parse(e.split(";")[1].split("=")[1]);l[`${s}Page`]=t})),l.total=parseInt(d)),{data:Object.assign(Object.assign({},h),l),error:null}}catch(e){if(st(e))return{data:{users:[]},error:e};throw e}}async getUserById(e){try{return await vt(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:_t})}catch(e){if(st(e))return{data:{user:null},error:e};throw e}}async updateUserById(e,t){try{return await vt(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:t,headers:this.headers,xform:_t})}catch(e){if(st(e))return{data:{user:null},error:e};throw e}}async deleteUser(e,t=!1){try{return await vt(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:t},xform:_t})}catch(e){if(st(e))return{data:{user:null},error:e};throw e}}async _listFactors(e){try{const{data:t,error:s}=await vt(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:e=>({data:{factors:e},error:null})});return{data:t,error:s}}catch(e){if(st(e))return{data:null,error:e};throw e}}async _deleteFactor(e){try{return{data:await vt(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(e){if(st(e))return{data:null,error:e};throw e}}}const Ct={getItem:e=>qe()?globalThis.localStorage.getItem(e):null,setItem:(e,t)=>{qe()&&globalThis.localStorage.setItem(e,t)},removeItem:e=>{qe()&&globalThis.localStorage.removeItem(e)}};function St(e={}){return{getItem:t=>e[t]||null,setItem:(t,s)=>{e[t]=s},removeItem:t=>{delete e[t]}}}const Pt=!!(globalThis&&qe()&&globalThis.localStorage&&"true"===globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug"));class Tt extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}class Et extends Tt{}async function Ot(e,t,s){Pt&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",e,t);const r=new globalThis.AbortController;return t>0&&setTimeout((()=>{r.abort(),Pt&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",e)}),t),await Promise.resolve().then((()=>globalThis.navigator.locks.request(e,0===t?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:r.signal},(async r=>{if(!r){if(0===t)throw Pt&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",e),new Et(`Acquiring an exclusive Navigator LockManager lock "${e}" immediately failed`);if(Pt)try{const e=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(e,null,"  "))}catch(e){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",e)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await s()}Pt&&console.log("@supabase/gotrue-js: navigatorLock: acquired",e,r.name);try{return await s()}finally{Pt&&console.log("@supabase/gotrue-js: navigatorLock: released",e,r.name)}}))))}!function(){if("object"!=typeof globalThis)try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch(e){"undefined"!=typeof self&&(self.globalThis=self)}}();const It={url:"http://localhost:9999",storageKey:"supabase.auth.token",autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:Be,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1},$t=3e4;async function At(e,t,s){return await s()}class Rt{constructor(e){var t,s;this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=Rt.nextInstanceID,Rt.nextInstanceID+=1,this.instanceID>0&&ze()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");const r=Object.assign(Object.assign({},It),e);if(this.logDebugMessages=!!r.debug,"function"==typeof r.debug&&(this.logger=r.debug),this.persistSession=r.persistSession,this.storageKey=r.storageKey,this.autoRefreshToken=r.autoRefreshToken,this.admin=new jt({url:r.url,headers:r.headers,fetch:r.fetch}),this.url=r.url,this.headers=r.headers,this.fetch=Je(r.fetch),this.lock=r.lock||At,this.detectSessionInUrl=r.detectSessionInUrl,this.flowType=r.flowType,this.hasCustomAuthorizationHeader=r.hasCustomAuthorizationHeader,r.lock?this.lock=r.lock:ze()&&(null===(t=null===globalThis||void 0===globalThis?void 0:globalThis.navigator)||void 0===t?void 0:t.locks)?this.lock=Ot:this.lock=At,this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this)},this.persistSession?r.storage?this.storage=r.storage:qe()?this.storage=Ct:(this.memoryStorage={},this.storage=St(this.memoryStorage)):(this.memoryStorage={},this.storage=St(this.memoryStorage)),ze()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(e){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",e)}null===(s=this.broadcastChannel)||void 0===s||s.addEventListener("message",(async e=>{this._debug("received broadcast notification from other tab or client",e),await this._notifyAllSubscribers(e.data.event,e.data.session,!1)}))}this.initialize()}_debug(...e){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (${Fe}) ${(new Date).toISOString()}`,...e),this}async initialize(){return this.initializePromise||(this.initializePromise=(async()=>await this._acquireLock(-1,(async()=>await this._initialize())))()),await this.initializePromise}async _initialize(){var e;try{const t=function(e){const t={},s=new URL(e);if(s.hash&&"#"===s.hash[0])try{new URLSearchParams(s.hash.substring(1)).forEach(((e,s)=>{t[s]=e}))}catch(e){}return s.searchParams.forEach(((e,s)=>{t[s]=e})),t}(window.location.href);let s="none";if(this._isImplicitGrantCallback(t)?s="implicit":await this._isPKCECallback(t)&&(s="pkce"),ze()&&this.detectSessionInUrl&&"none"!==s){const{data:r,error:i}=await this._getSessionFromURL(t,s);if(i){if(this._debug("#_initialize()","error detecting session from URL",i),function(e){return st(e)&&"AuthImplicitGrantRedirectError"===e.name}(i)){const t=null===(e=i.details)||void 0===e?void 0:e.code;if("identity_already_exists"===t||"identity_not_found"===t||"single_identity_not_deletable"===t)return{error:i}}return await this._removeSession(),{error:i}}const{session:n,redirectType:o}=r;return this._debug("#_initialize()","detected session in URL",n,"redirect type",o),await this._saveSession(n),setTimeout((async()=>{"recovery"===o?await this._notifyAllSubscribers("PASSWORD_RECOVERY",n):await this._notifyAllSubscribers("SIGNED_IN",n)}),0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(e){return st(e)?{error:e}:{error:new it("Unexpected error during initialization",e)}}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(e){var t,s,r;try{const i=await vt(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:null!==(s=null===(t=null==e?void 0:e.options)||void 0===t?void 0:t.data)&&void 0!==s?s:{},gotrue_meta_security:{captcha_token:null===(r=null==e?void 0:e.options)||void 0===r?void 0:r.captchaToken}},xform:yt}),{data:n,error:o}=i;if(o||!n)return{data:{user:null,session:null},error:o};const a=n.session,l=n.user;return n.session&&(await this._saveSession(n.session),await this._notifyAllSubscribers("SIGNED_IN",a)),{data:{user:l,session:a},error:null}}catch(e){if(st(e))return{data:{user:null,session:null},error:e};throw e}}async signUp(e){var t,s,r;try{let i;if("email"in e){const{email:s,password:r,options:n}=e;let o=null,a=null;"pkce"===this.flowType&&([o,a]=await Qe(this.storage,this.storageKey)),i=await vt(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:null==n?void 0:n.emailRedirectTo,body:{email:s,password:r,data:null!==(t=null==n?void 0:n.data)&&void 0!==t?t:{},gotrue_meta_security:{captcha_token:null==n?void 0:n.captchaToken},code_challenge:o,code_challenge_method:a},xform:yt})}else{if(!("phone"in e))throw new lt("You must provide either an email or phone number and a password");{const{phone:t,password:n,options:o}=e;i=await vt(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:t,password:n,data:null!==(s=null==o?void 0:o.data)&&void 0!==s?s:{},channel:null!==(r=null==o?void 0:o.channel)&&void 0!==r?r:"sms",gotrue_meta_security:{captcha_token:null==o?void 0:o.captchaToken}},xform:yt})}}const{data:n,error:o}=i;if(o||!n)return{data:{user:null,session:null},error:o};const a=n.session,l=n.user;return n.session&&(await this._saveSession(n.session),await this._notifyAllSubscribers("SIGNED_IN",a)),{data:{user:l,session:a},error:null}}catch(e){if(st(e))return{data:{user:null,session:null},error:e};throw e}}async signInWithPassword(e){try{let t;if("email"in e){const{email:s,password:r,options:i}=e;t=await vt(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:s,password:r,gotrue_meta_security:{captcha_token:null==i?void 0:i.captchaToken}},xform:wt})}else{if(!("phone"in e))throw new lt("You must provide either an email or phone number and a password");{const{phone:s,password:r,options:i}=e;t=await vt(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:s,password:r,gotrue_meta_security:{captcha_token:null==i?void 0:i.captchaToken}},xform:wt})}}const{data:s,error:r}=t;return r?{data:{user:null,session:null},error:r}:s&&s.session&&s.user?(s.session&&(await this._saveSession(s.session),await this._notifyAllSubscribers("SIGNED_IN",s.session)),{data:Object.assign({user:s.user,session:s.session},s.weak_password?{weakPassword:s.weak_password}:null),error:r}):{data:{user:null,session:null},error:new at}}catch(e){if(st(e))return{data:{user:null,session:null},error:e};throw e}}async signInWithOAuth(e){var t,s,r,i;return await this._handleProviderSignIn(e.provider,{redirectTo:null===(t=e.options)||void 0===t?void 0:t.redirectTo,scopes:null===(s=e.options)||void 0===s?void 0:s.scopes,queryParams:null===(r=e.options)||void 0===r?void 0:r.queryParams,skipBrowserRedirect:null===(i=e.options)||void 0===i?void 0:i.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(-1,(async()=>this._exchangeCodeForSession(e)))}async _exchangeCodeForSession(e){const t=await Ke(this.storage,`${this.storageKey}-code-verifier`),[s,r]=(null!=t?t:"").split("/");try{const{data:t,error:i}=await vt(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:s},xform:yt});if(await We(this.storage,`${this.storageKey}-code-verifier`),i)throw i;return t&&t.session&&t.user?(t.session&&(await this._saveSession(t.session),await this._notifyAllSubscribers("SIGNED_IN",t.session)),{data:Object.assign(Object.assign({},t),{redirectType:null!=r?r:null}),error:i}):{data:{user:null,session:null,redirectType:null},error:new at}}catch(e){if(st(e))return{data:{user:null,session:null,redirectType:null},error:e};throw e}}async signInWithIdToken(e){try{const{options:t,provider:s,token:r,access_token:i,nonce:n}=e,o=await vt(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:s,id_token:r,access_token:i,nonce:n,gotrue_meta_security:{captcha_token:null==t?void 0:t.captchaToken}},xform:yt}),{data:a,error:l}=o;return l?{data:{user:null,session:null},error:l}:a&&a.session&&a.user?(a.session&&(await this._saveSession(a.session),await this._notifyAllSubscribers("SIGNED_IN",a.session)),{data:a,error:l}):{data:{user:null,session:null},error:new at}}catch(e){if(st(e))return{data:{user:null,session:null},error:e};throw e}}async signInWithOtp(e){var t,s,r,i,n;try{if("email"in e){const{email:r,options:i}=e;let n=null,o=null;"pkce"===this.flowType&&([n,o]=await Qe(this.storage,this.storageKey));const{error:a}=await vt(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:r,data:null!==(t=null==i?void 0:i.data)&&void 0!==t?t:{},create_user:null===(s=null==i?void 0:i.shouldCreateUser)||void 0===s||s,gotrue_meta_security:{captcha_token:null==i?void 0:i.captchaToken},code_challenge:n,code_challenge_method:o},redirectTo:null==i?void 0:i.emailRedirectTo});return{data:{user:null,session:null},error:a}}if("phone"in e){const{phone:t,options:s}=e,{data:o,error:a}=await vt(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:t,data:null!==(r=null==s?void 0:s.data)&&void 0!==r?r:{},create_user:null===(i=null==s?void 0:s.shouldCreateUser)||void 0===i||i,gotrue_meta_security:{captcha_token:null==s?void 0:s.captchaToken},channel:null!==(n=null==s?void 0:s.channel)&&void 0!==n?n:"sms"}});return{data:{user:null,session:null,messageId:null==o?void 0:o.message_id},error:a}}throw new lt("You must provide either an email or phone number.")}catch(e){if(st(e))return{data:{user:null,session:null},error:e};throw e}}async verifyOtp(e){var t,s;try{let r,i;"options"in e&&(r=null===(t=e.options)||void 0===t?void 0:t.redirectTo,i=null===(s=e.options)||void 0===s?void 0:s.captchaToken);const{data:n,error:o}=await vt(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:i}}),redirectTo:r,xform:yt});if(o)throw o;if(!n)throw new Error("An error occurred on token verification.");const a=n.session,l=n.user;return(null==a?void 0:a.access_token)&&(await this._saveSession(a),await this._notifyAllSubscribers("recovery"==e.type?"PASSWORD_RECOVERY":"SIGNED_IN",a)),{data:{user:l,session:a},error:null}}catch(e){if(st(e))return{data:{user:null,session:null},error:e};throw e}}async signInWithSSO(e){var t,s,r;try{let i=null,n=null;return"pkce"===this.flowType&&([i,n]=await Qe(this.storage,this.storageKey)),await vt(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:null!==(s=null===(t=e.options)||void 0===t?void 0:t.redirectTo)&&void 0!==s?s:void 0}),(null===(r=null==e?void 0:e.options)||void 0===r?void 0:r.captchaToken)?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:i,code_challenge_method:n}),headers:this.headers,xform:bt})}catch(e){if(st(e))return{data:null,error:e};throw e}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,(async()=>await this._reauthenticate()))}async _reauthenticate(){try{return await this._useSession((async e=>{const{data:{session:t},error:s}=e;if(s)throw s;if(!t)throw new ot;const{error:r}=await vt(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:t.access_token});return{data:{user:null,session:null},error:r}}))}catch(e){if(st(e))return{data:{user:null,session:null},error:e};throw e}}async resend(e){try{const t=`${this.url}/resend`;if("email"in e){const{email:s,type:r,options:i}=e,{error:n}=await vt(this.fetch,"POST",t,{headers:this.headers,body:{email:s,type:r,gotrue_meta_security:{captcha_token:null==i?void 0:i.captchaToken}},redirectTo:null==i?void 0:i.emailRedirectTo});return{data:{user:null,session:null},error:n}}if("phone"in e){const{phone:s,type:r,options:i}=e,{data:n,error:o}=await vt(this.fetch,"POST",t,{headers:this.headers,body:{phone:s,type:r,gotrue_meta_security:{captcha_token:null==i?void 0:i.captchaToken}}});return{data:{user:null,session:null,messageId:null==n?void 0:n.message_id},error:o}}throw new lt("You must provide either an email or phone number and a type")}catch(e){if(st(e))return{data:{user:null,session:null},error:e};throw e}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,(async()=>this._useSession((async e=>e))))}async _acquireLock(e,t){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){const e=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),s=(async()=>(await e,await t()))();return this.pendingInLock.push((async()=>{try{await s}catch(e){}})()),s}return await this.lock(`lock:${this.storageKey}`,e,(async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const e=t();for(this.pendingInLock.push((async()=>{try{await e}catch(e){}})()),await e;this.pendingInLock.length;){const e=[...this.pendingInLock];await Promise.all(e),this.pendingInLock.splice(0,e.length)}return await e}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}}))}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{const t=await this.__loadSession();return await e(t)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",(new Error).stack);try{let e=null;const t=await Ke(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",t),null!==t&&(this._isValidSession(t)?e=t:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!e)return{data:{session:null},error:null};const s=!!e.expires_at&&e.expires_at<=Date.now()/1e3;if(this._debug("#__loadSession()",`session has${s?"":" not"} expired`,"expires_at",e.expires_at),!s){if(this.storage.isServer){let t=this.suppressGetSessionWarning;e=new Proxy(e,{get:(e,s,r)=>(t||"user"!==s||(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),t=!0,this.suppressGetSessionWarning=!0),Reflect.get(e,s,r))})}return{data:{session:e},error:null}}const{session:r,error:i}=await this._callRefreshToken(e.refresh_token);return i?{data:{session:null},error:i}:{data:{session:r},error:null}}finally{this._debug("#__loadSession()","end")}}async getUser(e){return e?await this._getUser(e):(await this.initializePromise,await this._acquireLock(-1,(async()=>await this._getUser())))}async _getUser(e){try{return e?await vt(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:_t}):await this._useSession((async e=>{var t,s,r;const{data:i,error:n}=e;if(n)throw n;return(null===(t=i.session)||void 0===t?void 0:t.access_token)||this.hasCustomAuthorizationHeader?await vt(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:null!==(r=null===(s=i.session)||void 0===s?void 0:s.access_token)&&void 0!==r?r:void 0,xform:_t}):{data:{user:null},error:new ot}}))}catch(e){if(st(e))return function(e){return st(e)&&"AuthSessionMissingError"===e.name}(e)&&(await this._removeSession(),await We(this.storage,`${this.storageKey}-code-verifier`)),{data:{user:null},error:e};throw e}}async updateUser(e,t={}){return await this.initializePromise,await this._acquireLock(-1,(async()=>await this._updateUser(e,t)))}async _updateUser(e,t={}){try{return await this._useSession((async s=>{const{data:r,error:i}=s;if(i)throw i;if(!r.session)throw new ot;const n=r.session;let o=null,a=null;"pkce"===this.flowType&&null!=e.email&&([o,a]=await Qe(this.storage,this.storageKey));const{data:l,error:c}=await vt(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:null==t?void 0:t.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:o,code_challenge_method:a}),jwt:n.access_token,xform:_t});if(c)throw c;return n.user=l.user,await this._saveSession(n),await this._notifyAllSubscribers("USER_UPDATED",n),{data:{user:n.user},error:null}}))}catch(e){if(st(e))return{data:{user:null},error:e};throw e}}_decodeJWT(e){return Ye(e)}async setSession(e){return await this.initializePromise,await this._acquireLock(-1,(async()=>await this._setSession(e)))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new ot;const t=Date.now()/1e3;let s=t,r=!0,i=null;const n=Ye(e.access_token);if(n.exp&&(s=n.exp,r=s<=t),r){const{session:t,error:s}=await this._callRefreshToken(e.refresh_token);if(s)return{data:{user:null,session:null},error:s};if(!t)return{data:{user:null,session:null},error:null};i=t}else{const{data:r,error:n}=await this._getUser(e.access_token);if(n)throw n;i={access_token:e.access_token,refresh_token:e.refresh_token,user:r.user,token_type:"bearer",expires_in:s-t,expires_at:s},await this._saveSession(i),await this._notifyAllSubscribers("SIGNED_IN",i)}return{data:{user:i.user,session:i},error:null}}catch(e){if(st(e))return{data:{session:null,user:null},error:e};throw e}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(-1,(async()=>await this._refreshSession(e)))}async _refreshSession(e){try{return await this._useSession((async t=>{var s;if(!e){const{data:r,error:i}=t;if(i)throw i;e=null!==(s=r.session)&&void 0!==s?s:void 0}if(!(null==e?void 0:e.refresh_token))throw new ot;const{session:r,error:i}=await this._callRefreshToken(e.refresh_token);return i?{data:{user:null,session:null},error:i}:r?{data:{user:r.user,session:r},error:null}:{data:{user:null,session:null},error:null}}))}catch(e){if(st(e))return{data:{user:null,session:null},error:e};throw e}}async _getSessionFromURL(e,t){try{if(!ze())throw new ct("No browser detected.");if(e.error||e.error_description||e.error_code)throw new ct(e.error_description||"Error in URL with unspecified error_description",{error:e.error||"unspecified_error",code:e.error_code||"unspecified_code"});switch(t){case"implicit":if("pkce"===this.flowType)throw new ht("Not a valid PKCE flow url.");break;case"pkce":if("implicit"===this.flowType)throw new ct("Not a valid implicit grant flow url.")}if("pkce"===t){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!e.code)throw new ht("No code detected.");const{data:t,error:s}=await this._exchangeCodeForSession(e.code);if(s)throw s;const r=new URL(window.location.href);return r.searchParams.delete("code"),window.history.replaceState(window.history.state,"",r.toString()),{data:{session:t.session,redirectType:null},error:null}}const{provider_token:s,provider_refresh_token:r,access_token:i,refresh_token:n,expires_in:o,expires_at:a,token_type:l}=e;if(!(i&&o&&n&&l))throw new ct("No session defined in URL");const c=Math.round(Date.now()/1e3),h=parseInt(o);let d=c+h;a&&(d=parseInt(a));const u=d-c;1e3*u<=$t&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${u}s, should have been closer to ${h}s`);const p=d-h;c-p>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",p,d,c):c-p<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",p,d,c);const{data:f,error:g}=await this._getUser(i);if(g)throw g;const m={provider_token:s,provider_refresh_token:r,access_token:i,expires_in:h,expires_at:d,refresh_token:n,token_type:l,user:f.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:m,redirectType:e.type},error:null}}catch(e){if(st(e))return{data:{session:null,redirectType:null},error:e};throw e}}_isImplicitGrantCallback(e){return Boolean(e.access_token||e.error_description)}async _isPKCECallback(e){const t=await Ke(this.storage,`${this.storageKey}-code-verifier`);return!(!e.code||!t)}async signOut(e={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,(async()=>await this._signOut(e)))}async _signOut({scope:e}={scope:"global"}){return await this._useSession((async t=>{var s;const{data:r,error:i}=t;if(i)return{error:i};const n=null===(s=r.session)||void 0===s?void 0:s.access_token;if(n){const{error:t}=await this.admin.signOut(n,e);if(t&&(!function(e){return st(e)&&"AuthApiError"===e.name}(t)||404!==t.status&&401!==t.status&&403!==t.status))return{error:t}}return"others"!==e&&(await this._removeSession(),await We(this.storage,`${this.storageKey}-code-verifier`)),{error:null}}))}onAuthStateChange(e){const t="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){const t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)})),s={id:t,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",t),this.stateChangeEmitters.delete(t)}};return this._debug("#onAuthStateChange()","registered callback with id",t),this.stateChangeEmitters.set(t,s),(async()=>{await this.initializePromise,await this._acquireLock(-1,(async()=>{this._emitInitialSession(t)}))})(),{data:{subscription:s}}}async _emitInitialSession(e){return await this._useSession((async t=>{var s,r;try{const{data:{session:r},error:i}=t;if(i)throw i;await(null===(s=this.stateChangeEmitters.get(e))||void 0===s?void 0:s.callback("INITIAL_SESSION",r)),this._debug("INITIAL_SESSION","callback id",e,"session",r)}catch(t){await(null===(r=this.stateChangeEmitters.get(e))||void 0===r?void 0:r.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",t),console.error(t)}}))}async resetPasswordForEmail(e,t={}){let s=null,r=null;"pkce"===this.flowType&&([s,r]=await Qe(this.storage,this.storageKey,!0));try{return await vt(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:s,code_challenge_method:r,gotrue_meta_security:{captcha_token:t.captchaToken}},headers:this.headers,redirectTo:t.redirectTo})}catch(e){if(st(e))return{data:null,error:e};throw e}}async getUserIdentities(){var e;try{const{data:t,error:s}=await this.getUser();if(s)throw s;return{data:{identities:null!==(e=t.user.identities)&&void 0!==e?e:[]},error:null}}catch(e){if(st(e))return{data:null,error:e};throw e}}async linkIdentity(e){var t;try{const{data:s,error:r}=await this._useSession((async t=>{var s,r,i,n,o;const{data:a,error:l}=t;if(l)throw l;const c=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:null===(s=e.options)||void 0===s?void 0:s.redirectTo,scopes:null===(r=e.options)||void 0===r?void 0:r.scopes,queryParams:null===(i=e.options)||void 0===i?void 0:i.queryParams,skipBrowserRedirect:!0});return await vt(this.fetch,"GET",c,{headers:this.headers,jwt:null!==(o=null===(n=a.session)||void 0===n?void 0:n.access_token)&&void 0!==o?o:void 0})}));if(r)throw r;return ze()&&!(null===(t=e.options)||void 0===t?void 0:t.skipBrowserRedirect)&&window.location.assign(null==s?void 0:s.url),{data:{provider:e.provider,url:null==s?void 0:s.url},error:null}}catch(t){if(st(t))return{data:{provider:e.provider,url:null},error:t};throw t}}async unlinkIdentity(e){try{return await this._useSession((async t=>{var s,r;const{data:i,error:n}=t;if(n)throw n;return await vt(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:null!==(r=null===(s=i.session)||void 0===s?void 0:s.access_token)&&void 0!==r?r:void 0})}))}catch(e){if(st(e))return{data:null,error:e};throw e}}async _refreshAccessToken(e){const t=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(t,"begin");try{const i=Date.now();return await(s=async s=>(s>0&&await async function(e){return await new Promise((t=>{setTimeout((()=>t(null)),e)}))}(200*Math.pow(2,s-1)),this._debug(t,"refreshing attempt",s),await vt(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:yt})),r=(e,t)=>{const s=200*Math.pow(2,e);return t&&ut(t)&&Date.now()+s-i<$t},new Promise(((e,t)=>{(async()=>{for(let i=0;i<1/0;i++)try{const t=await s(i);if(!r(i,null))return void e(t)}catch(e){if(!r(i,e))return void t(e)}})()})))}catch(e){if(this._debug(t,"error",e),st(e))return{data:{session:null,user:null},error:e};throw e}finally{this._debug(t,"end")}var s,r}_isValidSession(e){return"object"==typeof e&&null!==e&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,t){const s=await this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:t.redirectTo,scopes:t.scopes,queryParams:t.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",t,"url",s),ze()&&!t.skipBrowserRedirect&&window.location.assign(s),{data:{provider:e,url:s},error:null}}async _recoverAndRefresh(){var e;const t="#_recoverAndRefresh()";this._debug(t,"begin");try{const s=await Ke(this.storage,this.storageKey);if(this._debug(t,"session from storage",s),!this._isValidSession(s))return this._debug(t,"session is not valid"),void(null!==s&&await this._removeSession());const r=Math.round(Date.now()/1e3),i=(null!==(e=s.expires_at)&&void 0!==e?e:1/0)<r+10;if(this._debug(t,`session has${i?"":" not"} expired with margin of 10s`),i){if(this.autoRefreshToken&&s.refresh_token){const{error:e}=await this._callRefreshToken(s.refresh_token);e&&(console.error(e),ut(e)||(this._debug(t,"refresh failed with a non-retryable error, removing the session",e),await this._removeSession()))}}else await this._notifyAllSubscribers("SIGNED_IN",s)}catch(e){return this._debug(t,"error",e),void console.error(e)}finally{this._debug(t,"end")}}async _callRefreshToken(e){var t,s;if(!e)throw new ot;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const r=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(r,"begin");try{this.refreshingDeferred=new Ze;const{data:t,error:s}=await this._refreshAccessToken(e);if(s)throw s;if(!t.session)throw new ot;await this._saveSession(t.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",t.session);const r={session:t.session,error:null};return this.refreshingDeferred.resolve(r),r}catch(e){if(this._debug(r,"error",e),st(e)){const s={session:null,error:e};return ut(e)||await this._removeSession(),null===(t=this.refreshingDeferred)||void 0===t||t.resolve(s),s}throw null===(s=this.refreshingDeferred)||void 0===s||s.reject(e),e}finally{this.refreshingDeferred=null,this._debug(r,"end")}}async _notifyAllSubscribers(e,t,s=!0){const r=`#_notifyAllSubscribers(${e})`;this._debug(r,"begin",t,`broadcast = ${s}`);try{this.broadcastChannel&&s&&this.broadcastChannel.postMessage({event:e,session:t});const r=[],i=Array.from(this.stateChangeEmitters.values()).map((async s=>{try{await s.callback(e,t)}catch(e){r.push(e)}}));if(await Promise.all(i),r.length>0){for(let e=0;e<r.length;e+=1)console.error(r[e]);throw r[0]}}finally{this._debug(r,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0,await Ge(this.storage,this.storageKey,e)}async _removeSession(){this._debug("#_removeSession()"),await We(this.storage,this.storageKey),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&ze()&&(null===window||void 0===window?void 0:window.removeEventListener)&&window.removeEventListener("visibilitychange",e)}catch(e){console.error("removing visibilitychange callback failed",e)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval((()=>this._autoRefreshTokenTick()),$t);this.autoRefreshTicker=e,e&&"object"==typeof e&&"function"==typeof e.unref?e.unref():"undefined"!=typeof Deno&&"function"==typeof Deno.unrefTimer&&Deno.unrefTimer(e),setTimeout((async()=>{await this.initializePromise,await this._autoRefreshTokenTick()}),0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,(async()=>{try{const e=Date.now();try{return await this._useSession((async t=>{const{data:{session:s}}=t;if(!s||!s.refresh_token||!s.expires_at)return void this._debug("#_autoRefreshTokenTick()","no session");const r=Math.floor((1e3*s.expires_at-e)/$t);this._debug("#_autoRefreshTokenTick()",`access token expires in ${r} ticks, a tick lasts 30000ms, refresh threshold is 3 ticks`),r<=3&&await this._callRefreshToken(s.refresh_token)}))}catch(e){console.error("Auto refresh tick failed with error. This is likely a transient error.",e)}}finally{this._debug("#_autoRefreshTokenTick()","end")}}))}catch(e){if(!(e.isAcquireTimeout||e instanceof Tt))throw e;this._debug("auto refresh token tick lock not available")}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!ze()||!(null===window||void 0===window?void 0:window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),null===window||void 0===window||window.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){const t=`#_onVisibilityChanged(${e})`;this._debug(t,"visibilityState",document.visibilityState),"visible"===document.visibilityState?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(-1,(async()=>{"visible"===document.visibilityState?await this._recoverAndRefresh():this._debug(t,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting")})))):"hidden"===document.visibilityState&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,t,s){const r=[`provider=${encodeURIComponent(t)}`];if((null==s?void 0:s.redirectTo)&&r.push(`redirect_to=${encodeURIComponent(s.redirectTo)}`),(null==s?void 0:s.scopes)&&r.push(`scopes=${encodeURIComponent(s.scopes)}`),"pkce"===this.flowType){const[e,t]=await Qe(this.storage,this.storageKey),s=new URLSearchParams({code_challenge:`${encodeURIComponent(e)}`,code_challenge_method:`${encodeURIComponent(t)}`});r.push(s.toString())}if(null==s?void 0:s.queryParams){const e=new URLSearchParams(s.queryParams);r.push(e.toString())}return(null==s?void 0:s.skipBrowserRedirect)&&r.push(`skip_http_redirect=${s.skipBrowserRedirect}`),`${e}?${r.join("&")}`}async _unenroll(e){try{return await this._useSession((async t=>{var s;const{data:r,error:i}=t;return i?{data:null,error:i}:await vt(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:null===(s=null==r?void 0:r.session)||void 0===s?void 0:s.access_token})}))}catch(e){if(st(e))return{data:null,error:e};throw e}}async _enroll(e){try{return await this._useSession((async t=>{var s,r;const{data:i,error:n}=t;if(n)return{data:null,error:n};const o=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},"phone"===e.factorType?{phone:e.phone}:{issuer:e.issuer}),{data:a,error:l}=await vt(this.fetch,"POST",`${this.url}/factors`,{body:o,headers:this.headers,jwt:null===(s=null==i?void 0:i.session)||void 0===s?void 0:s.access_token});return l?{data:null,error:l}:("totp"===e.factorType&&(null===(r=null==a?void 0:a.totp)||void 0===r?void 0:r.qr_code)&&(a.totp.qr_code=`data:image/svg+xml;utf-8,${a.totp.qr_code}`),{data:a,error:null})}))}catch(e){if(st(e))return{data:null,error:e};throw e}}async _verify(e){return this._acquireLock(-1,(async()=>{try{return await this._useSession((async t=>{var s;const{data:r,error:i}=t;if(i)return{data:null,error:i};const{data:n,error:o}=await vt(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:{code:e.code,challenge_id:e.challengeId},headers:this.headers,jwt:null===(s=null==r?void 0:r.session)||void 0===s?void 0:s.access_token});return o?{data:null,error:o}:(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+n.expires_in},n)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",n),{data:n,error:o})}))}catch(e){if(st(e))return{data:null,error:e};throw e}}))}async _challenge(e){return this._acquireLock(-1,(async()=>{try{return await this._useSession((async t=>{var s;const{data:r,error:i}=t;return i?{data:null,error:i}:await vt(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{body:{channel:e.channel},headers:this.headers,jwt:null===(s=null==r?void 0:r.session)||void 0===s?void 0:s.access_token})}))}catch(e){if(st(e))return{data:null,error:e};throw e}}))}async _challengeAndVerify(e){const{data:t,error:s}=await this._challenge({factorId:e.factorId});return s?{data:null,error:s}:await this._verify({factorId:e.factorId,challengeId:t.id,code:e.code})}async _listFactors(){const{data:{user:e},error:t}=await this.getUser();if(t)return{data:null,error:t};const s=(null==e?void 0:e.factors)||[],r=s.filter((e=>"totp"===e.factor_type&&"verified"===e.status)),i=s.filter((e=>"phone"===e.factor_type&&"verified"===e.status));return{data:{all:s,totp:r,phone:i},error:null}}async _getAuthenticatorAssuranceLevel(){return this._acquireLock(-1,(async()=>await this._useSession((async e=>{var t,s;const{data:{session:r},error:i}=e;if(i)return{data:null,error:i};if(!r)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const n=this._decodeJWT(r.access_token);let o=null;n.aal&&(o=n.aal);let a=o;return(null!==(s=null===(t=r.user.factors)||void 0===t?void 0:t.filter((e=>"verified"===e.status)))&&void 0!==s?s:[]).length>0&&(a="aal2"),{data:{currentLevel:o,nextLevel:a,currentAuthenticationMethods:n.amr||[]},error:null}}))))}}Rt.nextInstanceID=0;const Lt=Rt;class Nt extends Lt{constructor(e){super(e)}}const Mt=new class{constructor(e,t,s){var r,i,n;if(this.supabaseUrl=e,this.supabaseKey=t,!e)throw new Error("supabaseUrl is required.");if(!t)throw new Error("supabaseKey is required.");const o=e.replace(/\/$/,"");this.realtimeUrl=`${o}/realtime/v1`.replace(/^http/i,"ws"),this.authUrl=`${o}/auth/v1`,this.storageUrl=`${o}/storage/v1`,this.functionsUrl=`${o}/functions/v1`;const a=`sb-${new URL(this.authUrl).hostname.split(".")[0]}-auth-token`,l=function(e,t){const{db:s,auth:r,realtime:i,global:n}=e,{db:o,auth:a,realtime:l,global:c}=t,h={db:Object.assign(Object.assign({},o),s),auth:Object.assign(Object.assign({},a),r),realtime:Object.assign(Object.assign({},l),i),global:Object.assign(Object.assign({},c),n),accessToken:()=>{return e=this,t=void 0,r=function*(){return""},new((s=void 0)||(s=Promise))((function(i,n){function o(e){try{l(r.next(e))}catch(e){n(e)}}function a(e){try{l(r.throw(e))}catch(e){n(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,a)}l((r=r.apply(e,t||[])).next())}));var e,t,s,r}};return e.accessToken?h.accessToken=e.accessToken:delete h.accessToken,h}(null!=s?s:{},{db:$e,realtime:Re,auth:Object.assign(Object.assign({},Ae),{storageKey:a}),global:Ie});this.storageKey=null!==(r=l.auth.storageKey)&&void 0!==r?r:"",this.headers=null!==(i=l.global.headers)&&void 0!==i?i:{},l.accessToken?(this.accessToken=l.accessToken,this.auth=new Proxy({},{get:(e,t)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(t)} is not possible`)}})):this.auth=this._initSupabaseAuthClient(null!==(n=l.auth)&&void 0!==n?n:{},this.headers,l.global.fetch),this.fetch=Me(t,this._getAccessToken.bind(this),l.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},l.realtime)),this.rest=new S(`${o}/rest/v1`,{headers:this.headers,schema:l.db.schema,fetch:this.fetch}),l.accessToken||this._listenForAuthEvents()}get functions(){return new j(this.functionsUrl,{headers:this.headers,customFetch:this.fetch})}get storage(){return new Ee(this.storageUrl,this.headers,this.fetch)}from(e){return this.rest.from(e)}schema(e){return this.rest.schema(e)}rpc(e,t={},s={}){return this.rest.rpc(e,t,s)}channel(e,t={config:{}}){return this.realtime.channel(e,t)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){var e,t,s,r,i,n;return s=this,r=void 0,n=function*(){if(this.accessToken)return yield this.accessToken();const{data:s}=yield this.auth.getSession();return null!==(t=null===(e=s.session)||void 0===e?void 0:e.access_token)&&void 0!==t?t:null},new((i=void 0)||(i=Promise))((function(e,t){function o(e){try{l(n.next(e))}catch(e){t(e)}}function a(e){try{l(n.throw(e))}catch(e){t(e)}}function l(t){var s;t.done?e(t.value):(s=t.value,s instanceof i?s:new i((function(e){e(s)}))).then(o,a)}l((n=n.apply(s,r||[])).next())}))}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:t,detectSessionInUrl:s,storage:r,storageKey:i,flowType:n,lock:o,debug:a},l,c){const h={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new Nt({url:this.authUrl,headers:Object.assign(Object.assign({},h),l),storageKey:i,autoRefreshToken:e,persistSession:t,detectSessionInUrl:s,storage:r,flowType:n,lock:o,debug:a,fetch:c,hasCustomAuthorizationHeader:"Authorization"in this.headers})}_initRealtimeClient(e){return new ae(this.realtimeUrl,Object.assign(Object.assign({},e),{params:Object.assign({apikey:this.supabaseKey},null==e?void 0:e.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange(((e,t)=>{this._handleTokenChanged(e,"CLIENT",null==t?void 0:t.access_token)}))}_handleTokenChanged(e,t,s){"TOKEN_REFRESHED"!==e&&"SIGNED_IN"!==e||this.changedAccessToken===s?"SIGNED_OUT"===e&&(this.realtime.setAuth(),"STORAGE"==t&&this.auth.signOut(),this.changedAccessToken=void 0):this.changedAccessToken=s}}("https://vttiicmlzxzxrcyyewfn.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZ0dGlpY21senh6eHJjeXlld2ZuIiwicm9sZSI6ImFub24iLCJpYXQiOjE2OTgwNTgwNzUsImV4cCI6MjAxMzYzNDA3NX0.Pxu-gsXoxazhKDcT1VvbzfYA2kyjiG07rphZmWvCEAg",undefined);const Ft=(0,g.createContext)(),Bt=function(e){const[t,s]=(0,g.useState)([]),[r,i]=(0,g.useState)(!1),[n,o]=(0,g.useState)(""),[a,l]=(0,g.useState)(!1),[c,d]=(0,g.useState)(!1),[u,p]=(0,g.useState)(!1),[f,m]=(0,g.useState)([]),[v,y]=(0,g.useState)([]),[w,_]=(0,g.useState)(""),[b,k]=(0,g.useState)([]),[x,j]=(0,g.useState)([]),[C,S]=(0,g.useState)([]),[P,T]=(0,g.useState)([]),[E,O]=(0,g.useState)([]),[I,$]=(0,g.useState)([]),[A,R]=(0,g.useState)("ascending"),[L,N]=(0,g.useState)("slug"),[M,F]=(0,g.useState)(!1),[B,D]=(0,g.useState)(!1),[U,H]=(0,g.useState)(!1),[z,V]=(0,g.useState)(!1),[q,J]=(0,g.useState)(1),[G,K]=(0,g.useState)(20),[W,Z]=(0,g.useState)(0),[Y,X]=(0,g.useState)(0);return(0,g.useEffect)((()=>{J(1),b&&!b.length>0&&k(ollie_pattern_options.downloaded_patterns),x.length&&(k([...b,...x]),j([])),C.length&&(k(b.filter((e=>!C.includes(e)))),S([])),I&&!I.length>0&&$(ollie_pattern_options.favorite_patterns),P.length&&($([...I,...P]),T([])),E.length&&($(I.filter((e=>!E.includes(e)))),O([]))}),[W,Y,I,b,x,C,P,E]),(0,h.jsx)(Ft.Provider,{value:{setPatternsToAdd:j,setPatternsToDelete:S,setPatternsToAddFavorites:T,setPatternsToDeleteFavorites:O,patternsToAddFavorites:P,patternsToDeleteFavorites:E,loadPatterns:z,patterns:t,getPattern:async function(e){try{const{data:t,error:s}=await Mt.from("patterns").select("*").eq("id",e);if(s)throw s;return t[0]}catch(e){o(e.message)}},setPatterns:s,errorMessage:n,showAddPattern:r,setShowAddPattern:i,getPatterns:async function(){V(!0);try{let e={ascending:"ascending"===A},t=Mt.from("patterns").select().range((q-1)*G,q*G-1).order(L,e);c||u||Mt.from("patterns").select("*",{count:"exact",head:!0}).then((e=>{Z(Math.round(e.count/G)),X(e.count)})),c&&(Mt.from("patterns").select("*, relations_pattern_collection!inner(collection_id)",{count:"exact",head:!0}).eq("relations_pattern_collection.collection_id",c).then((e=>{Z(Math.round(e.count/G)),X(e.count)})),t=t.select("*, relations_pattern_collection!inner(collection_id)").eq("relations_pattern_collection.collection_id",c).order(L,e).range((q-1)*G,q*G-1)),u&&(Mt.from("patterns").select("*, relations_pattern_category!inner(category_id)",{count:"exact",head:!0}).eq("relations_pattern_category.category_id",u).then((e=>{Z(Math.round(e.count/G)),X(e.count)})),t=t.select("*, relations_pattern_category!inner(category_id)").eq("relations_pattern_category.category_id",u).order(L,e).range((q-1)*G,q*G-1)),w&&(t=t.textSearch("title_content",`*${w}*`));let{data:r,error:i}=await t;if(i)throw i;if(M||B){let e=[];r.forEach((t=>{if(B){let s=t.slug.replace("/","-");I.find((e=>e===s))&&e.push(t)}if(M){let s=t.slug.replace("/","-");b.find((e=>e===s))&&e.push(t)}})),r=e}if(c){let e=[];r.forEach((t=>{t.relations_pattern_collection&&t.relations_pattern_collection.forEach((s=>{s.collection_id===c&&e.push(t)}))})),e.length>0?(s(e),V(!1)):(s(r),V(!1))}else if(u){let e=[];r.forEach((t=>{t.relations_pattern_category&&t.relations_pattern_category.forEach((s=>{s.category_id===u&&e.push(t)}))})),e.length>0?(s(e),V(!1)):(s(r),V(!1))}else s(r),V(!1)}catch(e){o(e.message)}},getPatternMeta:async function(e){try{const{data:t,error:s}=await Mt.from("patterns_meta").select("*").eq("pattern_id",e);if(s)throw s;return t[0]}catch(e){o(e.message)}},downloadedPatterns:b,setDownloadedPatterns:k,selectedPatterns:f,setSelectedPatterns:m,selectedPatternsBlocks:v,setSelectedPatternsBlocks:y,getCollection:async function(e){try{const{data:t,error:s}=await Mt.from("patterns_collections").select("*").eq("id",e);if(s)throw s;return t[0]}catch(e){o(e.message)}},getCollections:async function(){try{let e={ascending:"ascending"===A};const{data:t,error:s}=await Mt.from("patterns_collections").select("*").order(L,e);if(s)throw s;return t}catch(e){o(e.message)}},selectedCollection:c,setSelectedCollection:d,getRelatedCollection:async function(e){try{const{data:t,error:s}=await Mt.from("relations_pattern_collection").select("*").eq("pattern_id",e);if(s)throw s;return t[0]}catch(e){o(e.message)}},getCategories:async function(){try{let e={ascending:"ascending"===A};const{data:t,error:s}=await Mt.from("patterns_categories").select("*").order(L,e);if(s)throw s;return t}catch(e){o(e.message)}},getCategory:async function(e){try{const{data:t,error:s}=await Mt.from("patterns_categories").select("*").eq("id",e);if(s)throw s;return t[0]}catch(e){o(e.message)}},getRelatedCategories:async function(e){try{const{data:t,error:s}=await Mt.from("relations_pattern_category").select("*").eq("pattern_id",e);if(s)throw s;return t}catch(e){o(e.message)}},selectedCategory:u,setSelectedCategory:p,favoritePatternsSlugs:I,setFavoritePatternsSlugs:$,searchTerm:w,setSearchTerm:_,filterByFavorite:B,setFilterByFavorite:D,filterByDownload:M,setFilterByDownload:F,sortingDirection:A,setSortingDirection:R,sortingField:L,setSortingField:N,isPreview:a,setIsPreview:l,previewPattern:U,setPreviewPattern:H,setPage:J,setPerPage:K,perPage:G,maxPages:W,totalPatterns:Y,page:q},children:e.children})},Dt=window.wp.apiFetch;var Ut=o.n(Dt);function Ht(e){Ut()({path:"/ollie/v1/patterns/download",method:"POST",data:e}).then((e=>e))}function zt(e){Ut()({path:"/ollie/v1/patterns/delete",method:"POST",data:e}).then((e=>e))}function Vt(e,t){let s=wp.data.select("core/block-editor").getSelectedBlock(),r=(0,a.parse)(e.content);t&&(r=(0,a.parse)(e.dynamic_content)),(0,p.dispatch)("core/block-editor").replaceBlock(s.clientId,r)}function qt(e){Ut()({path:"/ollie/v1/favorites/add",method:"POST",data:e}).then((e=>e))}function Jt(e){Ut()({path:"/ollie/v1/favorites/delete",method:"POST",data:e}).then((e=>e))}const Gt=(0,h.jsx)(c.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",children:(0,h.jsx)(c.Path,{d:"M12 4.75a7.25 7.25 0 100 14.5 7.25 7.25 0 000-14.5zM3.25 12a8.75 8.75 0 1117.5 0 8.75 8.75 0 01-17.5 0zM12 8.75a1.5 1.5 0 01.167 2.99c-.465.052-.917.44-.917 1.01V14h1.5v-.845A3 3 0 109 10.25h1.5a1.5 1.5 0 011.5-1.5zM11.25 15v1.5h1.5V15h-1.5z"})}),{__}=(window.React,wp.i18n),Kt=function(e){const{getPatternMeta:t,getRelatedCategories:s,getCategory:r,downloadedPatterns:i,setDownloadedPatterns:n,favoritePatternsSlugs:o,setFavoritePatternsSlugs:a}=(0,g.useContext)(Ft),[l,c]=(0,g.useState)(!1),d=(e,t)=>{Vt(e,t)},u=e=>{let t=e.slug.replace("/","-");return i.includes(t)},p=()=>{u(e.pattern)?(e=>{let t=e.slug.replace("/","-");zt(e),n(...i.filter((e=>e!==t)))})(e.pattern):(e=>{let o=e.slug.replace("/","-");e.categories=[],s(e.id).then((t=>{t.forEach((t=>{r(t.category_id).then((t=>{e.categories.push(t.slug)}))}))})).then((()=>{t(e.id).then((t=>{t.description&&(e.description=t.description),t.keywords&&(e.keywords=t.keywords)})).then((()=>{Ht(e)}))})),n([...i,o])})(e.pattern)};return(0,h.jsx)(m.Flex,{className:"ollie-pattern-actions",children:(0,h.jsx)(m.FlexItem,{children:(0,h.jsxs)(m.Flex,{direction:"column",gap:"5",children:[(0,h.jsx)("h3",{style:{marginBottom:0},children:__("Pattern Actions","ollie-pro")}),(0,h.jsxs)(m.FlexItem,{className:"ollie-pattern-action-entry",children:[(0,h.jsx)(m.Flex,{justify:"flex-start",gap:1,children:(0,h.jsxs)("strong",{children:[__("Insert on current page","ollie-pro")," "]})}),(0,h.jsx)(m.Button,{variant:"secondary",className:"pattern-insert",onClick:()=>{d(e.pattern,!1)},text:__("Insert Pattern","ollie-pro")})]}),e.pattern.dynamic_content&&(0,h.jsxs)(m.FlexItem,{className:"ollie-pattern-action-entry",children:[(0,h.jsx)(m.Flex,{justify:"flex-start",gap:1,children:(0,h.jsxs)("strong",{children:[__("Insert dynamic pattern","ollie-pro")," "]})}),(0,h.jsx)(m.Button,{variant:"secondary",className:"pattern-insert",onClick:()=>{d(e.pattern,!0)},text:__("Insert Dynamic Pattern","ollie-pro")})]}),(0,h.jsxs)(m.FlexItem,{className:"ollie-pattern-action-entry",children:[(0,h.jsx)(m.Flex,{justify:"flex-start",gap:1,children:(0,h.jsxs)("strong",{children:[__("Copy pattern blocks","ollie-pro")," "]})}),(0,h.jsx)(m.ClipboardButton,{variant:"secondary",text:e.pattern.content,onCopy:()=>c(!0),onFinishCopy:()=>c(!1),children:l?"Copied!":"Copy Pattern Blocks"})]}),(0,h.jsxs)(m.FlexItem,{className:"ollie-pattern-action-entry",children:[(0,h.jsxs)(m.Flex,{justify:"flex-start",gap:1,children:[(0,h.jsxs)("strong",{children:[__("Download pattern to theme","ollie-pro")," "]}),(0,h.jsx)(m.Tooltip,{text:__("Download the pattern to your theme's pattern library to edit and customize","ollie-pro"),delay:0,children:(0,h.jsx)(m.Icon,{icon:Gt,size:18})})]}),(0,h.jsx)(m.Button,{variant:"secondary",className:"pattern-insert",onClick:()=>{u(e.pattern)?window.confirm(__("Heads up, this will remove the pattern file from your theme. If you've customized the pattern, the changes will be lost.","ollie-pro"))&&p():p()},text:u(e.pattern)?__("Remove Pattern","ollie-pro"):__("Download Pattern","ollie-pro")})]}),(e=>{let t=e.slug.replace("/","-");return o.length>0&&o.includes(t)})(e.pattern)?(0,h.jsxs)(m.FlexItem,{className:"ollie-pattern-action-entry",children:[(0,h.jsx)(m.Flex,{justify:"flex-start",gap:1,children:(0,h.jsxs)("strong",{children:[__("Remove from favorites","ollie-pro")," "]})}),(0,h.jsx)(m.Button,{variant:"secondary",className:"pattern-insert",onClick:()=>{(e=>{let t=e.slug.replace("/","-");Jt(t),o.length>0?a(...o.filter((e=>e.slug!==t))):a([])})(e.pattern)},text:__("Remove from Favorites","ollie-pro")})]}):(0,h.jsxs)(m.FlexItem,{className:"ollie-pattern-action-entry",children:[(0,h.jsx)(m.Flex,{justify:"flex-start",gap:1,children:(0,h.jsxs)("strong",{children:[__("Add To Favorites","ollie-pro")," "]})}),(0,h.jsx)(m.Button,{variant:"secondary",className:"pattern-insert",onClick:()=>{(e=>{let t=e.slug.replace("/","-");qt(t),a([...o,t])})(e.pattern)},text:__("Add to Favorites","ollie-pro")})]})]})})})},Wt=(0,h.jsx)(c.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",children:(0,h.jsx)(c.Path,{d:"M14.6 7l-1.2-1L8 12l5.4 6 1.2-1-4.6-5z"})}),Zt=(0,h.jsx)(c.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",children:(0,h.jsx)(c.Path,{d:"M10.8622 8.04053L14.2805 12.0286L10.8622 16.0167L9.72327 15.0405L12.3049 12.0286L9.72327 9.01672L10.8622 8.04053Z"})}),{__:Yt}=wp.i18n,Xt=function({pattern:e}){const{getCollection:t,selectedCollection:s,setSelectedCollection:r,getCategories:i,getCategory:n,setSelectedCategory:o,selectedCategory:a,getCollections:l,isPreview:c,setIsPreview:d}=(0,g.useContext)(Ft),[u,p]=(0,g.useState)([]),[f,v]=(0,g.useState)([]),[y,w]=(0,g.useState)([]),[_,b]=(0,g.useState)(!1),[k,x]=(0,g.useState)(!1),[j,C]=(0,g.useState)(null),S=(e,t)=>{r(!!e&&e.id),o(!!t&&t.id)};return(0,g.useEffect)((()=>{var r,o;0===u.length&&l().then((e=>{e&&p(e)})),0===f.length&&i().then((e=>{e&&v(e)})),s&&((r=s)?t(r).then((e=>{b(e)})):b(!1)),a&&((o=a)?n(o).then((e=>{x(e)})):x(!1)),e.categories&&0===y.length&&(e=>{e.forEach((e=>{n(e.category_id).then((e=>{w((t=>[...t,e]))}))}))})(e.categories)}),[u,s,f,a,y,e]),(0,h.jsx)("div",{className:"ollie-patterns-sidebar "+(s||a||c?"ollie-patterns-sidebar-single":""),children:s&&!c?(0,h.jsxs)(h.Fragment,{children:[(0,h.jsx)(m.Button,{variant:"secondary",className:"ollie-back-overview has-text",onClick:()=>{S(!1,!1)},icon:Wt,text:Yt("Go Back","ollie-pro")}),(0,h.jsxs)(m.Flex,{direction:"column",gap:5,expanded:!1,children:[(0,h.jsxs)(m.Flex,{direction:"column",gap:0,children:[(0,h.jsx)("h2",{children:_.title}),_.description&&(0,h.jsx)("p",{children:_.description})]}),(0,h.jsx)(m.__experimentalDivider,{margin:"2",style:{color:"#d8d8d8"}}),(0,h.jsxs)(m.Flex,{direction:"column",gap:0,children:[(0,h.jsxs)("p",{children:[Yt("This collection uses the","ollie-pro")," ",_.title," ",Yt("style variation in the Ollie theme.","ollie-pro")]}),(0,h.jsx)("p",{children:(0,h.jsx)(m.ExternalLink,{href:"https://olliewp.com/docs",children:Yt("Learn about style variations","ollie-pro")})})]})]})]}):(0,h.jsx)(h.Fragment,{children:a&&!c?(0,h.jsxs)(h.Fragment,{children:[(0,h.jsx)(m.Button,{variant:"secondary",className:"ollie-back-overview has-text",onClick:()=>{S(!1,!1)},icon:Wt,text:Yt("Go Back","ollie-pro")}),(0,h.jsx)("h2",{children:k.title}),k.description&&(0,h.jsx)("p",{children:k.description})]}):(0,h.jsx)(h.Fragment,{children:c?(0,h.jsxs)(h.Fragment,{children:[(0,h.jsx)(m.Button,{variant:"secondary",className:"ollie-back-overview has-text",onClick:()=>d(!1),icon:Wt,text:Yt("Go Back","ollie-pro")}),(0,h.jsxs)(m.Flex,{direction:"column",gap:5,expanded:!1,children:[(0,h.jsxs)(m.Flex,{direction:"column",gap:0,children:[(0,h.jsx)("h2",{children:e.title}),e.description&&(0,h.jsx)("p",{children:e.description}),e.collection&&(0,h.jsxs)("p",{children:[(0,h.jsx)("b",{children:"Collection: "}),(0,h.jsx)(m.Button,{isLink:!0,onClick:()=>{return t=e.collection,d(!1),o(!1),r(t.id),void S(t,!1);var t},children:e.collection.title})]})]}),(0,h.jsx)(m.__experimentalDivider,{margin:"2",style:{color:"#d8d8d8"}}),(0,h.jsx)(Kt,{pattern:e}),(0,h.jsx)(m.__experimentalDivider,{margin:"2",style:{color:"#d8d8d8"}}),(0,h.jsx)(m.Flex,{direction:"column",gap:1,className:"ollie-pattern-meta",children:y&&(0,h.jsxs)("div",{children:[(0,h.jsx)("h3",{children:Yt("Pattern Categories","ollie-pro")}),(0,h.jsx)("ul",{className:"ollie-category-buttons",children:y.map((e=>(0,h.jsx)("li",{children:(0,h.jsx)(m.Button,{variant:"tertiary",className:"has-text block-editor-block-patterns-explorer__sidebar__categories-list__item",onClick:()=>{(e=>{d(!1),o(!1),w([]),S(!1,e)})(e)},text:e.title,icon:Zt,iconPosition:"right"})},e.id)))})]})})]})]}):(0,h.jsxs)(m.Flex,{direction:"column",gap:5,expanded:!1,children:[(0,h.jsxs)(m.FlexItem,{children:[(0,h.jsx)("h3",{children:Yt("Pattern Collections","ollie-pro")}),(0,h.jsx)("ul",{className:"ollie-category-buttons",children:u&&u.map((e=>(0,h.jsx)("li",{children:(0,h.jsx)(m.Button,{variant:"tertiary",className:"has-text block-editor-block-patterns-explorer__sidebar__categories-list__item",onClick:()=>{S(e,!1)},text:e.title,icon:Zt,iconPosition:"right"})},e.id)))})]}),(0,h.jsxs)(m.FlexItem,{children:[(0,h.jsx)("h3",{children:Yt("Pattern Categories","ollie-pro")}),(0,h.jsx)("ul",{className:"ollie-category-buttons",children:f&&f.map((e=>(0,h.jsx)("li",{children:(0,h.jsx)(m.Button,{variant:"tertiary",className:"has-text block-editor-block-patterns-explorer__sidebar__categories-list__item",onClick:()=>{S(!1,e)},text:e.title,icon:Zt,iconPosition:"right"})},e.id)))})]})]})})})})},Qt=(0,h.jsx)(c.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",children:(0,h.jsx)(c.Path,{d:"M15 4H9c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h6c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm.5 14c0 .3-.2.5-.5.5H9c-.3 0-.5-.2-.5-.5V6c0-.3.2-.5.5-.5h6c.3 0 .5.2.5.5v12zm-4.5-.5h2V16h-2v1.5z"})}),es=(0,h.jsx)(c.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",children:(0,h.jsx)(c.Path,{d:"M17 4H7c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h10c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm.5 14c0 .3-.2.5-.5.5H7c-.3 0-.5-.2-.5-.5V6c0-.3.2-.5.5-.5h10c.3 0 .5.2.5.5v12zm-7.5-.5h4V16h-4v1.5z"})}),ts=(0,h.jsx)(c.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",children:(0,h.jsx)(c.Path,{d:"M20.5 16h-.7V8c0-1.1-.9-2-2-2H6.2c-1.1 0-2 .9-2 2v8h-.7c-.8 0-1.5.7-1.5 1.5h20c0-.8-.7-1.5-1.5-1.5zM5.7 8c0-.3.2-.5.5-.5h11.6c.3 0 .5.2.5.5v7.6H5.7V8z"})}),{__:ss}=wp.i18n,rs=function(e){const{isPreview:t}=(0,g.useContext)(Ft),[s,r]=(0,g.useState)("100%"),[i,n]=(0,g.useState)("desktop");return(0,h.jsx)(h.Fragment,{children:t&&(0,h.jsxs)(h.Fragment,{children:[(0,h.jsxs)(m.Flex,{justify:"center",align:"center",className:"ollie-pattern-iframe-resize",gap:"4px",children:[(0,h.jsx)(m.FlexItem,{children:(0,h.jsx)(m.Button,{className:"mobile"===i?"ollie-resize-active":"",variant:"tertiary",label:ss("Preview mobile design","ollie-pro"),text:ss("Mobile","ollie-pro"),icon:Qt,onClick:()=>{r("500px"),n("mobile")}})}),(0,h.jsx)(m.FlexItem,{children:(0,h.jsx)(m.Button,{className:"tablet"===i?"ollie-resize-active":"",variant:"tertiary",label:ss("Preview tablet design","ollie-pro"),text:ss("Tablet","ollie-pro"),icon:es,onClick:()=>{r("781px"),n("tablet")}})}),(0,h.jsx)(m.FlexItem,{children:(0,h.jsx)(m.Button,{className:"desktop"===i?"ollie-resize-active":"",variant:"tertiary",label:ss("Preview desktop design","ollie-pro"),text:ss("Desktop","ollie-pro"),icon:ts,onClick:()=>{r("100%"),n("desktop")}})})]}),(0,h.jsx)(m.Flex,{className:"ollie-pattern-single",children:(0,h.jsx)(m.FlexItem,{isBlock:!0,children:(0,h.jsx)("iframe",{src:`https://patterns.olliewp.com/${e.pattern.slug}/`,style:{width:s,transition:"width 0.3s"}})})})]})})},is=(0,h.jsx)(c.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",children:(0,h.jsx)(c.Path,{d:"M13 19h-2v-2h2v2zm0-6h-2v-2h2v2zm0-6h-2V5h2v2z"})});function ns({fillColor:e}){return(0,h.jsx)("svg",{width:"30",height:"26",viewBox:"0 0 30 26",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:(0,h.jsx)("path",{d:"M27.4604 2.45287C26.0088 1.00559 24.0435 0.191518 21.9937 0.188473C19.9439 0.185428 17.9762 0.993654 16.5204 2.43662L15.2304 3.63412L13.9404 2.43662C12.485 0.984891 10.5125 0.170767 8.45688 0.173346C6.40124 0.175925 4.43083 0.994995 2.9791 2.45037C1.52737 3.90575 0.713248 5.87821 0.715826 7.93384C0.718405 9.98948 1.53748 11.9599 2.99285 13.4116L14.1616 24.7429C14.3012 24.8846 14.4675 24.9971 14.651 25.074C14.8345 25.1508 15.0314 25.1904 15.2304 25.1904C15.4293 25.1904 15.6262 25.1508 15.8097 25.074C15.9932 24.9971 16.1595 24.8846 16.2991 24.7429L27.4604 13.4191C28.1804 12.6994 28.7515 11.8449 29.1412 10.9044C29.5309 9.96394 29.7314 8.95589 29.7314 7.93787C29.7314 6.91985 29.5309 5.9118 29.1412 4.97131C28.7515 4.03082 28.1804 3.17632 27.4604 2.45662V2.45287ZM25.3354 11.3016L15.2304 21.5491L5.1216 11.2929C4.23385 10.4014 3.73601 9.19423 3.73731 7.93616C3.73862 6.67809 4.23896 5.47191 5.12855 4.58232C6.01814 3.69273 7.22432 3.19239 8.48239 3.19108C9.74046 3.18978 10.9477 3.68762 11.8391 4.57537C11.8516 4.58787 11.8641 4.60037 11.8779 4.61162L14.2079 6.78162C14.4855 7.0403 14.8509 7.18413 15.2304 7.18413C15.6098 7.18413 15.9752 7.0403 16.2528 6.78162L18.5829 4.61162C18.5966 4.60037 18.6091 4.58787 18.6216 4.57537C19.0633 4.13479 19.5874 3.7855 20.164 3.54747C20.7406 3.30944 21.3585 3.18731 21.9823 3.18806C22.6062 3.18882 23.2238 3.31244 23.7998 3.55187C24.3759 3.7913 24.8991 4.14184 25.3397 4.5835C25.7803 5.02515 26.1296 5.54925 26.3676 6.12589C26.6057 6.70253 26.7278 7.3204 26.727 7.94424C26.7263 8.56808 26.6027 9.18565 26.3632 9.76171C26.1238 10.3378 25.7733 10.861 25.3316 11.3016H25.3354Z",fill:e})})}function os({fillColor:e}){return(0,h.jsx)("svg",{width:"28",height:"28",viewBox:"0 0 28 28",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:(0,h.jsx)("path",{d:"M14 0.5C11.33 0.5 8.71987 1.29176 6.49981 2.77516C4.27974 4.25856 2.54942 6.36697 1.52763 8.83377C0.505849 11.3006 0.238504 14.015 0.759405 16.6337C1.28031 19.2525 2.56606 21.6579 4.45406 23.5459C6.34207 25.434 8.74754 26.7197 11.3663 27.2406C13.985 27.7615 16.6994 27.4942 19.1662 26.4724C21.633 25.4506 23.7414 23.7203 25.2248 21.5002C26.7082 19.2801 27.5 16.67 27.5 14C27.496 10.4208 26.0724 6.98932 23.5416 4.45844C21.0107 1.92756 17.5792 0.50397 14 0.5ZM14 24.5C11.9233 24.5 9.89323 23.8842 8.16652 22.7304C6.4398 21.5767 5.09399 19.9368 4.29927 18.0182C3.50455 16.0996 3.29662 13.9884 3.70176 11.9516C4.10691 9.91475 5.10693 8.04383 6.57538 6.57538C8.04384 5.10693 9.91476 4.1069 11.9516 3.70175C13.9884 3.29661 16.0996 3.50454 18.0182 4.29926C19.9368 5.09399 21.5767 6.4398 22.7304 8.16651C23.8842 9.89323 24.5 11.9233 24.5 14C24.497 16.7839 23.3898 19.4528 21.4213 21.4213C19.4529 23.3898 16.7839 24.497 14 24.5ZM19.0613 13.9388C19.2011 14.0781 19.3121 14.2437 19.3878 14.426C19.4635 14.6083 19.5024 14.8038 19.5024 15.0012C19.5024 15.1987 19.4635 15.3941 19.3878 15.5765C19.3121 15.7588 19.2011 15.9244 19.0613 16.0637L15.0613 20.0637C14.9219 20.2036 14.7563 20.3145 14.574 20.3903C14.3917 20.466 14.1962 20.5049 13.9988 20.5049C13.8013 20.5049 13.6059 20.466 13.4235 20.3903C13.2412 20.3145 13.0756 20.2036 12.9363 20.0637L8.93626 16.0637C8.79673 15.9242 8.68605 15.7586 8.61053 15.5763C8.53502 15.394 8.49615 15.1986 8.49615 15.0012C8.49615 14.8039 8.53502 14.6085 8.61053 14.4262C8.68605 14.2439 8.79673 14.0783 8.93626 13.9388C9.07578 13.7992 9.24143 13.6885 9.42373 13.613C9.60604 13.5375 9.80143 13.4986 9.99876 13.4986C10.1961 13.4986 10.3915 13.5375 10.5738 13.613C10.7561 13.6885 10.9217 13.7992 11.0613 13.9388L12.5 15.375V9C12.5 8.60218 12.658 8.22064 12.9393 7.93934C13.2206 7.65804 13.6022 7.5 14 7.5C14.3978 7.5 14.7794 7.65804 15.0607 7.93934C15.342 8.22064 15.5 8.60218 15.5 9V15.375L16.9388 13.935C17.0783 13.7958 17.2439 13.6854 17.4262 13.6103C17.6084 13.5351 17.8037 13.4966 18.0008 13.4969C18.1979 13.4973 18.393 13.5365 18.575 13.6123C18.757 13.6881 18.9222 13.799 19.0613 13.9388Z",fill:e})})}const as=o.p+"images/ollie-placeholder.76176486.webp",{__:ls}=wp.i18n,cs=function({pattern:e,isPatternSelected:t,preparePreview:s,gridView:r}){const{getPatternMeta:i,getRelatedCategories:n,getCategory:o,downloadedPatterns:l,setDownloadedPatterns:c,favoritePatternsSlugs:d,setFavoritePatternsSlugs:u,selectedPatterns:p,setSelectedPatterns:f,selectedPatternsBlocks:v,setSelectedPatternsBlocks:y}=(0,g.useContext)(Ft),w=e=>{let t=e.slug.replace("/","-");return d.length>0&&d.includes(t)},_=e=>{let t=e.slug.replace("/","-");return l.includes(t)};return(0,g.useEffect)((()=>{}),[r]),(0,h.jsxs)(m.__experimentalVStack,{spacing:"0",className:"ollie-pattern "+(t(e.id)?"ollie-pattern-selected":""),"data-id":e.id,children:[(0,h.jsx)("div",{className:"ollie-pattern-preview",onClick:()=>{s(e)},children:(0,h.jsx)("div",{className:"ollie-pattern-preview-inside",children:(0,h.jsx)("object",{data:`https://vttiicmlzxzxrcyyewfn.supabase.co/storage/v1/object/public/screenshots/${e.slug}.webp`,type:"image/webp",children:(0,h.jsx)("img",{loading:"lazy",src:as,alt:ls("Ollie Pattern Preview","ollie-pro")})})})}),(0,h.jsxs)(m.__experimentalHStack,{className:"ollie-pattern-header",children:[(0,h.jsx)(m.CheckboxControl,{className:"ollie-pattern-checkbox",checked:t(e.id),onChange:t=>{t?(f([...p,e.id]),y([...v,(0,a.parse)(e.content)])):(f(p.filter((t=>t!==e.id))),y(v.filter((t=>t!==(0,a.parse)(e.content)))))}}),(0,h.jsx)(m.__experimentalHStack,{alignment:"center",justify:"flex-start",spacing:2,children:(0,h.jsx)(m.Flex,{as:"div",gap:0,justify:"left",className:"ollie-pattern-title",children:(0,h.jsx)(m.Button,{variant:"link",label:ls("Pattern Details","ollie-pro"),text:e.title,tabIndex:"-1",onClick:()=>{s(e)}})})}),(0,h.jsxs)(m.__experimentalHStack,{className:"ollie-pattern-status",alignment:"right",expanded:!1,spacing:"5px",children:[w(e)?(0,h.jsx)(m.Tooltip,{text:ls("Added to favorites","ollie-pro"),children:(0,h.jsx)("span",{children:(0,h.jsx)(m.Icon,{icon:ns})})}):"",_(e)?(0,h.jsx)(m.Tooltip,{text:ls("Added to theme","ollie-pro"),children:(0,h.jsx)("span",{children:(0,h.jsx)(m.Icon,{icon:os})})}):""]}),(0,h.jsx)(m.DropdownMenu,{icon:is,iconSize:24,label:ls("Pattern Actions","ollie-pro"),children:({onClose:t})=>(0,h.jsx)(h.Fragment,{children:(0,h.jsxs)(m.MenuGroup,{className:"ollie-pattern-action-drop",children:[(0,h.jsx)(m.MenuItem,{onClick:()=>{s(e)},children:ls("Pattern Details","ollie-pro")}),(0,h.jsx)(m.MenuItem,{onClick:()=>{(e=>{Vt(e,!1)})(e)},children:ls("Insert Into Page","ollie-pro")}),_(e)?(0,h.jsx)(m.MenuItem,{onClick:()=>{(e=>{let t=e.slug.replace("/","-");zt(e),c(...l.filter((e=>e!==t)))})(e)},children:ls("Remove from Theme","ollie-pro")}):(0,h.jsx)(m.MenuItem,{onClick:()=>{(e=>{let t=e.slug.replace("/","-");e.categories=[],n(e.id).then((t=>{t.forEach((t=>{o(t.category_id).then((t=>{e.categories.push(t.slug)}))}))})).then((()=>{i(e.id).then((t=>{t.description&&(e.description=t.description),t.keywords&&(e.keywords=t.keywords)})).then((()=>{Ht(e)}))})),c([...l,t])})(e)},children:ls("Add To Theme","ollie-pro")}),w(e)?(0,h.jsx)(m.MenuItem,{onClick:()=>{(e=>{let t=e.slug.replace("/","-");Jt(t),d.length>0?u(...d.filter((e=>e.slug!==t))):u([])})(e)},children:ls("Remove from Favorites","ollie-pro")}):(0,h.jsx)(m.MenuItem,{onClick:()=>{(e=>{let t=e.slug.replace("/","-");qt(t),u([...d,t])})(e)},children:ls("Add to Favorites","ollie-pro")})]})})})]})]},e.id)};function hs({fillColor:e}){return(0,h.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512",children:(0,h.jsx)("path",{d:"M80 80v96h96V80H80zM32 32H80h96 48V80v96 48H176 80 32V176 80 32zM80 336v96h96V336H80zM32 288H80h96 48v48 96 48H176 80 32V432 336 288zM432 80H336v96h96V80zM336 32h96 48V80v96 48H432 336 288V176 80 32h48zm0 304v96h96V336H336zm-48-48h48 96 48v48 96 48H432 336 288V432 336 288z"})})}function ds({fillColor:e}){return(0,h.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 448 512",children:(0,h.jsx)("path",{d:"M88 72v48H40V72H88zM40 32H0V72v48 40H40 88h40V120 72 32H88 40zM88 232v48H40V232H88zM40 192H0v40 48 40H40 88h40V280 232 192H88 40zm0 200H88v48H40V392zM0 352v40 48 40H40 88h40V440 392 352H88 40 0zM248 72v48H200V72h48zM200 32H160V72v48 40h40 48 40V120 72 32H248 200zm0 200h48v48H200V232zm-40-40v40 48 40h40 48 40V280 232 192H248 200 160zm88 200v48H200V392h48zm-48-40H160v40 48 40h40 48 40V440 392 352H248 200zM360 72h48v48H360V72zM320 32V72v48 40h40 48 40V120 72 32H408 360 320zm88 200v48H360V232h48zm-48-40H320v40 48 40h40 48 40V280 232 192H408 360zm0 200h48v48H360V392zm-40-40v40 48 40h40 48 40V440 392 352H408 360 320z"})})}function us({fillColor:e}){return(0,h.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 448 512",children:(0,h.jsx)("path",{d:"M0 32H89.6v89.6H0V32zM0 151.5H89.6v89.6H0V151.5zM89.6 270.9v89.6H0V270.9H89.6zM0 390.4H89.6V480H0V390.4zM119.5 32h89.6v89.6H119.5V32zm0 119.5h89.6v89.6H119.5V151.5zm89.6 119.5v89.6H119.5V270.9h89.6zM119.5 390.4h89.6V480H119.5V390.4zM328.5 32v89.6H238.9V32h89.6zm0 119.5v89.6H238.9V151.5h89.6zM238.9 270.9h89.6v89.6H238.9V270.9zm89.6 119.5V480H238.9V390.4h89.6zM358.4 32H448v89.6H358.4V32zm0 119.5H448v89.6H358.4V151.5zM448 270.9v89.6H358.4V270.9H448zM358.4 390.4H448V480H358.4V390.4z"})})}function ps({fillColor:e}){return(0,h.jsx)("svg",{width:"26",height:"22",viewBox:"0 0 26 22",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:(0,h.jsx)("path",{d:"M12 10C12 10.3978 11.842 10.7794 11.5607 11.0607C11.2794 11.342 10.8978 11.5 10.5 11.5H2C1.60218 11.5 1.22064 11.342 0.93934 11.0607C0.658035 10.7794 0.5 10.3978 0.5 10C0.5 9.60218 0.658035 9.22064 0.93934 8.93934C1.22064 8.65804 1.60218 8.5 2 8.5H10.5C10.8978 8.5 11.2794 8.65804 11.5607 8.93934C11.842 9.22064 12 9.60218 12 10ZM2 3.5H18.5C18.8978 3.5 19.2794 3.34196 19.5607 3.06066C19.842 2.77936 20 2.39782 20 2C20 1.60218 19.842 1.22064 19.5607 0.93934C19.2794 0.658035 18.8978 0.5 18.5 0.5H2C1.60218 0.5 1.22064 0.658035 0.93934 0.93934C0.658035 1.22064 0.5 1.60218 0.5 2C0.5 2.39782 0.658035 2.77936 0.93934 3.06066C1.22064 3.34196 1.60218 3.5 2 3.5ZM8.5 16.5H2C1.60218 16.5 1.22064 16.658 0.93934 16.9393C0.658035 17.2206 0.5 17.6022 0.5 18C0.5 18.3978 0.658035 18.7794 0.93934 19.0607C1.22064 19.342 1.60218 19.5 2 19.5H8.5C8.89782 19.5 9.27936 19.342 9.56066 19.0607C9.84196 18.7794 10 18.3978 10 18C10 17.6022 9.84196 17.2206 9.56066 16.9393C9.27936 16.658 8.89782 16.5 8.5 16.5ZM25.0613 13.9387C24.9219 13.7989 24.7563 13.688 24.574 13.6122C24.3917 13.5365 24.1962 13.4976 23.9988 13.4976C23.8013 13.4976 23.6059 13.5365 23.4235 13.6122C23.2412 13.688 23.0756 13.7989 22.9363 13.9387L20.5 16.375V8C20.5 7.60218 20.342 7.22064 20.0607 6.93934C19.7794 6.65804 19.3978 6.5 19 6.5C18.6022 6.5 18.2206 6.65804 17.9393 6.93934C17.658 7.22064 17.5 7.60218 17.5 8V16.375L15.0613 13.935C14.7795 13.6532 14.3973 13.4949 13.9988 13.4949C13.6002 13.4949 13.218 13.6532 12.9363 13.935C12.6545 14.2168 12.4961 14.599 12.4961 14.9975C12.4961 15.396 12.6545 15.7782 12.9363 16.06L17.9363 21.06C18.0756 21.1998 18.2412 21.3108 18.4235 21.3865C18.6059 21.4622 18.8013 21.5012 18.9988 21.5012C19.1962 21.5012 19.3917 21.4622 19.574 21.3865C19.7563 21.3108 19.9219 21.1998 20.0613 21.06L25.0613 16.06C25.3425 15.7787 25.5006 15.3972 25.5006 14.9994C25.5006 14.6016 25.3425 14.2201 25.0613 13.9387Z",fill:e})})}function fs({fillColor:e}){return(0,h.jsx)("svg",{width:"28",height:"26",viewBox:"0 0 28 26",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:(0,h.jsx)("path",{d:"M26.8378 2.41941C26.6419 1.97647 26.3215 1.59997 25.9156 1.33568C25.5098 1.07139 25.0359 0.930682 24.5515 0.930664H2.55152C2.06726 0.930711 1.59344 1.0714 1.18763 1.33563C0.781816 1.59987 0.46148 1.97628 0.265542 2.41912C0.0696046 2.86197 0.00649979 3.35219 0.0838951 3.83022C0.16129 4.30825 0.375854 4.75352 0.701517 5.11191L0.716516 5.12941L9.05152 14.0244V23.4307C9.05145 23.8833 9.17425 24.3274 9.40683 24.7157C9.63941 25.104 9.97303 25.4218 10.3721 25.6353C10.7712 25.8489 11.2207 25.9501 11.6728 25.9281C12.1249 25.9061 12.5625 25.7619 12.939 25.5107L16.939 22.8444C17.2815 22.6159 17.5622 22.3064 17.7563 21.9433C17.9504 21.5802 18.0518 21.1749 18.0515 20.7632V14.0244L26.3853 5.12941L26.4003 5.11191C26.7261 4.75371 26.9409 4.30857 27.0186 3.83059C27.0963 3.35261 27.0334 2.86237 26.8378 2.41941ZM15.7278 12.1169C15.2925 12.5798 15.0506 13.1915 15.0515 13.8269V20.4957L12.0515 22.4957V13.8269C12.0524 13.1915 11.8105 12.5798 11.3753 12.1169L3.70527 3.93066H23.3978L15.7278 12.1169Z",fill:e})})}function gs({fillColor:e}){return(0,h.jsx)("svg",{width:"33",height:"33",viewBox:"0 0 33 33",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:(0,h.jsx)("path",{d:"M28.997 8.88085L23.412 3.2946C23.1798 3.06235 22.9042 2.87811 22.6008 2.75241C22.2974 2.62671 21.9723 2.56201 21.6439 2.56201C21.3155 2.56201 20.9903 2.62671 20.6869 2.75241C20.3836 2.87811 20.1079 3.06235 19.8758 3.2946L4.462 18.7096C4.22901 18.9411 4.04428 19.2165 3.91854 19.5199C3.7928 19.8233 3.72854 20.1487 3.7295 20.4771V26.0634C3.7295 26.7264 3.99289 27.3623 4.46174 27.8311C4.93058 28.3 5.56646 28.5634 6.2295 28.5634H11.8158C12.1442 28.5642 12.4695 28.5 12.7729 28.3742C13.0763 28.2485 13.3517 28.0638 13.5833 27.8309L28.997 12.4159C29.4657 11.947 29.729 11.3113 29.729 10.6484C29.729 9.98544 29.4657 9.34967 28.997 8.88085ZM11.6045 25.5634H6.7295V20.6884L17.2295 10.1884L22.1045 15.0634L11.6045 25.5634ZM24.2295 12.9384L19.3545 8.06335L21.647 5.77085L26.522 10.6459L24.2295 12.9384Z",fill:e})})}const{__:ms}=wp.i18n,vs=function({gridView:e,setTwoColumn:t,setThreeColumn:s,setFourColumn:r,IconComponent:i,selectedCategory:n,selectedCollection:o}){const{patterns:l,getPattern:c,getPatternMeta:d,searchTerm:u,setSearchTerm:f,selectedPatterns:v,setSelectedPatterns:y,selectedPatternsBlocks:w,setSelectedPatternsBlocks:_,patternsToDelete:b,patternsToAdd:k,patternsToAddFavorites:x,patternsToDeleteFavorites:j,loadPatterns:C,setPatternsToAdd:S,setPatternsToDelete:P,setPatternsToAddFavorites:T,setPatternsToDeleteFavorites:E,getCollection:O,getCategory:I,setSortingDirection:$,setSortingField:A,setFilterByDownload:R,setFilterByFavorite:L}=(0,g.useContext)(Ft),[N,M]=(0,g.useState)(!1),[F,B]=(0,g.useState)(ms("Search patterns","ollie-pro")),D=(e,t)=>{$(e),A(t)},U=(e,t)=>{R(e),L(t)};return(0,g.useEffect)((()=>{o&&O(o).then((e=>{B(ms("Search in","ollie-pro")+" "+e.title)})),n&&I(n).then((e=>{B(ms("Search in","ollie-pro")+" "+e.title)})),n||o||B(ms("Search patterns","ollie-pro")),v.length>0?M(!0):M(!1)}),[v,n,o]),(0,h.jsx)("div",{className:"ollie-pattern-multiselect-actions",children:(0,h.jsxs)(m.Flex,{gap:6,children:[(0,h.jsxs)(m.__experimentalHStack,{spacing:"0",expanded:!1,justify:"flex-start",children:[(0,h.jsx)(m.SearchControl,{label:ms("Search patterns","ollie-pro"),placeholder:F,value:u,onChange:e=>{e.length>0?f(e):f("")}}),(0,h.jsxs)(m.__experimentalHStack,{spacing:"0",expanded:!1,justify:"flex-start",className:`ollie-loading-status ${C&&"ollie-loading-status-visible"}`,children:[(0,h.jsx)(m.Spinner,{}),(0,h.jsx)("span",{children:ms("Loading...","ollie-pro")})]})]}),(0,h.jsx)(m.FlexItem,{children:(0,h.jsxs)(m.Flex,{justify:"left",align:"center",className:"ollie-pattern-column-size",gap:"4px",children:[(0,h.jsx)(m.FlexItem,{children:(0,h.jsx)(m.DropdownMenu,{className:"ollie-pattern-column-drop",icon:(0,h.jsx)(gs,{}),text:ms("Bulk Edit","ollie-pro"),children:({onClose:e})=>(0,h.jsxs)(h.Fragment,{children:[(0,h.jsxs)(m.MenuGroup,{className:"ollie-pattern-action-drop",children:[(0,h.jsx)(m.MenuItem,{onClick:()=>{v.forEach((e=>{c(e).then((e=>{d(e.id).then((t=>{t.description&&(e.description=t.description),t.keywords&&(e.keywords=t.keywords);let s=e.slug.replace("/","-");S(k?[...k,s]:[s]),Ht(e)}))}))})),y([])},disabled:!N,iconPosition:"left",children:ms("Add to theme","ollie-pro")}),(0,h.jsx)(m.MenuItem,{onClick:()=>{v.forEach((e=>{c(e).then((e=>{let t=e.slug.replace("/","-");P(b?[...b,t]:[t]),zt(e)}))})),y([])},disabled:!N,iconPosition:"left",children:ms("Remove from theme","ollie-pro")}),(0,h.jsx)(m.MenuItem,{onClick:()=>{(()=>{let e=wp.data.select("core/block-editor").getSelectedBlock(),t=[];w.forEach((e=>{t.push(e[0])})),(0,p.dispatch)("core/block-editor").replaceBlock(e.clientId,t),y([])})()},disabled:!N,iconPosition:"left",children:ms("Insert into current page","ollie-pro")})]}),(0,h.jsxs)(m.MenuGroup,{className:"ollie-pattern-action-drop",children:[(0,h.jsx)(m.MenuItem,{onClick:()=>{(()=>{for(const e of v)c(e).then((e=>{let t=e.slug.replace("/","-");qt(t),T([...x,t])}));y([])})()},disabled:!N,iconPosition:"left",children:ms("Add to favorites","ollie-pro")}),(0,h.jsx)(m.MenuItem,{onClick:()=>{(()=>{for(const e of v)c(e).then((e=>{let t=e.slug.replace("/","-");Jt(t),E([...j,t])}));y([])})()},disabled:!N,iconPosition:"left",children:ms("Remove from favorites","ollie-pro")})]}),(0,h.jsxs)(m.MenuGroup,{className:"ollie-pattern-action-drop",children:[(0,h.jsx)(m.MenuItem,{onClick:()=>{(()=>{let e=[],t=[];l.forEach((s=>{e.push(s.id),t.push((0,a.parse)(s.content))})),y(e),_(t)})()},iconPosition:"left",children:ms("Select All","ollie-pro")}),(0,h.jsx)(m.MenuItem,{onClick:()=>{y([]),_([])},disabled:!N,iconPosition:"left",children:ms("Deselect","ollie-pro")})]})]})})}),(0,h.jsx)(m.FlexItem,{children:(0,h.jsx)(m.DropdownMenu,{className:"ollie-pattern-column-drop",icon:(0,h.jsx)(ps,{}),text:ms("Sort By","ollie-pro"),children:()=>(0,h.jsxs)(h.Fragment,{children:[(0,h.jsxs)(m.MenuGroup,{className:"ollie-pattern-action-drop",children:[(0,h.jsx)(m.MenuItem,{onClick:()=>{D("ascending","title")},children:ms("Ascending","ollie-pro")}),(0,h.jsx)(m.MenuItem,{onClick:()=>{D("descending","title")},children:ms("Descending","ollie-pro")}),(0,h.jsx)(m.MenuItem,{onClick:()=>{D("descending","id")},children:ms("Latest","ollie-pro")})]}),(0,h.jsx)(m.MenuGroup,{className:"ollie-pattern-action-drop",children:(0,h.jsx)(m.MenuItem,{onClick:()=>{D("ascending","slug")},children:ms("Clear sort","ollie-pro")})})]})})}),(0,h.jsx)(m.FlexItem,{children:(0,h.jsx)(m.DropdownMenu,{className:"ollie-pattern-column-drop",icon:fs,text:ms("Filter","ollie-pro"),children:({onClose:e})=>(0,h.jsxs)(h.Fragment,{children:[(0,h.jsxs)(m.MenuGroup,{className:"ollie-pattern-action-drop ollie-pattern-action-drop-filter",children:[(0,h.jsx)(m.MenuItem,{onClick:()=>{U(!1,!0)},children:ms("My Favorites","ollie-pro")}),(0,h.jsx)(m.MenuItem,{onClick:()=>{U(!0,!1)},children:ms("Downloaded to theme","ollie-pro")})]}),(0,h.jsx)(m.MenuGroup,{className:"ollie-pattern-action-drop ollie-pattern-action-drop-filter",children:(0,h.jsx)(m.MenuItem,{onClick:()=>{U(!1,!1)},children:ms("Clear filter","ollie-pro")})})]})})}),(0,h.jsx)(m.FlexItem,{children:(0,h.jsx)(m.DropdownMenu,{className:"ollie-pattern-column-drop",icon:i,text:ms("Grid View","ollie-pro"),children:({onClose:i})=>(0,h.jsx)(h.Fragment,{children:(0,h.jsxs)(m.MenuGroup,{className:"ollie-pattern-action-drop",children:[(0,h.jsx)(m.MenuItem,{icon:(0,h.jsx)(hs,{}),iconPosition:"left",onClick:t,className:2===e?"ollie-menu-active":"",children:ms("2 Column","ollie-pro")}),(0,h.jsx)(m.MenuItem,{icon:(0,h.jsx)(ds,{}),iconPosition:"left",onClick:s,className:3===e?"ollie-menu-active":"",children:ms("3 Column","ollie-pro")}),(0,h.jsx)(m.MenuItem,{icon:(0,h.jsx)(us,{}),iconPosition:"left",onClick:r,className:4===e?"ollie-menu-active":"",children:ms("4 Column","ollie-pro")})]})})})})]})})]})})},ys=(0,h.jsx)(c.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",children:(0,h.jsx)(c.Path,{d:"M10.6 6L9.4 7l4.6 5-4.6 5 1.2 1 5.4-6z"})}),{__:ws}=wp.i18n,_s=function(){const{getPatterns:e,selectedCollection:t,selectedCategory:s,filterByFavorite:r,filterByDownload:i,sortingDirection:n,sortingField:o,searchTerm:a,patterns:l,getPatternMeta:c,selectedPatterns:d,getRelatedCategories:u,getRelatedCollection:p,getCollection:f,setIsPreview:v,isPreview:y,previewPattern:w,setPreviewPattern:_,setPage:b,page:k,setPerPage:x,perPage:j,maxPages:C,totalPatterns:S}=(0,g.useContext)(Ft),[P,T]=(0,g.useState)((()=>{const e=localStorage.getItem("ollie-pattern-view");return null!==e?Number(e):3}));let E;switch((0,g.useEffect)((()=>{const e=document.getElementById("ollie-grid-area");e&&e.scrollIntoView({block:"start"})}),[k]),P){case 2:E=(0,h.jsx)(hs,{});break;case 3:default:E=(0,h.jsx)(ds,{});break;case 4:E=(0,h.jsx)(us,{})}const O=e=>{c(e.id).then((t=>{t.description&&(e.description=t.description),t.keywords&&(e.keywords=t.keywords),p(e.id).then((t=>{f(t.collection_id).then((t=>{e.collection={id:t.id,title:t.title},u(e.id).then((t=>{e.categories=t,_(e),v(!0)}))}))}))}))},I=e=>!!d.includes(e);return(0,g.useEffect)((()=>{localStorage.setItem("ollie-pattern-view",P),e()}),[k,j,P,s,t,a,o,n,i,r]),(0,h.jsx)("div",{className:"ollie-pattern-columns",children:l&&(0,h.jsx)(h.Fragment,{children:y?(0,h.jsxs)(h.Fragment,{children:[(0,h.jsx)(Xt,{pattern:w}),(0,h.jsx)("div",{style:{width:"100%"},children:(0,h.jsx)(rs,{pattern:w})})]}):(0,h.jsxs)(h.Fragment,{children:[(0,h.jsx)(Xt,{pattern:!1}),(0,h.jsx)("div",{style:{width:"100%"},children:(0,h.jsxs)("div",{id:"ollie-grid-area",children:[(0,h.jsx)(vs,{setTwoColumn:()=>{T(2)},setThreeColumn:()=>{T(3)},setFourColumn:()=>{T(4)},gridView:P,IconComponent:E,selectedCategory:s,selectedCollection:t}),a&&0===l.length&&(0,h.jsx)("p",{children:ws("No patterns found.","ollie-pro")}),(0,h.jsx)(m.__experimentalGrid,{id:"ollie-pattern-grid",className:`ollie-pattern-grid ollie-pattern-column-${P}`,columns:P,gap:8,children:l.map((e=>(0,h.jsx)(cs,{pattern:e,isPatternSelected:I,preparePreview:O,gridView:P},e.id)))}),l&&l.length>0&&!r&&!i&&!a&&(0,h.jsxs)(m.Flex,{className:"ollie-pagination-container",children:[(0,h.jsx)(m.FlexItem,{alignment:"center",justify:"flex-start",spacing:2,children:(0,h.jsxs)("p",{children:[ws("Showing","ollie-pro")," ",l.length," ",ws("of","ollie-pro")," ",S]})}),(0,h.jsx)(m.FlexBlock,{children:(0,h.jsx)("ul",{className:"ollie-pagination",children:(()=>{let e=[];e.push((0,h.jsx)("li",{children:(0,h.jsx)(m.Button,{className:1===k?"disabled":"",onClick:()=>{k>1&&b(k-1)},icon:Wt,label:ws("Previous","ollie-pro")})},"prev"));let t=Math.max(1,k-2),s=Math.min(C,t+4);s===C&&(t=Math.max(1,s-4)),t>1&&(e.push((0,h.jsx)("li",{children:(0,h.jsx)("a",{onClick:()=>b(1),children:"1"})},"start-ellipsis")),e.push((0,h.jsx)("li",{children:(0,h.jsx)("span",{className:"ellipsis",children:"..."})},"start-dots")));for(let r=t;r<=s;r++)e.push((0,h.jsx)("li",{children:(0,h.jsx)("a",{className:r===k?"current-page":"",onClick:()=>b(r),children:r})},r));return s<C&&(e.push((0,h.jsx)("li",{children:(0,h.jsx)("span",{className:"ellipsis",children:"..."})},"end-dots")),e.push((0,h.jsx)("li",{children:(0,h.jsx)("a",{onClick:()=>b(C),children:C})},"end-page"))),e.push((0,h.jsx)("li",{children:(0,h.jsx)(m.Button,{className:k===C?"disabled":"",onClick:()=>{k<C&&b(k+1)},icon:ys,iconPosition:"right",label:ws("Next","ollie-pro")})},"next")),e})()})}),(0,h.jsx)(m.FlexItem,{children:(0,h.jsxs)(m.__experimentalHStack,{alignment:"center",justify:"flex-start",spacing:2,children:[(0,h.jsx)("p",{children:ws("Per page:","ollie-pro")}),(0,h.jsx)(m.SelectControl,{value:j,options:[{label:"20",value:20},{label:"50",value:50},{label:"100",value:100}],onChange:e=>x(e)})]})})]})]})})]})})})},{__:bs}=wp.i18n,ks=function({openModal:e,session:t}){return(0,h.jsx)(h.Fragment,{children:t?(0,h.jsx)(m.Placeholder,{icon:d,instructions:bs("Browse the patterns available in Ollie pattern library and download them to your site.","ollie-pro"),label:bs("Ollie Pattern Library","ollie-pro"),className:"ollie-quick-inserter",children:(0,h.jsx)(m.__experimentalVStack,{spacing:"6",children:(0,h.jsx)("div",{children:(0,h.jsx)(m.Button,{className:"has-text",iconSize:18,variant:"primary",onClick:e,text:bs("Open Ollie Pattern Library","ollie-pro")})})})}):(0,h.jsx)(m.Placeholder,{icon:d,instructions:bs("Please navigate to Appearance -> Ollie and sign in to your account to access our libary.","ollie-pro"),label:bs("Ollie Pattern Library","ollie-pro"),className:"ollie-quick-inserter"})})},{__:xs}=wp.i18n,js=function(){const[e,t]=(0,g.useState)(!1),[s,r]=(0,g.useState)((()=>{const t=localStorage.getItem("ollie-pattern-modal");if(e){if("yes"===t)return!0;if("no"===t)return!1;if(null===t)return localStorage.setItem("ollie-pattern-modal","yes"),!0}}));return(0,g.useEffect)((()=>{e||Mt.auth.getSession().then((({data:{session:e}})=>{if(e)t(e),r(!0);else{let e=ollie_pattern_options;""!==e.email&&""!==e.password&&Mt.auth.signInWithPassword({email:e.email,password:e.password}).then((({session:e})=>{t(e),r(!0)}))}}))}),[e]),(0,h.jsx)(h.Fragment,{children:(0,h.jsx)(Bt,{isModalOpen:s,children:s?(0,h.jsx)(m.Modal,{className:"ollie-pattern-modal",title:"Ollie Pro Patterns",onRequestClose:()=>{r(!1)},children:(0,h.jsx)("div",{className:"ollie-modal-container",children:(0,h.jsx)(_s,{})})}):(0,h.jsx)(ks,{openModal:()=>{r(!0)},session:e})})})},{__:Cs}=wp.i18n;(0,a.getBlockType)("ollie/pattern-block")||(0,a.registerBlockType)(l.UU,{title:"Ollie Pattern Library",icon:d,edit:function(){return(0,h.jsx)("div",{...(0,y.useBlockProps)(),children:(0,h.jsx)(js,{})})},save:function(){return null}})})();