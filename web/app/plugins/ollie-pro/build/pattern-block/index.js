(()=>{"use strict";var e,t,r,s,n={907:(e,t,r)=>{r.r(t),r.d(t,{Headers:()=>o,Request:()=>a,Response:()=>l,default:()=>i,fetch:()=>n});var s=function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==r.g)return r.g;throw new Error("unable to locate global object")}();const n=s.fetch,i=s.fetch.bind(s),o=s.Headers,a=s.Request,l=s.Response},660:function(e,t,r){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=s(r(907)),i=s(r(818));t.default=class{constructor(e){this.shouldThrowOnError=!1,this.method=e.method,this.url=e.url,this.headers=e.headers,this.schema=e.schema,this.body=e.body,this.shouldThrowOnError=e.shouldThrowOnError,this.signal=e.signal,this.isMaybeSingle=e.isMaybeSingle,e.fetch?this.fetch=e.fetch:"undefined"==typeof fetch?this.fetch=n.default:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(e,t){return this.headers=Object.assign({},this.headers),this.headers[e]=t,this}then(e,t){void 0===this.schema||(["GET","HEAD"].includes(this.method)?this.headers["Accept-Profile"]=this.schema:this.headers["Content-Profile"]=this.schema),"GET"!==this.method&&"HEAD"!==this.method&&(this.headers["Content-Type"]="application/json");let r=(0,this.fetch)(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then((async e=>{var t,r,s;let n=null,o=null,a=null,l=e.status,c=e.statusText;if(e.ok){if("HEAD"!==this.method){const t=await e.text();""===t||(o="text/csv"===this.headers.Accept||this.headers.Accept&&this.headers.Accept.includes("application/vnd.pgrst.plan+text")?t:JSON.parse(t))}const s=null===(t=this.headers.Prefer)||void 0===t?void 0:t.match(/count=(exact|planned|estimated)/),i=null===(r=e.headers.get("content-range"))||void 0===r?void 0:r.split("/");s&&i&&i.length>1&&(a=parseInt(i[1])),this.isMaybeSingle&&"GET"===this.method&&Array.isArray(o)&&(o.length>1?(n={code:"PGRST116",details:`Results contain ${o.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},o=null,a=null,l=406,c="Not Acceptable"):o=1===o.length?o[0]:null)}else{const t=await e.text();try{n=JSON.parse(t),Array.isArray(n)&&404===e.status&&(o=[],n=null,l=200,c="OK")}catch(r){404===e.status&&""===t?(l=204,c="No Content"):n={message:t}}if(n&&this.isMaybeSingle&&(null===(s=null==n?void 0:n.details)||void 0===s?void 0:s.includes("0 rows"))&&(n=null,l=200,c="OK"),n&&this.shouldThrowOnError)throw new i.default(n)}return{error:n,data:o,count:a,status:l,statusText:c}}));return this.shouldThrowOnError||(r=r.catch((e=>{var t,r,s;return{error:{message:`${null!==(t=null==e?void 0:e.name)&&void 0!==t?t:"FetchError"}: ${null==e?void 0:e.message}`,details:`${null!==(r=null==e?void 0:e.stack)&&void 0!==r?r:""}`,hint:"",code:`${null!==(s=null==e?void 0:e.code)&&void 0!==s?s:""}`},data:null,count:null,status:0,statusText:""}}))),r.then(e,t)}}},961:function(e,t,r){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=s(r(45)),i=s(r(825)),o=r(530);class a{constructor(e,{headers:t={},schema:r,fetch:s}={}){this.url=e,this.headers=Object.assign(Object.assign({},o.DEFAULT_HEADERS),t),this.schemaName=r,this.fetch=s}from(e){const t=new URL(`${this.url}/${e}`);return new n.default(t,{headers:Object.assign({},this.headers),schema:this.schemaName,fetch:this.fetch})}schema(e){return new a(this.url,{headers:this.headers,schema:e,fetch:this.fetch})}rpc(e,t={},{head:r=!1,get:s=!1,count:n}={}){let o;const a=new URL(`${this.url}/rpc/${e}`);let l;r||s?(o=r?"HEAD":"GET",Object.entries(t).filter((([e,t])=>void 0!==t)).map((([e,t])=>[e,Array.isArray(t)?`{${t.join(",")}}`:`${t}`])).forEach((([e,t])=>{a.searchParams.append(e,t)}))):(o="POST",l=t);const c=Object.assign({},this.headers);return n&&(c.Prefer=`count=${n}`),new i.default({method:o,url:a,headers:c,schema:this.schemaName,body:l,fetch:this.fetch,allowEmpty:!1})}}t.default=a},818:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0});class r extends Error{constructor(e){super(e.message),this.name="PostgrestError",this.details=e.details,this.hint=e.hint,this.code=e.code}}t.default=r},825:function(e,t,r){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=s(r(261));class i extends n.default{eq(e,t){return this.url.searchParams.append(e,`eq.${t}`),this}neq(e,t){return this.url.searchParams.append(e,`neq.${t}`),this}gt(e,t){return this.url.searchParams.append(e,`gt.${t}`),this}gte(e,t){return this.url.searchParams.append(e,`gte.${t}`),this}lt(e,t){return this.url.searchParams.append(e,`lt.${t}`),this}lte(e,t){return this.url.searchParams.append(e,`lte.${t}`),this}like(e,t){return this.url.searchParams.append(e,`like.${t}`),this}likeAllOf(e,t){return this.url.searchParams.append(e,`like(all).{${t.join(",")}}`),this}likeAnyOf(e,t){return this.url.searchParams.append(e,`like(any).{${t.join(",")}}`),this}ilike(e,t){return this.url.searchParams.append(e,`ilike.${t}`),this}ilikeAllOf(e,t){return this.url.searchParams.append(e,`ilike(all).{${t.join(",")}}`),this}ilikeAnyOf(e,t){return this.url.searchParams.append(e,`ilike(any).{${t.join(",")}}`),this}is(e,t){return this.url.searchParams.append(e,`is.${t}`),this}in(e,t){const r=Array.from(new Set(t)).map((e=>"string"==typeof e&&new RegExp("[,()]").test(e)?`"${e}"`:`${e}`)).join(",");return this.url.searchParams.append(e,`in.(${r})`),this}contains(e,t){return"string"==typeof t?this.url.searchParams.append(e,`cs.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cs.{${t.join(",")}}`):this.url.searchParams.append(e,`cs.${JSON.stringify(t)}`),this}containedBy(e,t){return"string"==typeof t?this.url.searchParams.append(e,`cd.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cd.{${t.join(",")}}`):this.url.searchParams.append(e,`cd.${JSON.stringify(t)}`),this}rangeGt(e,t){return this.url.searchParams.append(e,`sr.${t}`),this}rangeGte(e,t){return this.url.searchParams.append(e,`nxl.${t}`),this}rangeLt(e,t){return this.url.searchParams.append(e,`sl.${t}`),this}rangeLte(e,t){return this.url.searchParams.append(e,`nxr.${t}`),this}rangeAdjacent(e,t){return this.url.searchParams.append(e,`adj.${t}`),this}overlaps(e,t){return"string"==typeof t?this.url.searchParams.append(e,`ov.${t}`):this.url.searchParams.append(e,`ov.{${t.join(",")}}`),this}textSearch(e,t,{config:r,type:s}={}){let n="";"plain"===s?n="pl":"phrase"===s?n="ph":"websearch"===s&&(n="w");const i=void 0===r?"":`(${r})`;return this.url.searchParams.append(e,`${n}fts${i}.${t}`),this}match(e){return Object.entries(e).forEach((([e,t])=>{this.url.searchParams.append(e,`eq.${t}`)})),this}not(e,t,r){return this.url.searchParams.append(e,`not.${t}.${r}`),this}or(e,{foreignTable:t,referencedTable:r=t}={}){const s=r?`${r}.or`:"or";return this.url.searchParams.append(s,`(${e})`),this}filter(e,t,r){return this.url.searchParams.append(e,`${t}.${r}`),this}}t.default=i},45:function(e,t,r){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=s(r(825));t.default=class{constructor(e,{headers:t={},schema:r,fetch:s}){this.url=e,this.headers=t,this.schema=r,this.fetch=s}select(e,{head:t=!1,count:r}={}){const s=t?"HEAD":"GET";let i=!1;const o=(null!=e?e:"*").split("").map((e=>/\s/.test(e)&&!i?"":('"'===e&&(i=!i),e))).join("");return this.url.searchParams.set("select",o),r&&(this.headers.Prefer=`count=${r}`),new n.default({method:s,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}insert(e,{count:t,defaultToNull:r=!0}={}){const s=[];if(this.headers.Prefer&&s.push(this.headers.Prefer),t&&s.push(`count=${t}`),r||s.push("missing=default"),this.headers.Prefer=s.join(","),Array.isArray(e)){const t=e.reduce(((e,t)=>e.concat(Object.keys(t))),[]);if(t.length>0){const e=[...new Set(t)].map((e=>`"${e}"`));this.url.searchParams.set("columns",e.join(","))}}return new n.default({method:"POST",url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}upsert(e,{onConflict:t,ignoreDuplicates:r=!1,count:s,defaultToNull:i=!0}={}){const o=[`resolution=${r?"ignore":"merge"}-duplicates`];if(void 0!==t&&this.url.searchParams.set("on_conflict",t),this.headers.Prefer&&o.push(this.headers.Prefer),s&&o.push(`count=${s}`),i||o.push("missing=default"),this.headers.Prefer=o.join(","),Array.isArray(e)){const t=e.reduce(((e,t)=>e.concat(Object.keys(t))),[]);if(t.length>0){const e=[...new Set(t)].map((e=>`"${e}"`));this.url.searchParams.set("columns",e.join(","))}}return new n.default({method:"POST",url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}update(e,{count:t}={}){const r=[];return this.headers.Prefer&&r.push(this.headers.Prefer),t&&r.push(`count=${t}`),this.headers.Prefer=r.join(","),new n.default({method:"PATCH",url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}delete({count:e}={}){const t=[];return e&&t.push(`count=${e}`),this.headers.Prefer&&t.unshift(this.headers.Prefer),this.headers.Prefer=t.join(","),new n.default({method:"DELETE",url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}}},261:function(e,t,r){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=s(r(660));class i extends n.default{select(e){let t=!1;const r=(null!=e?e:"*").split("").map((e=>/\s/.test(e)&&!t?"":('"'===e&&(t=!t),e))).join("");return this.url.searchParams.set("select",r),this.headers.Prefer&&(this.headers.Prefer+=","),this.headers.Prefer+="return=representation",this}order(e,{ascending:t=!0,nullsFirst:r,foreignTable:s,referencedTable:n=s}={}){const i=n?`${n}.order`:"order",o=this.url.searchParams.get(i);return this.url.searchParams.set(i,`${o?`${o},`:""}${e}.${t?"asc":"desc"}${void 0===r?"":r?".nullsfirst":".nullslast"}`),this}limit(e,{foreignTable:t,referencedTable:r=t}={}){const s=void 0===r?"limit":`${r}.limit`;return this.url.searchParams.set(s,`${e}`),this}range(e,t,{foreignTable:r,referencedTable:s=r}={}){const n=void 0===s?"offset":`${s}.offset`,i=void 0===s?"limit":`${s}.limit`;return this.url.searchParams.set(n,`${e}`),this.url.searchParams.set(i,""+(t-e+1)),this}abortSignal(e){return this.signal=e,this}single(){return this.headers.Accept="application/vnd.pgrst.object+json",this}maybeSingle(){return"GET"===this.method?this.headers.Accept="application/json":this.headers.Accept="application/vnd.pgrst.object+json",this.isMaybeSingle=!0,this}csv(){return this.headers.Accept="text/csv",this}geojson(){return this.headers.Accept="application/geo+json",this}explain({analyze:e=!1,verbose:t=!1,settings:r=!1,buffers:s=!1,wal:n=!1,format:i="text"}={}){var o;const a=[e?"analyze":null,t?"verbose":null,r?"settings":null,s?"buffers":null,n?"wal":null].filter(Boolean).join("|"),l=null!==(o=this.headers.Accept)&&void 0!==o?o:"application/json";return this.headers.Accept=`application/vnd.pgrst.plan+${i}; for="${l}"; options=${a};`,this}rollback(){var e;return(null!==(e=this.headers.Prefer)&&void 0!==e?e:"").trim().length>0?this.headers.Prefer+=",tx=rollback":this.headers.Prefer="tx=rollback",this}returns(){return this}}t.default=i},530:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DEFAULT_HEADERS=void 0;const s=r(519);t.DEFAULT_HEADERS={"X-Client-Info":`postgrest-js/${s.version}`}},279:function(e,t,r){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.PostgrestError=t.PostgrestBuilder=t.PostgrestTransformBuilder=t.PostgrestFilterBuilder=t.PostgrestQueryBuilder=t.PostgrestClient=void 0;const n=s(r(961));t.PostgrestClient=n.default;const i=s(r(45));t.PostgrestQueryBuilder=i.default;const o=s(r(825));t.PostgrestFilterBuilder=o.default;const a=s(r(261));t.PostgrestTransformBuilder=a.default;const l=s(r(660));t.PostgrestBuilder=l.default;const c=s(r(818));t.PostgrestError=c.default,t.default={PostgrestClient:n.default,PostgrestQueryBuilder:i.default,PostgrestFilterBuilder:o.default,PostgrestTransformBuilder:a.default,PostgrestBuilder:l.default,PostgrestError:c.default}},519:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.version=void 0,t.version="0.0.0-automated"}},i={};function o(e){var t=i[e];if(void 0!==t)return t.exports;var r=i[e]={exports:{}};return n[e].call(r.exports,r,r.exports,o),r.exports}o.m=n,o.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return o.d(t,{a:t}),t},t=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__,o.t=function(r,s){if(1&s&&(r=this(r)),8&s)return r;if("object"==typeof r&&r){if(4&s&&r.__esModule)return r;if(16&s&&"function"==typeof r.then)return r}var n=Object.create(null);o.r(n);var i={};e=e||[null,t({}),t([]),t(t)];for(var a=2&s&&r;"object"==typeof a&&!~e.indexOf(a);a=t(a))Object.getOwnPropertyNames(a).forEach((e=>i[e]=()=>r[e]));return i.default=()=>r,o.d(n,i),n},o.d=(e,t)=>{for(var r in t)o.o(t,r)&&!o.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},o.f={},o.e=e=>Promise.all(Object.keys(o.f).reduce(((t,r)=>(o.f[r](e,t),t)),[])),o.u=e=>e+".js",o.miniCssF=e=>{},o.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),o.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r={},s="ollie-pro:",o.l=(e,t,n,i)=>{if(r[e])r[e].push(t);else{var a,l;if(void 0!==n)for(var c=document.getElementsByTagName("script"),h=0;h<c.length;h++){var u=c[h];if(u.getAttribute("src")==e||u.getAttribute("data-webpack")==s+n){a=u;break}}a||(l=!0,(a=document.createElement("script")).charset="utf-8",a.timeout=120,o.nc&&a.setAttribute("nonce",o.nc),a.setAttribute("data-webpack",s+n),a.src=e),r[e]=[t];var d=(t,s)=>{a.onerror=a.onload=null,clearTimeout(p);var n=r[e];if(delete r[e],a.parentNode&&a.parentNode.removeChild(a),n&&n.forEach((e=>e(s))),t)return t(s)},p=setTimeout(d.bind(null,void 0,{type:"timeout",target:a}),12e4);a.onerror=d.bind(null,a.onerror),a.onload=d.bind(null,a.onload),l&&document.head.appendChild(a)}},o.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e;o.g.importScripts&&(e=o.g.location+"");var t=o.g.document;if(!e&&t&&(t.currentScript&&"SCRIPT"===t.currentScript.tagName.toUpperCase()&&(e=t.currentScript.src),!e)){var r=t.getElementsByTagName("script");if(r.length)for(var s=r.length-1;s>-1&&(!e||!/^http(s?):/.test(e));)e=r[s--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),o.p=e+"../"})(),(()=>{var e={502:0};o.f.j=(t,r)=>{var s=o.o(e,t)?e[t]:void 0;if(0!==s)if(s)r.push(s[2]);else{var n=new Promise(((r,n)=>s=e[t]=[r,n]));r.push(s[2]=n);var i=o.p+o.u(t),a=new Error;o.l(i,(r=>{if(o.o(e,t)&&(0!==(s=e[t])&&(e[t]=void 0),s)){var n=r&&("load"===r.type?"missing":r.type),i=r&&r.target&&r.target.src;a.message="Loading chunk "+t+" failed.\n("+n+": "+i+")",a.name="ChunkLoadError",a.type=n,a.request=i,s[1](a)}}),"chunk-"+t,t)}};var t=(t,r)=>{var s,n,i=r[0],a=r[1],l=r[2],c=0;if(i.some((t=>0!==e[t]))){for(s in a)o.o(a,s)&&(o.m[s]=a[s]);l&&l(o)}for(t&&t(r);c<i.length;c++)n=i[c],o.o(e,n)&&e[n]&&e[n][0](),e[n]=0},r=self.webpackChunkollie_pro=self.webpackChunkollie_pro||[];r.forEach(t.bind(null,0)),r.push=t.bind(null,r.push.bind(r))})();const a=window.React,l=window.wp.blocks,c=JSON.parse('{"UU":"ollie/pattern-block"}'),h=window.wp.blockEditor,u=window.wp.element,d=window.wp.components;class p extends Error{constructor(e,t="FunctionsError",r){super(e),this.name=t,this.context=r}}class f extends p{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class m extends p{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class g extends p{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var v;!function(e){e.Any="any",e.ApNortheast1="ap-northeast-1",e.ApNortheast2="ap-northeast-2",e.ApSouth1="ap-south-1",e.ApSoutheast1="ap-southeast-1",e.ApSoutheast2="ap-southeast-2",e.CaCentral1="ca-central-1",e.EuCentral1="eu-central-1",e.EuWest1="eu-west-1",e.EuWest2="eu-west-2",e.EuWest3="eu-west-3",e.SaEast1="sa-east-1",e.UsEast1="us-east-1",e.UsWest1="us-west-1",e.UsWest2="us-west-2"}(v||(v={}));class w{constructor(e,{headers:t={},customFetch:r,region:s=v.Any}={}){this.url=e,this.headers=t,this.region=s,this.fetch=(e=>{let t;return t=e||("undefined"==typeof fetch?(...e)=>Promise.resolve().then(o.bind(o,907)).then((({default:t})=>t(...e))):fetch),(...e)=>t(...e)})(r)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e,t={}){var r,s,n,i,o;return s=this,n=void 0,o=function*(){try{const{headers:s,method:n,body:i}=t;let o,a={},{region:l}=t;l||(l=this.region),l&&"any"!==l&&(a["x-region"]=l),i&&(s&&!Object.prototype.hasOwnProperty.call(s,"Content-Type")||!s)&&("undefined"!=typeof Blob&&i instanceof Blob||i instanceof ArrayBuffer?(a["Content-Type"]="application/octet-stream",o=i):"string"==typeof i?(a["Content-Type"]="text/plain",o=i):"undefined"!=typeof FormData&&i instanceof FormData?o=i:(a["Content-Type"]="application/json",o=JSON.stringify(i)));const c=yield this.fetch(`${this.url}/${e}`,{method:n||"POST",headers:Object.assign(Object.assign(Object.assign({},a),this.headers),s),body:o}).catch((e=>{throw new f(e)})),h=c.headers.get("x-relay-error");if(h&&"true"===h)throw new m(c);if(!c.ok)throw new g(c);let u,d=(null!==(r=c.headers.get("Content-Type"))&&void 0!==r?r:"text/plain").split(";")[0].trim();return u="application/json"===d?yield c.json():"application/octet-stream"===d?yield c.blob():"text/event-stream"===d?c:"multipart/form-data"===d?yield c.formData():yield c.text(),{data:u,error:null}}catch(e){return{data:null,error:e}}},new((i=void 0)||(i=Promise))((function(e,t){function r(e){try{l(o.next(e))}catch(e){t(e)}}function a(e){try{l(o.throw(e))}catch(e){t(e)}}function l(t){var s;t.done?e(t.value):(s=t.value,s instanceof i?s:new i((function(e){e(s)}))).then(r,a)}l((o=o.apply(s,n||[])).next())}))}}var y=o(279);const{PostgrestClient:_,PostgrestQueryBuilder:b,PostgrestFilterBuilder:k,PostgrestTransformBuilder:C,PostgrestBuilder:E}=y,S={"X-Client-Info":"realtime-js/2.10.7"};var P,T,x,j,O,$,I;!function(e){e[e.connecting=0]="connecting",e[e.open=1]="open",e[e.closing=2]="closing",e[e.closed=3]="closed"}(P||(P={})),(I=T||(T={})).closed="closed",I.errored="errored",I.joined="joined",I.joining="joining",I.leaving="leaving",function(e){e.close="phx_close",e.error="phx_error",e.join="phx_join",e.reply="phx_reply",e.leave="phx_leave",e.access_token="access_token"}(x||(x={})),function(e){e.websocket="websocket"}(j||(j={})),function(e){e.Connecting="connecting",e.Open="open",e.Closing="closing",e.Closed="closed"}(O||(O={}));class A{constructor(){this.HEADER_LENGTH=1}decode(e,t){return e.constructor===ArrayBuffer?t(this._binaryDecode(e)):t("string"==typeof e?JSON.parse(e):{})}_binaryDecode(e){const t=new DataView(e),r=new TextDecoder;return this._decodeBroadcast(e,t,r)}_decodeBroadcast(e,t,r){const s=t.getUint8(1),n=t.getUint8(2);let i=this.HEADER_LENGTH+2;const o=r.decode(e.slice(i,i+s));i+=s;const a=r.decode(e.slice(i,i+n));return i+=n,{ref:null,topic:o,event:a,payload:JSON.parse(r.decode(e.slice(i,e.byteLength)))}}}class R{constructor(e,t){this.callback=e,this.timerCalc=t,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=t}reset(){this.tries=0,clearTimeout(this.timer)}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout((()=>{this.tries=this.tries+1,this.callback()}),this.timerCalc(this.tries+1))}}!function(e){e.abstime="abstime",e.bool="bool",e.date="date",e.daterange="daterange",e.float4="float4",e.float8="float8",e.int2="int2",e.int4="int4",e.int4range="int4range",e.int8="int8",e.int8range="int8range",e.json="json",e.jsonb="jsonb",e.money="money",e.numeric="numeric",e.oid="oid",e.reltime="reltime",e.text="text",e.time="time",e.timestamp="timestamp",e.timestamptz="timestamptz",e.timetz="timetz",e.tsrange="tsrange",e.tstzrange="tstzrange"}($||($={}));const L=(e,t,r={})=>{var s;const n=null!==(s=r.skipTypes)&&void 0!==s?s:[];return Object.keys(t).reduce(((r,s)=>(r[s]=M(s,e,t,n),r)),{})},M=(e,t,r,s)=>{const n=t.find((t=>t.name===e)),i=null==n?void 0:n.type,o=r[e];return i&&!s.includes(i)?N(i,o):F(o)},N=(e,t)=>{if("_"===e.charAt(0)){const r=e.slice(1,e.length);return B(t,r)}switch(e){case $.bool:return D(t);case $.float4:case $.float8:case $.int2:case $.int4:case $.int8:case $.numeric:case $.oid:return U(t);case $.json:case $.jsonb:return H(t);case $.timestamp:return z(t);case $.abstime:case $.date:case $.daterange:case $.int4range:case $.int8range:case $.money:case $.reltime:case $.text:case $.time:case $.timestamptz:case $.timetz:case $.tsrange:case $.tstzrange:default:return F(t)}},F=e=>e,D=e=>{switch(e){case"t":return!0;case"f":return!1;default:return e}},U=e=>{if("string"==typeof e){const t=parseFloat(e);if(!Number.isNaN(t))return t}return e},H=e=>{if("string"==typeof e)try{return JSON.parse(e)}catch(t){return console.log(`JSON parse error: ${t}`),e}return e},B=(e,t)=>{if("string"!=typeof e)return e;const r=e.length-1,s=e[r];if("{"===e[0]&&"}"===s){let s;const n=e.slice(1,r);try{s=JSON.parse("["+n+"]")}catch(e){s=n?n.split(","):[]}return s.map((e=>N(t,e)))}return e},z=e=>"string"==typeof e?e.replace(" ","T"):e,V=e=>{let t=e;return t=t.replace(/^ws/i,"http"),t=t.replace(/(\/socket\/websocket|\/socket|\/websocket)\/?$/i,""),t.replace(/\/+$/,"")};class q{constructor(e,t,r={},s=1e4){this.channel=e,this.event=t,this.payload=r,this.timeout=s,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,t){var r;return this._hasReceived(e)&&t(null===(r=this.receivedResp)||void 0===r?void 0:r.response),this.recHooks.push({status:e,callback:t}),this}startTimeout(){this.timeoutTimer||(this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref),this.channel._on(this.refEvent,{},(e=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=e,this._matchReceive(e)})),this.timeoutTimer=setTimeout((()=>{this.trigger("timeout",{})}),this.timeout))}trigger(e,t){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:t})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:t}){this.recHooks.filter((t=>t.status===e)).forEach((e=>e.callback(t)))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var G,J,K,W;!function(e){e.SYNC="sync",e.JOIN="join",e.LEAVE="leave"}(G||(G={}));class Z{constructor(e,t){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const r=(null==t?void 0:t.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(r.state,{},(e=>{const{onJoin:t,onLeave:r,onSync:s}=this.caller;this.joinRef=this.channel._joinRef(),this.state=Z.syncState(this.state,e,t,r),this.pendingDiffs.forEach((e=>{this.state=Z.syncDiff(this.state,e,t,r)})),this.pendingDiffs=[],s()})),this.channel._on(r.diff,{},(e=>{const{onJoin:t,onLeave:r,onSync:s}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(e):(this.state=Z.syncDiff(this.state,e,t,r),s())})),this.onJoin(((e,t,r)=>{this.channel._trigger("presence",{event:"join",key:e,currentPresences:t,newPresences:r})})),this.onLeave(((e,t,r)=>{this.channel._trigger("presence",{event:"leave",key:e,currentPresences:t,leftPresences:r})})),this.onSync((()=>{this.channel._trigger("presence",{event:"sync"})}))}static syncState(e,t,r,s){const n=this.cloneDeep(e),i=this.transformState(t),o={},a={};return this.map(n,((e,t)=>{i[e]||(a[e]=t)})),this.map(i,((e,t)=>{const r=n[e];if(r){const s=t.map((e=>e.presence_ref)),n=r.map((e=>e.presence_ref)),i=t.filter((e=>n.indexOf(e.presence_ref)<0)),l=r.filter((e=>s.indexOf(e.presence_ref)<0));i.length>0&&(o[e]=i),l.length>0&&(a[e]=l)}else o[e]=t})),this.syncDiff(n,{joins:o,leaves:a},r,s)}static syncDiff(e,t,r,s){const{joins:n,leaves:i}={joins:this.transformState(t.joins),leaves:this.transformState(t.leaves)};return r||(r=()=>{}),s||(s=()=>{}),this.map(n,((t,s)=>{var n;const i=null!==(n=e[t])&&void 0!==n?n:[];if(e[t]=this.cloneDeep(s),i.length>0){const r=e[t].map((e=>e.presence_ref)),s=i.filter((e=>r.indexOf(e.presence_ref)<0));e[t].unshift(...s)}r(t,i,s)})),this.map(i,((t,r)=>{let n=e[t];if(!n)return;const i=r.map((e=>e.presence_ref));n=n.filter((e=>i.indexOf(e.presence_ref)<0)),e[t]=n,s(t,n,r),0===n.length&&delete e[t]})),e}static map(e,t){return Object.getOwnPropertyNames(e).map((r=>t(r,e[r])))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce(((t,r)=>{const s=e[r];return t[r]="metas"in s?s.metas.map((e=>(e.presence_ref=e.phx_ref,delete e.phx_ref,delete e.phx_ref_prev,e))):s,t}),{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}!function(e){e.ALL="*",e.INSERT="INSERT",e.UPDATE="UPDATE",e.DELETE="DELETE"}(J||(J={})),function(e){e.BROADCAST="broadcast",e.PRESENCE="presence",e.POSTGRES_CHANGES="postgres_changes",e.SYSTEM="system"}(K||(K={})),function(e){e.SUBSCRIBED="SUBSCRIBED",e.TIMED_OUT="TIMED_OUT",e.CLOSED="CLOSED",e.CHANNEL_ERROR="CHANNEL_ERROR"}(W||(W={}));class Y{constructor(e,t={config:{}},r){this.topic=e,this.params=t,this.socket=r,this.bindings={},this.state=T.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:""},private:!1},t.config),this.timeout=this.socket.timeout,this.joinPush=new q(this,x.join,this.params,this.timeout),this.rejoinTimer=new R((()=>this._rejoinUntilConnected()),this.socket.reconnectAfterMs),this.joinPush.receive("ok",(()=>{this.state=T.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach((e=>e.send())),this.pushBuffer=[]})),this._onClose((()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=T.closed,this.socket._remove(this)})),this._onError((e=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,e),this.state=T.errored,this.rejoinTimer.scheduleTimeout())})),this.joinPush.receive("timeout",(()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=T.errored,this.rejoinTimer.scheduleTimeout())})),this._on(x.reply,{},((e,t)=>{this._trigger(this._replyEventName(t),e)})),this.presence=new Z(this),this.broadcastEndpointURL=V(this.socket.endPoint)+"/api/broadcast",this.private=this.params.config.private||!1}subscribe(e,t=this.timeout){var r,s;if(this.socket.isConnected()||this.socket.connect(),this.joinedOnce)throw"tried to subscribe multiple times. 'subscribe' can only be called a single time per channel instance";{const{config:{broadcast:n,presence:i,private:o}}=this.params;this._onError((t=>e&&e("CHANNEL_ERROR",t))),this._onClose((()=>e&&e("CLOSED")));const a={},l={broadcast:n,presence:i,postgres_changes:null!==(s=null===(r=this.bindings.postgres_changes)||void 0===r?void 0:r.map((e=>e.filter)))&&void 0!==s?s:[],private:o};this.socket.accessToken&&(a.access_token=this.socket.accessToken),this.updateJoinPayload(Object.assign({config:l},a)),this.joinedOnce=!0,this._rejoin(t),this.joinPush.receive("ok",(({postgres_changes:t})=>{var r;if(this.socket.accessToken&&this.socket.setAuth(this.socket.accessToken),void 0!==t){const s=this.bindings.postgres_changes,n=null!==(r=null==s?void 0:s.length)&&void 0!==r?r:0,i=[];for(let r=0;r<n;r++){const n=s[r],{filter:{event:o,schema:a,table:l,filter:c}}=n,h=t&&t[r];if(!h||h.event!==o||h.schema!==a||h.table!==l||h.filter!==c)return this.unsubscribe(),void(e&&e("CHANNEL_ERROR",new Error("mismatch between server and client bindings for postgres changes")));i.push(Object.assign(Object.assign({},n),{id:h.id}))}return this.bindings.postgres_changes=i,void(e&&e("SUBSCRIBED"))}e&&e("SUBSCRIBED")})).receive("error",(t=>{e&&e("CHANNEL_ERROR",new Error(JSON.stringify(Object.values(t).join(", ")||"error")))})).receive("timeout",(()=>{e&&e("TIMED_OUT")}))}return this}presenceState(){return this.presence.state}async track(e,t={}){return await this.send({type:"presence",event:"track",payload:e},t.timeout||this.timeout)}async untrack(e={}){return await this.send({type:"presence",event:"untrack"},e)}on(e,t,r){return this._on(e,t,r)}async send(e,t={}){var r,s;if(this._canPush()||"broadcast"!==e.type)return new Promise((r=>{var s,n,i;const o=this._push(e.type,e,t.timeout||this.timeout);"broadcast"!==e.type||(null===(i=null===(n=null===(s=this.params)||void 0===s?void 0:s.config)||void 0===n?void 0:n.broadcast)||void 0===i?void 0:i.ack)||r("ok"),o.receive("ok",(()=>r("ok"))),o.receive("error",(()=>r("error"))),o.receive("timeout",(()=>r("timed out")))}));{const{event:n,payload:i}=e,o={method:"POST",headers:{Authorization:this.socket.accessToken?`Bearer ${this.socket.accessToken}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:n,payload:i,private:this.private}]})};try{const e=await this._fetchWithTimeout(this.broadcastEndpointURL,o,null!==(r=t.timeout)&&void 0!==r?r:this.timeout);return await(null===(s=e.body)||void 0===s?void 0:s.cancel()),e.ok?"ok":"error"}catch(e){return"AbortError"===e.name?"timed out":"error"}}}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=T.leaving;const t=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(x.close,"leave",this._joinRef())};return this.rejoinTimer.reset(),this.joinPush.destroy(),new Promise((r=>{const s=new q(this,x.leave,{},e);s.receive("ok",(()=>{t(),r("ok")})).receive("timeout",(()=>{t(),r("timed out")})).receive("error",(()=>{r("error")})),s.send(),this._canPush()||s.trigger("ok",{})}))}async _fetchWithTimeout(e,t,r){const s=new AbortController,n=setTimeout((()=>s.abort()),r),i=await this.socket.fetch(e,Object.assign(Object.assign({},t),{signal:s.signal}));return clearTimeout(n),i}_push(e,t,r=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let s=new q(this,e,t,r);return this._canPush()?s.send():(s.startTimeout(),this.pushBuffer.push(s)),s}_onMessage(e,t,r){return t}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,t,r){var s,n;const i=e.toLocaleLowerCase(),{close:o,error:a,leave:l,join:c}=x;if(r&&[o,a,l,c].indexOf(i)>=0&&r!==this._joinRef())return;let h=this._onMessage(i,t,r);if(t&&!h)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(i)?null===(s=this.bindings.postgres_changes)||void 0===s||s.filter((e=>{var t,r,s;return"*"===(null===(t=e.filter)||void 0===t?void 0:t.event)||(null===(s=null===(r=e.filter)||void 0===r?void 0:r.event)||void 0===s?void 0:s.toLocaleLowerCase())===i})).map((e=>e.callback(h,r))):null===(n=this.bindings[i])||void 0===n||n.filter((e=>{var r,s,n,o,a,l;if(["broadcast","presence","postgres_changes"].includes(i)){if("id"in e){const i=e.id,o=null===(r=e.filter)||void 0===r?void 0:r.event;return i&&(null===(s=t.ids)||void 0===s?void 0:s.includes(i))&&("*"===o||(null==o?void 0:o.toLocaleLowerCase())===(null===(n=t.data)||void 0===n?void 0:n.type.toLocaleLowerCase()))}{const r=null===(a=null===(o=null==e?void 0:e.filter)||void 0===o?void 0:o.event)||void 0===a?void 0:a.toLocaleLowerCase();return"*"===r||r===(null===(l=null==t?void 0:t.event)||void 0===l?void 0:l.toLocaleLowerCase())}}return e.type.toLocaleLowerCase()===i})).map((e=>{if("object"==typeof h&&"ids"in h){const e=h.data,{schema:t,table:r,commit_timestamp:s,type:n,errors:i}=e,o={schema:t,table:r,commit_timestamp:s,eventType:n,new:{},old:{},errors:i};h=Object.assign(Object.assign({},o),this._getPayloadRecords(e))}e.callback(h,r)}))}_isClosed(){return this.state===T.closed}_isJoined(){return this.state===T.joined}_isJoining(){return this.state===T.joining}_isLeaving(){return this.state===T.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,t,r){const s=e.toLocaleLowerCase(),n={type:s,filter:t,callback:r};return this.bindings[s]?this.bindings[s].push(n):this.bindings[s]=[n],this}_off(e,t){const r=e.toLocaleLowerCase();return this.bindings[r]=this.bindings[r].filter((e=>{var s;return!((null===(s=e.type)||void 0===s?void 0:s.toLocaleLowerCase())===r&&Y.isEqual(e.filter,t))})),this}static isEqual(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const r in e)if(e[r]!==t[r])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(x.close,{},e)}_onError(e){this._on(x.error,{},(t=>e(t)))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=T.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const t={new:{},old:{}};return"INSERT"!==e.type&&"UPDATE"!==e.type||(t.new=L(e.columns,e.record)),"UPDATE"!==e.type&&"DELETE"!==e.type||(t.old=L(e.columns,e.old_record)),t}}const X=()=>{},Q="undefined"!=typeof WebSocket;class ee{constructor(e,t){var r;this.accessToken=null,this.apiKey=null,this.channels=[],this.endPoint="",this.httpEndpoint="",this.headers=S,this.params={},this.timeout=1e4,this.heartbeatIntervalMs=3e4,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.ref=0,this.logger=X,this.conn=null,this.sendBuffer=[],this.serializer=new A,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this._resolveFetch=e=>{let t;return t=e||("undefined"==typeof fetch?(...e)=>Promise.resolve().then(o.bind(o,907)).then((({default:t})=>t(...e))):fetch),(...e)=>t(...e)},this.endPoint=`${e}/${j.websocket}`,this.httpEndpoint=V(e),(null==t?void 0:t.transport)?this.transport=t.transport:this.transport=null,(null==t?void 0:t.params)&&(this.params=t.params),(null==t?void 0:t.headers)&&(this.headers=Object.assign(Object.assign({},this.headers),t.headers)),(null==t?void 0:t.timeout)&&(this.timeout=t.timeout),(null==t?void 0:t.logger)&&(this.logger=t.logger),(null==t?void 0:t.heartbeatIntervalMs)&&(this.heartbeatIntervalMs=t.heartbeatIntervalMs);const s=null===(r=null==t?void 0:t.params)||void 0===r?void 0:r.apikey;if(s&&(this.accessToken=s,this.apiKey=s),this.reconnectAfterMs=(null==t?void 0:t.reconnectAfterMs)?t.reconnectAfterMs:e=>[1e3,2e3,5e3,1e4][e-1]||1e4,this.encode=(null==t?void 0:t.encode)?t.encode:(e,t)=>t(JSON.stringify(e)),this.decode=(null==t?void 0:t.decode)?t.decode:this.serializer.decode.bind(this.serializer),this.reconnectTimer=new R((async()=>{this.disconnect(),this.connect()}),this.reconnectAfterMs),this.fetch=this._resolveFetch(null==t?void 0:t.fetch),null==t?void 0:t.worker){if("undefined"!=typeof window&&!window.Worker)throw new Error("Web Worker is not supported");this.worker=(null==t?void 0:t.worker)||!1,this.workerUrl=null==t?void 0:t.workerUrl}}connect(){if(!this.conn)if(this.transport)this.conn=new this.transport(this._endPointURL(),void 0,{headers:this.headers});else{if(Q)return this.conn=new WebSocket(this._endPointURL()),void this.setupConnection();this.conn=new te(this._endPointURL(),void 0,{close:()=>{this.conn=null}}),o.e(591).then(o.t.bind(o,591,23)).then((({default:e})=>{this.conn=new e(this._endPointURL(),void 0,{headers:this.headers}),this.setupConnection()}))}}disconnect(e,t){this.conn&&(this.conn.onclose=function(){},e?this.conn.close(e,null!=t?t:""):this.conn.close(),this.conn=null,this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.reset())}getChannels(){return this.channels}async removeChannel(e){const t=await e.unsubscribe();return 0===this.channels.length&&this.disconnect(),t}async removeAllChannels(){const e=await Promise.all(this.channels.map((e=>e.unsubscribe())));return this.disconnect(),e}log(e,t,r){this.logger(e,t,r)}connectionState(){switch(this.conn&&this.conn.readyState){case P.connecting:return O.Connecting;case P.open:return O.Open;case P.closing:return O.Closing;default:return O.Closed}}isConnected(){return this.connectionState()===O.Open}channel(e,t={config:{}}){const r=new Y(`realtime:${e}`,t,this);return this.channels.push(r),r}push(e){const{topic:t,event:r,payload:s,ref:n}=e,i=()=>{this.encode(e,(e=>{var t;null===(t=this.conn)||void 0===t||t.send(e)}))};this.log("push",`${t} ${r} (${n})`,s),this.isConnected()?i():this.sendBuffer.push(i)}setAuth(e){this.accessToken=e,this.channels.forEach((t=>{e&&t.updateJoinPayload({access_token:e}),t.joinedOnce&&t._isJoined()&&t._push(x.access_token,{access_token:e})}))}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let t=this.channels.find((t=>t.topic===e&&(t._isJoined()||t._isJoining())));t&&(this.log("transport",`leaving duplicate topic "${e}"`),t.unsubscribe())}_remove(e){this.channels=this.channels.filter((t=>t._joinRef()!==e._joinRef()))}setupConnection(){this.conn&&(this.conn.binaryType="arraybuffer",this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e))}_endPointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:"1.0.0"}))}_onConnMessage(e){this.decode(e.data,(e=>{let{topic:t,event:r,payload:s,ref:n}=e;(n&&n===this.pendingHeartbeatRef||r===(null==s?void 0:s.type))&&(this.pendingHeartbeatRef=null),this.log("receive",`${s.status||""} ${t} ${r} ${n&&"("+n+")"||""}`,s),this.channels.filter((e=>e._isMember(t))).forEach((e=>e._trigger(r,s,n))),this.stateChangeCallbacks.message.forEach((t=>t(e)))}))}async _onConnOpen(){if(this.log("transport",`connected to ${this._endPointURL()}`),this._flushSendBuffer(),this.reconnectTimer.reset(),this.worker){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const e=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(e),this.workerRef.onerror=e=>{this.log("worker","worker error",e.message),this.workerRef.terminate()},this.workerRef.onmessage=e=>{"keepAlive"===e.data.event&&this._sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}else this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval((()=>this._sendHeartbeat()),this.heartbeatIntervalMs);this.stateChangeCallbacks.open.forEach((e=>e()))}_onConnClose(e){this.log("transport","close",e),this._triggerChanError(),this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.scheduleTimeout(),this.stateChangeCallbacks.close.forEach((t=>t(e)))}_onConnError(e){this.log("transport",e.message),this._triggerChanError(),this.stateChangeCallbacks.error.forEach((t=>t(e)))}_triggerChanError(){this.channels.forEach((e=>e._trigger(x.error)))}_appendParams(e,t){if(0===Object.keys(t).length)return e;const r=e.match(/\?/)?"&":"?";return`${e}${r}${new URLSearchParams(t)}`}_flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach((e=>e())),this.sendBuffer=[])}_sendHeartbeat(){var e;if(this.isConnected()){if(this.pendingHeartbeatRef)return this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection"),void(null===(e=this.conn)||void 0===e||e.close(1e3,"hearbeat timeout"));this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef}),this.setAuth(this.accessToken)}}_workerObjectUrl(e){let t;if(e)t=e;else{const e=new Blob(['\n  addEventListener("message", (e) => {\n    if (e.data.event === "start") {\n      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);\n    }\n  });'],{type:"application/javascript"});t=URL.createObjectURL(e)}return t}}class te{constructor(e,t,r){this.binaryType="arraybuffer",this.onclose=()=>{},this.onerror=()=>{},this.onmessage=()=>{},this.onopen=()=>{},this.readyState=P.connecting,this.send=()=>{},this.url=null,this.url=e,this.close=r.close}}class re extends Error{constructor(e){super(e),this.__isStorageError=!0,this.name="StorageError"}}function se(e){return"object"==typeof e&&null!==e&&"__isStorageError"in e}class ne extends re{constructor(e,t){super(e),this.name="StorageApiError",this.status=t}toJSON(){return{name:this.name,message:this.message,status:this.status}}}class ie extends re{constructor(e,t){super(e),this.name="StorageUnknownError",this.originalError=t}}const oe=e=>{let t;return t=e||("undefined"==typeof fetch?(...e)=>Promise.resolve().then(o.bind(o,907)).then((({default:t})=>t(...e))):fetch),(...e)=>t(...e)},ae=e=>{if(Array.isArray(e))return e.map((e=>ae(e)));if("function"==typeof e||e!==Object(e))return e;const t={};return Object.entries(e).forEach((([e,r])=>{const s=e.replace(/([-_][a-z])/gi,(e=>e.toUpperCase().replace(/[-_]/g,"")));t[s]=ae(r)})),t};var le=function(e,t,r,s){return new(r||(r=Promise))((function(n,i){function o(e){try{l(s.next(e))}catch(e){i(e)}}function a(e){try{l(s.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(o,a)}l((s=s.apply(e,t||[])).next())}))};const ce=e=>e.msg||e.message||e.error_description||e.error||JSON.stringify(e),he=(e,t,r)=>le(void 0,void 0,void 0,(function*(){const s=yield(n=void 0,i=void 0,a=void 0,l=function*(){return"undefined"==typeof Response?(yield Promise.resolve().then(o.bind(o,907))).Response:Response},new(a||(a=Promise))((function(e,t){function r(e){try{o(l.next(e))}catch(e){t(e)}}function s(e){try{o(l.throw(e))}catch(e){t(e)}}function o(t){var n;t.done?e(t.value):(n=t.value,n instanceof a?n:new a((function(e){e(n)}))).then(r,s)}o((l=l.apply(n,i||[])).next())})));var n,i,a,l;e instanceof s&&!(null==r?void 0:r.noResolveJson)?e.json().then((r=>{t(new ne(ce(r),e.status||500))})).catch((e=>{t(new ie(ce(e),e))})):t(new ie(ce(e),e))}));function ue(e,t,r,s,n,i){return le(this,void 0,void 0,(function*(){return new Promise(((o,a)=>{e(r,((e,t,r,s)=>{const n={method:e,headers:(null==t?void 0:t.headers)||{}};return"GET"===e?n:(n.headers=Object.assign({"Content-Type":"application/json"},null==t?void 0:t.headers),s&&(n.body=JSON.stringify(s)),Object.assign(Object.assign({},n),r))})(t,s,n,i)).then((e=>{if(!e.ok)throw e;return(null==s?void 0:s.noResolveJson)?e:e.json()})).then((e=>o(e))).catch((e=>he(e,a,s)))}))}))}function de(e,t,r,s){return le(this,void 0,void 0,(function*(){return ue(e,"GET",t,r,s)}))}function pe(e,t,r,s,n){return le(this,void 0,void 0,(function*(){return ue(e,"POST",t,s,n,r)}))}function fe(e,t,r,s,n){return le(this,void 0,void 0,(function*(){return ue(e,"DELETE",t,s,n,r)}))}var me=function(e,t,r,s){return new(r||(r=Promise))((function(n,i){function o(e){try{l(s.next(e))}catch(e){i(e)}}function a(e){try{l(s.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(o,a)}l((s=s.apply(e,t||[])).next())}))};const ge={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},ve={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class we{constructor(e,t={},r,s){this.url=e,this.headers=t,this.bucketId=r,this.fetch=oe(s)}uploadOrUpdate(e,t,r,s){return me(this,void 0,void 0,(function*(){try{let n;const i=Object.assign(Object.assign({},ve),s);let o=Object.assign(Object.assign({},this.headers),"POST"===e&&{"x-upsert":String(i.upsert)});const a=i.metadata;"undefined"!=typeof Blob&&r instanceof Blob?(n=new FormData,n.append("cacheControl",i.cacheControl),a&&n.append("metadata",this.encodeMetadata(a)),n.append("",r)):"undefined"!=typeof FormData&&r instanceof FormData?(n=r,n.append("cacheControl",i.cacheControl),a&&n.append("metadata",this.encodeMetadata(a))):(n=r,o["cache-control"]=`max-age=${i.cacheControl}`,o["content-type"]=i.contentType,a&&(o["x-metadata"]=this.toBase64(this.encodeMetadata(a)))),(null==s?void 0:s.headers)&&(o=Object.assign(Object.assign({},o),s.headers));const l=this._removeEmptyFolders(t),c=this._getFinalPath(l),h=yield this.fetch(`${this.url}/object/${c}`,Object.assign({method:e,body:n,headers:o},(null==i?void 0:i.duplex)?{duplex:i.duplex}:{})),u=yield h.json();return h.ok?{data:{path:l,id:u.Id,fullPath:u.Key},error:null}:{data:null,error:u}}catch(e){if(se(e))return{data:null,error:e};throw e}}))}upload(e,t,r){return me(this,void 0,void 0,(function*(){return this.uploadOrUpdate("POST",e,t,r)}))}uploadToSignedUrl(e,t,r,s){return me(this,void 0,void 0,(function*(){const n=this._removeEmptyFolders(e),i=this._getFinalPath(n),o=new URL(this.url+`/object/upload/sign/${i}`);o.searchParams.set("token",t);try{let e;const t=Object.assign({upsert:ve.upsert},s),i=Object.assign(Object.assign({},this.headers),{"x-upsert":String(t.upsert)});"undefined"!=typeof Blob&&r instanceof Blob?(e=new FormData,e.append("cacheControl",t.cacheControl),e.append("",r)):"undefined"!=typeof FormData&&r instanceof FormData?(e=r,e.append("cacheControl",t.cacheControl)):(e=r,i["cache-control"]=`max-age=${t.cacheControl}`,i["content-type"]=t.contentType);const a=yield this.fetch(o.toString(),{method:"PUT",body:e,headers:i}),l=yield a.json();return a.ok?{data:{path:n,fullPath:l.Key},error:null}:{data:null,error:l}}catch(e){if(se(e))return{data:null,error:e};throw e}}))}createSignedUploadUrl(e,t){return me(this,void 0,void 0,(function*(){try{let r=this._getFinalPath(e);const s=Object.assign({},this.headers);(null==t?void 0:t.upsert)&&(s["x-upsert"]="true");const n=yield pe(this.fetch,`${this.url}/object/upload/sign/${r}`,{},{headers:s}),i=new URL(this.url+n.url),o=i.searchParams.get("token");if(!o)throw new re("No token returned by API");return{data:{signedUrl:i.toString(),path:e,token:o},error:null}}catch(e){if(se(e))return{data:null,error:e};throw e}}))}update(e,t,r){return me(this,void 0,void 0,(function*(){return this.uploadOrUpdate("PUT",e,t,r)}))}move(e,t,r){return me(this,void 0,void 0,(function*(){try{return{data:yield pe(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:null==r?void 0:r.destinationBucket},{headers:this.headers}),error:null}}catch(e){if(se(e))return{data:null,error:e};throw e}}))}copy(e,t,r){return me(this,void 0,void 0,(function*(){try{return{data:{path:(yield pe(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:null==r?void 0:r.destinationBucket},{headers:this.headers})).Key},error:null}}catch(e){if(se(e))return{data:null,error:e};throw e}}))}createSignedUrl(e,t,r){return me(this,void 0,void 0,(function*(){try{let s=this._getFinalPath(e),n=yield pe(this.fetch,`${this.url}/object/sign/${s}`,Object.assign({expiresIn:t},(null==r?void 0:r.transform)?{transform:r.transform}:{}),{headers:this.headers});const i=(null==r?void 0:r.download)?`&download=${!0===r.download?"":r.download}`:"";return n={signedUrl:encodeURI(`${this.url}${n.signedURL}${i}`)},{data:n,error:null}}catch(e){if(se(e))return{data:null,error:e};throw e}}))}createSignedUrls(e,t,r){return me(this,void 0,void 0,(function*(){try{const s=yield pe(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:t,paths:e},{headers:this.headers}),n=(null==r?void 0:r.download)?`&download=${!0===r.download?"":r.download}`:"";return{data:s.map((e=>Object.assign(Object.assign({},e),{signedUrl:e.signedURL?encodeURI(`${this.url}${e.signedURL}${n}`):null}))),error:null}}catch(e){if(se(e))return{data:null,error:e};throw e}}))}download(e,t){return me(this,void 0,void 0,(function*(){const r=void 0!==(null==t?void 0:t.transform)?"render/image/authenticated":"object",s=this.transformOptsToQueryString((null==t?void 0:t.transform)||{}),n=s?`?${s}`:"";try{const t=this._getFinalPath(e),s=yield de(this.fetch,`${this.url}/${r}/${t}${n}`,{headers:this.headers,noResolveJson:!0});return{data:yield s.blob(),error:null}}catch(e){if(se(e))return{data:null,error:e};throw e}}))}info(e){return me(this,void 0,void 0,(function*(){const t=this._getFinalPath(e);try{const e=yield de(this.fetch,`${this.url}/object/info/${t}`,{headers:this.headers});return{data:ae(e),error:null}}catch(e){if(se(e))return{data:null,error:e};throw e}}))}exists(e){return me(this,void 0,void 0,(function*(){const t=this._getFinalPath(e);try{return yield function(e,t,r){return le(this,void 0,void 0,(function*(){return ue(e,"HEAD",t,Object.assign(Object.assign({},r),{noResolveJson:!0}),undefined)}))}(this.fetch,`${this.url}/object/${t}`,{headers:this.headers}),{data:!0,error:null}}catch(e){if(se(e)&&e instanceof ie){const t=e.originalError;if([400,404].includes(null==t?void 0:t.status))return{data:!1,error:e}}throw e}}))}getPublicUrl(e,t){const r=this._getFinalPath(e),s=[],n=(null==t?void 0:t.download)?`download=${!0===t.download?"":t.download}`:"";""!==n&&s.push(n);const i=void 0!==(null==t?void 0:t.transform)?"render/image":"object",o=this.transformOptsToQueryString((null==t?void 0:t.transform)||{});""!==o&&s.push(o);let a=s.join("&");return""!==a&&(a=`?${a}`),{data:{publicUrl:encodeURI(`${this.url}/${i}/public/${r}${a}`)}}}remove(e){return me(this,void 0,void 0,(function*(){try{return{data:yield fe(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:e},{headers:this.headers}),error:null}}catch(e){if(se(e))return{data:null,error:e};throw e}}))}list(e,t,r){return me(this,void 0,void 0,(function*(){try{const s=Object.assign(Object.assign(Object.assign({},ge),t),{prefix:e||""});return{data:yield pe(this.fetch,`${this.url}/object/list/${this.bucketId}`,s,{headers:this.headers},r),error:null}}catch(e){if(se(e))return{data:null,error:e};throw e}}))}encodeMetadata(e){return JSON.stringify(e)}toBase64(e){return"undefined"!=typeof Buffer?Buffer.from(e).toString("base64"):btoa(e)}_getFinalPath(e){return`${this.bucketId}/${e}`}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){const t=[];return e.width&&t.push(`width=${e.width}`),e.height&&t.push(`height=${e.height}`),e.resize&&t.push(`resize=${e.resize}`),e.format&&t.push(`format=${e.format}`),e.quality&&t.push(`quality=${e.quality}`),t.join("&")}}const ye={"X-Client-Info":"storage-js/2.7.1"};var _e=function(e,t,r,s){return new(r||(r=Promise))((function(n,i){function o(e){try{l(s.next(e))}catch(e){i(e)}}function a(e){try{l(s.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(o,a)}l((s=s.apply(e,t||[])).next())}))};class be{constructor(e,t={},r){this.url=e,this.headers=Object.assign(Object.assign({},ye),t),this.fetch=oe(r)}listBuckets(){return _e(this,void 0,void 0,(function*(){try{return{data:yield de(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(e){if(se(e))return{data:null,error:e};throw e}}))}getBucket(e){return _e(this,void 0,void 0,(function*(){try{return{data:yield de(this.fetch,`${this.url}/bucket/${e}`,{headers:this.headers}),error:null}}catch(e){if(se(e))return{data:null,error:e};throw e}}))}createBucket(e,t={public:!1}){return _e(this,void 0,void 0,(function*(){try{return{data:yield pe(this.fetch,`${this.url}/bucket`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(e){if(se(e))return{data:null,error:e};throw e}}))}updateBucket(e,t){return _e(this,void 0,void 0,(function*(){try{const r=yield function(e,t,r,s){return le(this,void 0,void 0,(function*(){return ue(e,"PUT",t,s,undefined,r)}))}(this.fetch,`${this.url}/bucket/${e}`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers});return{data:r,error:null}}catch(e){if(se(e))return{data:null,error:e};throw e}}))}emptyBucket(e){return _e(this,void 0,void 0,(function*(){try{return{data:yield pe(this.fetch,`${this.url}/bucket/${e}/empty`,{},{headers:this.headers}),error:null}}catch(e){if(se(e))return{data:null,error:e};throw e}}))}deleteBucket(e){return _e(this,void 0,void 0,(function*(){try{return{data:yield fe(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(e){if(se(e))return{data:null,error:e};throw e}}))}}class ke extends be{constructor(e,t={},r){super(e,t,r)}from(e){return new we(this.url,this.headers,e,this.fetch)}}let Ce="";Ce="undefined"!=typeof Deno?"deno":"undefined"!=typeof document?"web":"undefined"!=typeof navigator&&"ReactNative"===navigator.product?"react-native":"node";const Ee={headers:{"X-Client-Info":`supabase-js-${Ce}/2.46.1`}},Se={schema:"public"},Pe={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},Te={};var xe=o(907);const je=e=>{let t;return t=e||("undefined"==typeof fetch?xe.default:fetch),(...e)=>t(...e)},Oe=(e,t,r)=>{const s=je(r),n="undefined"==typeof Headers?xe.Headers:Headers;return(r,i)=>{return o=void 0,a=void 0,c=function*(){var o;const a=null!==(o=yield t())&&void 0!==o?o:e;let l=new n(null==i?void 0:i.headers);return l.has("apikey")||l.set("apikey",e),l.has("Authorization")||l.set("Authorization",`Bearer ${a}`),s(r,Object.assign(Object.assign({},i),{headers:l}))},new((l=void 0)||(l=Promise))((function(e,t){function r(e){try{n(c.next(e))}catch(e){t(e)}}function s(e){try{n(c.throw(e))}catch(e){t(e)}}function n(t){var n;t.done?e(t.value):(n=t.value,n instanceof l?n:new l((function(e){e(n)}))).then(r,s)}n((c=c.apply(o,a||[])).next())}));var o,a,l,c}};const $e="2.65.1",Ie={"X-Client-Info":`gotrue-js/${$e}`},Ae="X-Supabase-Api-Version",Re=Date.parse("2024-01-01T00:00:00.0Z"),Le="2024-01-01",Me=()=>"undefined"!=typeof document,Ne={tested:!1,writable:!1},Fe=()=>{if(!Me())return!1;try{if("object"!=typeof globalThis.localStorage)return!1}catch(e){return!1}if(Ne.tested)return Ne.writable;const e=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(e,e),globalThis.localStorage.removeItem(e),Ne.tested=!0,Ne.writable=!0}catch(e){Ne.tested=!0,Ne.writable=!1}return Ne.writable};function De(e){const t={},r=new URL(e);if(r.hash&&"#"===r.hash[0])try{new URLSearchParams(r.hash.substring(1)).forEach(((e,r)=>{t[r]=e}))}catch(e){}return r.searchParams.forEach(((e,r)=>{t[r]=e})),t}const Ue=e=>{let t;return t=e||("undefined"==typeof fetch?(...e)=>Promise.resolve().then(o.bind(o,907)).then((({default:t})=>t(...e))):fetch),(...e)=>t(...e)},He=async(e,t,r)=>{await e.setItem(t,JSON.stringify(r))},Be=async(e,t)=>{const r=await e.getItem(t);if(!r)return null;try{return JSON.parse(r)}catch(e){return r}},ze=async(e,t)=>{await e.removeItem(t)};class Ve{constructor(){this.promise=new Ve.promiseConstructor(((e,t)=>{this.resolve=e,this.reject=t}))}}function qe(e){const t=e.split(".");if(3!==t.length)throw new Error("JWT is not valid: not a JWT structure");if(!/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}=?$|[a-z0-9_-]{2}(==)?$)$/i.test(t[1]))throw new Error("JWT is not valid: payload is not in base64url format");const r=t[1];return JSON.parse(function(e){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";let r,s,n,i,o,a,l,c="",h=0;for(e=e.replace("-","+").replace("_","/");h<e.length;)i=t.indexOf(e.charAt(h++)),o=t.indexOf(e.charAt(h++)),a=t.indexOf(e.charAt(h++)),l=t.indexOf(e.charAt(h++)),r=i<<2|o>>4,s=(15&o)<<4|a>>2,n=(3&a)<<6|l,c+=String.fromCharCode(r),64!=a&&0!=s&&(c+=String.fromCharCode(s)),64!=l&&0!=n&&(c+=String.fromCharCode(n));return c}(r))}function Ge(e){return("0"+e.toString(16)).substr(-2)}async function Je(e,t,r=!1){const s=function(){const e=new Uint32Array(56);if("undefined"==typeof crypto){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",t=e.length;let r="";for(let s=0;s<56;s++)r+=e.charAt(Math.floor(Math.random()*t));return r}return crypto.getRandomValues(e),Array.from(e,Ge).join("")}();let n=s;r&&(n+="/PASSWORD_RECOVERY"),await He(e,`${t}-code-verifier`,n);const i=await async function(e){if("undefined"==typeof crypto||void 0===crypto.subtle||"undefined"==typeof TextEncoder)return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),e;const t=await async function(e){const t=(new TextEncoder).encode(e),r=await crypto.subtle.digest("SHA-256",t),s=new Uint8Array(r);return Array.from(s).map((e=>String.fromCharCode(e))).join("")}(e);return btoa(t).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}(s);return[i,s===i?"plain":"s256"]}Ve.promiseConstructor=Promise;const Ke=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;class We extends Error{constructor(e,t,r){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=t,this.code=r}}function Ze(e){return"object"==typeof e&&null!==e&&"__isAuthError"in e}class Ye extends We{constructor(e,t,r){super(e,t,r),this.name="AuthApiError",this.status=t,this.code=r}}class Xe extends We{constructor(e,t){super(e),this.name="AuthUnknownError",this.originalError=t}}class Qe extends We{constructor(e,t,r,s){super(e,r,s),this.name=t,this.status=r}}class et extends Qe{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}class tt extends Qe{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class rt extends Qe{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}}class st extends Qe{constructor(e,t=null){super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class nt extends Qe{constructor(e,t=null){super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class it extends Qe{constructor(e,t){super(e,"AuthRetryableFetchError",t,void 0)}}function ot(e){return Ze(e)&&"AuthRetryableFetchError"===e.name}class at extends Qe{constructor(e,t,r){super(e,"AuthWeakPasswordError",t,"weak_password"),this.reasons=r}}const lt=e=>e.msg||e.message||e.error_description||e.error||JSON.stringify(e),ct=[502,503,504];async function ht(e){var t,r;if(!("object"==typeof(r=e)&&null!==r&&"status"in r&&"ok"in r&&"json"in r&&"function"==typeof r.json))throw new it(lt(e),0);if(ct.includes(e.status))throw new it(lt(e),e.status);let s,n;try{s=await e.json()}catch(e){throw new Xe(lt(e),e)}const i=function(e){const t=e.headers.get(Ae);if(!t)return null;if(!t.match(Ke))return null;try{return new Date(`${t}T00:00:00.0Z`)}catch(e){return null}}(e);if(i&&i.getTime()>=Re&&"object"==typeof s&&s&&"string"==typeof s.code?n=s.code:"object"==typeof s&&s&&"string"==typeof s.error_code&&(n=s.error_code),n){if("weak_password"===n)throw new at(lt(s),e.status,(null===(t=s.weak_password)||void 0===t?void 0:t.reasons)||[]);if("session_not_found"===n)throw new et}else if("object"==typeof s&&s&&"object"==typeof s.weak_password&&s.weak_password&&Array.isArray(s.weak_password.reasons)&&s.weak_password.reasons.length&&s.weak_password.reasons.reduce(((e,t)=>e&&"string"==typeof t),!0))throw new at(lt(s),e.status,s.weak_password.reasons);throw new Ye(lt(s),e.status||500,n)}async function ut(e,t,r,s){var n;const i=Object.assign({},null==s?void 0:s.headers);i[Ae]||(i[Ae]=Le),(null==s?void 0:s.jwt)&&(i.Authorization=`Bearer ${s.jwt}`);const o=null!==(n=null==s?void 0:s.query)&&void 0!==n?n:{};(null==s?void 0:s.redirectTo)&&(o.redirect_to=s.redirectTo);const a=Object.keys(o).length?"?"+new URLSearchParams(o).toString():"",l=await async function(e,t,r,s,n,i){const o=((e,t,r,s)=>{const n={method:e,headers:(null==t?void 0:t.headers)||{}};return"GET"===e?n:(n.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},null==t?void 0:t.headers),n.body=JSON.stringify(s),Object.assign(Object.assign({},n),r))})(t,s,{},i);let a;try{a=await e(r,Object.assign({},o))}catch(e){throw console.error(e),new it(lt(e),0)}if(a.ok||await ht(a),null==s?void 0:s.noResolveJson)return a;try{return await a.json()}catch(e){await ht(e)}}(e,t,r+a,{headers:i,noResolveJson:null==s?void 0:s.noResolveJson},0,null==s?void 0:s.body);return(null==s?void 0:s.xform)?null==s?void 0:s.xform(l):{data:Object.assign({},l),error:null}}function dt(e){var t;let r=null;var s;return function(e){return e.access_token&&e.refresh_token&&e.expires_in}(e)&&(r=Object.assign({},e),e.expires_at||(r.expires_at=(s=e.expires_in,Math.round(Date.now()/1e3)+s))),{data:{session:r,user:null!==(t=e.user)&&void 0!==t?t:e},error:null}}function pt(e){const t=dt(e);return!t.error&&e.weak_password&&"object"==typeof e.weak_password&&Array.isArray(e.weak_password.reasons)&&e.weak_password.reasons.length&&e.weak_password.message&&"string"==typeof e.weak_password.message&&e.weak_password.reasons.reduce(((e,t)=>e&&"string"==typeof t),!0)&&(t.data.weak_password=e.weak_password),t}function ft(e){var t;return{data:{user:null!==(t=e.user)&&void 0!==t?t:e},error:null}}function mt(e){return{data:e,error:null}}function gt(e){const{action_link:t,email_otp:r,hashed_token:s,redirect_to:n,verification_type:i}=e,o=function(e,t){var r={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(r[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(s=Object.getOwnPropertySymbols(e);n<s.length;n++)t.indexOf(s[n])<0&&Object.prototype.propertyIsEnumerable.call(e,s[n])&&(r[s[n]]=e[s[n]])}return r}(e,["action_link","email_otp","hashed_token","redirect_to","verification_type"]);return{data:{properties:{action_link:t,email_otp:r,hashed_token:s,redirect_to:n,verification_type:i},user:Object.assign({},o)},error:null}}function vt(e){return e}class wt{constructor({url:e="",headers:t={},fetch:r}){this.url=e,this.headers=t,this.fetch=Ue(r),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)}}async signOut(e,t="global"){try{return await ut(this.fetch,"POST",`${this.url}/logout?scope=${t}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(e){if(Ze(e))return{data:null,error:e};throw e}}async inviteUserByEmail(e,t={}){try{return await ut(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:t.data},headers:this.headers,redirectTo:t.redirectTo,xform:ft})}catch(e){if(Ze(e))return{data:{user:null},error:e};throw e}}async generateLink(e){try{const{options:t}=e,r=function(e,t){var r={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(r[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(s=Object.getOwnPropertySymbols(e);n<s.length;n++)t.indexOf(s[n])<0&&Object.prototype.propertyIsEnumerable.call(e,s[n])&&(r[s[n]]=e[s[n]])}return r}(e,["options"]),s=Object.assign(Object.assign({},r),t);return"newEmail"in r&&(s.new_email=null==r?void 0:r.newEmail,delete s.newEmail),await ut(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:s,headers:this.headers,xform:gt,redirectTo:null==t?void 0:t.redirectTo})}catch(e){if(Ze(e))return{data:{properties:null,user:null},error:e};throw e}}async createUser(e){try{return await ut(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:ft})}catch(e){if(Ze(e))return{data:{user:null},error:e};throw e}}async listUsers(e){var t,r,s,n,i,o,a;try{const l={nextPage:null,lastPage:0,total:0},c=await ut(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:null!==(r=null===(t=null==e?void 0:e.page)||void 0===t?void 0:t.toString())&&void 0!==r?r:"",per_page:null!==(n=null===(s=null==e?void 0:e.perPage)||void 0===s?void 0:s.toString())&&void 0!==n?n:""},xform:vt});if(c.error)throw c.error;const h=await c.json(),u=null!==(i=c.headers.get("x-total-count"))&&void 0!==i?i:0,d=null!==(a=null===(o=c.headers.get("link"))||void 0===o?void 0:o.split(","))&&void 0!==a?a:[];return d.length>0&&(d.forEach((e=>{const t=parseInt(e.split(";")[0].split("=")[1].substring(0,1)),r=JSON.parse(e.split(";")[1].split("=")[1]);l[`${r}Page`]=t})),l.total=parseInt(u)),{data:Object.assign(Object.assign({},h),l),error:null}}catch(e){if(Ze(e))return{data:{users:[]},error:e};throw e}}async getUserById(e){try{return await ut(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:ft})}catch(e){if(Ze(e))return{data:{user:null},error:e};throw e}}async updateUserById(e,t){try{return await ut(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:t,headers:this.headers,xform:ft})}catch(e){if(Ze(e))return{data:{user:null},error:e};throw e}}async deleteUser(e,t=!1){try{return await ut(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:t},xform:ft})}catch(e){if(Ze(e))return{data:{user:null},error:e};throw e}}async _listFactors(e){try{const{data:t,error:r}=await ut(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:e=>({data:{factors:e},error:null})});return{data:t,error:r}}catch(e){if(Ze(e))return{data:null,error:e};throw e}}async _deleteFactor(e){try{return{data:await ut(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(e){if(Ze(e))return{data:null,error:e};throw e}}}const yt={getItem:e=>Fe()?globalThis.localStorage.getItem(e):null,setItem:(e,t)=>{Fe()&&globalThis.localStorage.setItem(e,t)},removeItem:e=>{Fe()&&globalThis.localStorage.removeItem(e)}};function _t(e={}){return{getItem:t=>e[t]||null,setItem:(t,r)=>{e[t]=r},removeItem:t=>{delete e[t]}}}const bt=!!(globalThis&&Fe()&&globalThis.localStorage&&"true"===globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug"));class kt extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}class Ct extends kt{}async function Et(e,t,r){bt&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",e,t);const s=new globalThis.AbortController;return t>0&&setTimeout((()=>{s.abort(),bt&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",e)}),t),await globalThis.navigator.locks.request(e,0===t?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:s.signal},(async s=>{if(!s){if(0===t)throw bt&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",e),new Ct(`Acquiring an exclusive Navigator LockManager lock "${e}" immediately failed`);if(bt)try{const e=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(e,null,"  "))}catch(e){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",e)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await r()}bt&&console.log("@supabase/gotrue-js: navigatorLock: acquired",e,s.name);try{return await r()}finally{bt&&console.log("@supabase/gotrue-js: navigatorLock: released",e,s.name)}}))}!function(){if("object"!=typeof globalThis)try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch(e){"undefined"!=typeof self&&(self.globalThis=self)}}();const St={url:"http://localhost:9999",storageKey:"supabase.auth.token",autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:Ie,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1},Pt=3e4;async function Tt(e,t,r){return await r()}class xt{constructor(e){var t,r;this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=xt.nextInstanceID,xt.nextInstanceID+=1,this.instanceID>0&&Me()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");const s=Object.assign(Object.assign({},St),e);if(this.logDebugMessages=!!s.debug,"function"==typeof s.debug&&(this.logger=s.debug),this.persistSession=s.persistSession,this.storageKey=s.storageKey,this.autoRefreshToken=s.autoRefreshToken,this.admin=new wt({url:s.url,headers:s.headers,fetch:s.fetch}),this.url=s.url,this.headers=s.headers,this.fetch=Ue(s.fetch),this.lock=s.lock||Tt,this.detectSessionInUrl=s.detectSessionInUrl,this.flowType=s.flowType,this.hasCustomAuthorizationHeader=s.hasCustomAuthorizationHeader,s.lock?this.lock=s.lock:Me()&&(null===(t=null===globalThis||void 0===globalThis?void 0:globalThis.navigator)||void 0===t?void 0:t.locks)?this.lock=Et:this.lock=Tt,this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this)},this.persistSession?s.storage?this.storage=s.storage:Fe()?this.storage=yt:(this.memoryStorage={},this.storage=_t(this.memoryStorage)):(this.memoryStorage={},this.storage=_t(this.memoryStorage)),Me()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(e){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",e)}null===(r=this.broadcastChannel)||void 0===r||r.addEventListener("message",(async e=>{this._debug("received broadcast notification from other tab or client",e),await this._notifyAllSubscribers(e.data.event,e.data.session,!1)}))}this.initialize()}_debug(...e){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (${$e}) ${(new Date).toISOString()}`,...e),this}async initialize(){return this.initializePromise||(this.initializePromise=(async()=>await this._acquireLock(-1,(async()=>await this._initialize())))()),await this.initializePromise}async _initialize(){try{const e=!!Me()&&await this._isPKCEFlow();if(this._debug("#_initialize()","begin","is PKCE flow",e),e||this.detectSessionInUrl&&this._isImplicitGrantFlow()){const{data:t,error:r}=await this._getSessionFromURL(e);if(r)return this._debug("#_initialize()","error detecting session from URL",r),"identity_already_exists"===(null==r?void 0:r.code)||await this._removeSession(),{error:r};const{session:s,redirectType:n}=t;return this._debug("#_initialize()","detected session in URL",s,"redirect type",n),await this._saveSession(s),setTimeout((async()=>{"recovery"===n?await this._notifyAllSubscribers("PASSWORD_RECOVERY",s):await this._notifyAllSubscribers("SIGNED_IN",s)}),0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(e){return Ze(e)?{error:e}:{error:new Xe("Unexpected error during initialization",e)}}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(e){var t,r,s;try{const n=await ut(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:null!==(r=null===(t=null==e?void 0:e.options)||void 0===t?void 0:t.data)&&void 0!==r?r:{},gotrue_meta_security:{captcha_token:null===(s=null==e?void 0:e.options)||void 0===s?void 0:s.captchaToken}},xform:dt}),{data:i,error:o}=n;if(o||!i)return{data:{user:null,session:null},error:o};const a=i.session,l=i.user;return i.session&&(await this._saveSession(i.session),await this._notifyAllSubscribers("SIGNED_IN",a)),{data:{user:l,session:a},error:null}}catch(e){if(Ze(e))return{data:{user:null,session:null},error:e};throw e}}async signUp(e){var t,r,s;try{let n;if("email"in e){const{email:r,password:s,options:i}=e;let o=null,a=null;"pkce"===this.flowType&&([o,a]=await Je(this.storage,this.storageKey)),n=await ut(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:null==i?void 0:i.emailRedirectTo,body:{email:r,password:s,data:null!==(t=null==i?void 0:i.data)&&void 0!==t?t:{},gotrue_meta_security:{captcha_token:null==i?void 0:i.captchaToken},code_challenge:o,code_challenge_method:a},xform:dt})}else{if(!("phone"in e))throw new rt("You must provide either an email or phone number and a password");{const{phone:t,password:i,options:o}=e;n=await ut(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:t,password:i,data:null!==(r=null==o?void 0:o.data)&&void 0!==r?r:{},channel:null!==(s=null==o?void 0:o.channel)&&void 0!==s?s:"sms",gotrue_meta_security:{captcha_token:null==o?void 0:o.captchaToken}},xform:dt})}}const{data:i,error:o}=n;if(o||!i)return{data:{user:null,session:null},error:o};const a=i.session,l=i.user;return i.session&&(await this._saveSession(i.session),await this._notifyAllSubscribers("SIGNED_IN",a)),{data:{user:l,session:a},error:null}}catch(e){if(Ze(e))return{data:{user:null,session:null},error:e};throw e}}async signInWithPassword(e){try{let t;if("email"in e){const{email:r,password:s,options:n}=e;t=await ut(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:r,password:s,gotrue_meta_security:{captcha_token:null==n?void 0:n.captchaToken}},xform:pt})}else{if(!("phone"in e))throw new rt("You must provide either an email or phone number and a password");{const{phone:r,password:s,options:n}=e;t=await ut(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:r,password:s,gotrue_meta_security:{captcha_token:null==n?void 0:n.captchaToken}},xform:pt})}}const{data:r,error:s}=t;return s?{data:{user:null,session:null},error:s}:r&&r.session&&r.user?(r.session&&(await this._saveSession(r.session),await this._notifyAllSubscribers("SIGNED_IN",r.session)),{data:Object.assign({user:r.user,session:r.session},r.weak_password?{weakPassword:r.weak_password}:null),error:s}):{data:{user:null,session:null},error:new tt}}catch(e){if(Ze(e))return{data:{user:null,session:null},error:e};throw e}}async signInWithOAuth(e){var t,r,s,n;return await this._handleProviderSignIn(e.provider,{redirectTo:null===(t=e.options)||void 0===t?void 0:t.redirectTo,scopes:null===(r=e.options)||void 0===r?void 0:r.scopes,queryParams:null===(s=e.options)||void 0===s?void 0:s.queryParams,skipBrowserRedirect:null===(n=e.options)||void 0===n?void 0:n.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(-1,(async()=>this._exchangeCodeForSession(e)))}async _exchangeCodeForSession(e){const t=await Be(this.storage,`${this.storageKey}-code-verifier`),[r,s]=(null!=t?t:"").split("/");try{const{data:t,error:n}=await ut(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:r},xform:dt});if(await ze(this.storage,`${this.storageKey}-code-verifier`),n)throw n;return t&&t.session&&t.user?(t.session&&(await this._saveSession(t.session),await this._notifyAllSubscribers("SIGNED_IN",t.session)),{data:Object.assign(Object.assign({},t),{redirectType:null!=s?s:null}),error:n}):{data:{user:null,session:null,redirectType:null},error:new tt}}catch(e){if(Ze(e))return{data:{user:null,session:null,redirectType:null},error:e};throw e}}async signInWithIdToken(e){try{const{options:t,provider:r,token:s,access_token:n,nonce:i}=e,o=await ut(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:r,id_token:s,access_token:n,nonce:i,gotrue_meta_security:{captcha_token:null==t?void 0:t.captchaToken}},xform:dt}),{data:a,error:l}=o;return l?{data:{user:null,session:null},error:l}:a&&a.session&&a.user?(a.session&&(await this._saveSession(a.session),await this._notifyAllSubscribers("SIGNED_IN",a.session)),{data:a,error:l}):{data:{user:null,session:null},error:new tt}}catch(e){if(Ze(e))return{data:{user:null,session:null},error:e};throw e}}async signInWithOtp(e){var t,r,s,n,i;try{if("email"in e){const{email:s,options:n}=e;let i=null,o=null;"pkce"===this.flowType&&([i,o]=await Je(this.storage,this.storageKey));const{error:a}=await ut(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:s,data:null!==(t=null==n?void 0:n.data)&&void 0!==t?t:{},create_user:null===(r=null==n?void 0:n.shouldCreateUser)||void 0===r||r,gotrue_meta_security:{captcha_token:null==n?void 0:n.captchaToken},code_challenge:i,code_challenge_method:o},redirectTo:null==n?void 0:n.emailRedirectTo});return{data:{user:null,session:null},error:a}}if("phone"in e){const{phone:t,options:r}=e,{data:o,error:a}=await ut(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:t,data:null!==(s=null==r?void 0:r.data)&&void 0!==s?s:{},create_user:null===(n=null==r?void 0:r.shouldCreateUser)||void 0===n||n,gotrue_meta_security:{captcha_token:null==r?void 0:r.captchaToken},channel:null!==(i=null==r?void 0:r.channel)&&void 0!==i?i:"sms"}});return{data:{user:null,session:null,messageId:null==o?void 0:o.message_id},error:a}}throw new rt("You must provide either an email or phone number.")}catch(e){if(Ze(e))return{data:{user:null,session:null},error:e};throw e}}async verifyOtp(e){var t,r;try{let s,n;"options"in e&&(s=null===(t=e.options)||void 0===t?void 0:t.redirectTo,n=null===(r=e.options)||void 0===r?void 0:r.captchaToken);const{data:i,error:o}=await ut(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:n}}),redirectTo:s,xform:dt});if(o)throw o;if(!i)throw new Error("An error occurred on token verification.");const a=i.session,l=i.user;return(null==a?void 0:a.access_token)&&(await this._saveSession(a),await this._notifyAllSubscribers("recovery"==e.type?"PASSWORD_RECOVERY":"SIGNED_IN",a)),{data:{user:l,session:a},error:null}}catch(e){if(Ze(e))return{data:{user:null,session:null},error:e};throw e}}async signInWithSSO(e){var t,r,s;try{let n=null,i=null;return"pkce"===this.flowType&&([n,i]=await Je(this.storage,this.storageKey)),await ut(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:null!==(r=null===(t=e.options)||void 0===t?void 0:t.redirectTo)&&void 0!==r?r:void 0}),(null===(s=null==e?void 0:e.options)||void 0===s?void 0:s.captchaToken)?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:n,code_challenge_method:i}),headers:this.headers,xform:mt})}catch(e){if(Ze(e))return{data:null,error:e};throw e}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,(async()=>await this._reauthenticate()))}async _reauthenticate(){try{return await this._useSession((async e=>{const{data:{session:t},error:r}=e;if(r)throw r;if(!t)throw new et;const{error:s}=await ut(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:t.access_token});return{data:{user:null,session:null},error:s}}))}catch(e){if(Ze(e))return{data:{user:null,session:null},error:e};throw e}}async resend(e){try{const t=`${this.url}/resend`;if("email"in e){const{email:r,type:s,options:n}=e,{error:i}=await ut(this.fetch,"POST",t,{headers:this.headers,body:{email:r,type:s,gotrue_meta_security:{captcha_token:null==n?void 0:n.captchaToken}},redirectTo:null==n?void 0:n.emailRedirectTo});return{data:{user:null,session:null},error:i}}if("phone"in e){const{phone:r,type:s,options:n}=e,{data:i,error:o}=await ut(this.fetch,"POST",t,{headers:this.headers,body:{phone:r,type:s,gotrue_meta_security:{captcha_token:null==n?void 0:n.captchaToken}}});return{data:{user:null,session:null,messageId:null==i?void 0:i.message_id},error:o}}throw new rt("You must provide either an email or phone number and a type")}catch(e){if(Ze(e))return{data:{user:null,session:null},error:e};throw e}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,(async()=>this._useSession((async e=>e))))}async _acquireLock(e,t){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){const e=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),r=(async()=>(await e,await t()))();return this.pendingInLock.push((async()=>{try{await r}catch(e){}})()),r}return await this.lock(`lock:${this.storageKey}`,e,(async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const e=t();for(this.pendingInLock.push((async()=>{try{await e}catch(e){}})()),await e;this.pendingInLock.length;){const e=[...this.pendingInLock];await Promise.all(e),this.pendingInLock.splice(0,e.length)}return await e}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}}))}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{const t=await this.__loadSession();return await e(t)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",(new Error).stack);try{let e=null;const t=await Be(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",t),null!==t&&(this._isValidSession(t)?e=t:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!e)return{data:{session:null},error:null};const r=!!e.expires_at&&e.expires_at<=Date.now()/1e3;if(this._debug("#__loadSession()",`session has${r?"":" not"} expired`,"expires_at",e.expires_at),!r){if(this.storage.isServer){let t=this.suppressGetSessionWarning;e=new Proxy(e,{get:(e,r,s)=>(t||"user"!==r||(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and many not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),t=!0,this.suppressGetSessionWarning=!0),Reflect.get(e,r,s))})}return{data:{session:e},error:null}}const{session:s,error:n}=await this._callRefreshToken(e.refresh_token);return n?{data:{session:null},error:n}:{data:{session:s},error:null}}finally{this._debug("#__loadSession()","end")}}async getUser(e){return e?await this._getUser(e):(await this.initializePromise,await this._acquireLock(-1,(async()=>await this._getUser())))}async _getUser(e){try{return e?await ut(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:ft}):await this._useSession((async e=>{var t,r,s;const{data:n,error:i}=e;if(i)throw i;return(null===(t=n.session)||void 0===t?void 0:t.access_token)||this.hasCustomAuthorizationHeader?await ut(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:null!==(s=null===(r=n.session)||void 0===r?void 0:r.access_token)&&void 0!==s?s:void 0,xform:ft}):{data:{user:null},error:new et}}))}catch(e){if(Ze(e))return function(e){return Ze(e)&&"AuthSessionMissingError"===e.name}(e)&&(await this._removeSession(),await ze(this.storage,`${this.storageKey}-code-verifier`)),{data:{user:null},error:e};throw e}}async updateUser(e,t={}){return await this.initializePromise,await this._acquireLock(-1,(async()=>await this._updateUser(e,t)))}async _updateUser(e,t={}){try{return await this._useSession((async r=>{const{data:s,error:n}=r;if(n)throw n;if(!s.session)throw new et;const i=s.session;let o=null,a=null;"pkce"===this.flowType&&null!=e.email&&([o,a]=await Je(this.storage,this.storageKey));const{data:l,error:c}=await ut(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:null==t?void 0:t.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:o,code_challenge_method:a}),jwt:i.access_token,xform:ft});if(c)throw c;return i.user=l.user,await this._saveSession(i),await this._notifyAllSubscribers("USER_UPDATED",i),{data:{user:i.user},error:null}}))}catch(e){if(Ze(e))return{data:{user:null},error:e};throw e}}_decodeJWT(e){return qe(e)}async setSession(e){return await this.initializePromise,await this._acquireLock(-1,(async()=>await this._setSession(e)))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new et;const t=Date.now()/1e3;let r=t,s=!0,n=null;const i=qe(e.access_token);if(i.exp&&(r=i.exp,s=r<=t),s){const{session:t,error:r}=await this._callRefreshToken(e.refresh_token);if(r)return{data:{user:null,session:null},error:r};if(!t)return{data:{user:null,session:null},error:null};n=t}else{const{data:s,error:i}=await this._getUser(e.access_token);if(i)throw i;n={access_token:e.access_token,refresh_token:e.refresh_token,user:s.user,token_type:"bearer",expires_in:r-t,expires_at:r},await this._saveSession(n),await this._notifyAllSubscribers("SIGNED_IN",n)}return{data:{user:n.user,session:n},error:null}}catch(e){if(Ze(e))return{data:{session:null,user:null},error:e};throw e}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(-1,(async()=>await this._refreshSession(e)))}async _refreshSession(e){try{return await this._useSession((async t=>{var r;if(!e){const{data:s,error:n}=t;if(n)throw n;e=null!==(r=s.session)&&void 0!==r?r:void 0}if(!(null==e?void 0:e.refresh_token))throw new et;const{session:s,error:n}=await this._callRefreshToken(e.refresh_token);return n?{data:{user:null,session:null},error:n}:s?{data:{user:s.user,session:s},error:null}:{data:{user:null,session:null},error:null}}))}catch(e){if(Ze(e))return{data:{user:null,session:null},error:e};throw e}}async _getSessionFromURL(e){try{if(!Me())throw new st("No browser detected.");if("implicit"===this.flowType&&!this._isImplicitGrantFlow())throw new st("Not a valid implicit grant flow url.");if("pkce"==this.flowType&&!e)throw new nt("Not a valid PKCE flow url.");const t=De(window.location.href);if(e){if(!t.code)throw new nt("No code detected.");const{data:e,error:r}=await this._exchangeCodeForSession(t.code);if(r)throw r;const s=new URL(window.location.href);return s.searchParams.delete("code"),window.history.replaceState(window.history.state,"",s.toString()),{data:{session:e.session,redirectType:null},error:null}}if(t.error||t.error_description||t.error_code)throw new st(t.error_description||"Error in URL with unspecified error_description",{error:t.error||"unspecified_error",code:t.error_code||"unspecified_code"});const{provider_token:r,provider_refresh_token:s,access_token:n,refresh_token:i,expires_in:o,expires_at:a,token_type:l}=t;if(!(n&&o&&i&&l))throw new st("No session defined in URL");const c=Math.round(Date.now()/1e3),h=parseInt(o);let u=c+h;a&&(u=parseInt(a));const d=u-c;1e3*d<=Pt&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${d}s, should have been closer to ${h}s`);const p=u-h;c-p>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",p,u,c):c-p<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",p,u,c);const{data:f,error:m}=await this._getUser(n);if(m)throw m;const g={provider_token:r,provider_refresh_token:s,access_token:n,expires_in:h,expires_at:u,refresh_token:i,token_type:l,user:f.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:g,redirectType:t.type},error:null}}catch(e){if(Ze(e))return{data:{session:null,redirectType:null},error:e};throw e}}_isImplicitGrantFlow(){const e=De(window.location.href);return!(!Me()||!e.access_token&&!e.error_description)}async _isPKCEFlow(){const e=De(window.location.href),t=await Be(this.storage,`${this.storageKey}-code-verifier`);return!(!e.code||!t)}async signOut(e={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,(async()=>await this._signOut(e)))}async _signOut({scope:e}={scope:"global"}){return await this._useSession((async t=>{var r;const{data:s,error:n}=t;if(n)return{error:n};const i=null===(r=s.session)||void 0===r?void 0:r.access_token;if(i){const{error:t}=await this.admin.signOut(i,e);if(t&&(!function(e){return Ze(e)&&"AuthApiError"===e.name}(t)||404!==t.status&&401!==t.status&&403!==t.status))return{error:t}}return"others"!==e&&(await this._removeSession(),await ze(this.storage,`${this.storageKey}-code-verifier`)),{error:null}}))}onAuthStateChange(e){const t="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){const t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)})),r={id:t,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",t),this.stateChangeEmitters.delete(t)}};return this._debug("#onAuthStateChange()","registered callback with id",t),this.stateChangeEmitters.set(t,r),(async()=>{await this.initializePromise,await this._acquireLock(-1,(async()=>{this._emitInitialSession(t)}))})(),{data:{subscription:r}}}async _emitInitialSession(e){return await this._useSession((async t=>{var r,s;try{const{data:{session:s},error:n}=t;if(n)throw n;await(null===(r=this.stateChangeEmitters.get(e))||void 0===r?void 0:r.callback("INITIAL_SESSION",s)),this._debug("INITIAL_SESSION","callback id",e,"session",s)}catch(t){await(null===(s=this.stateChangeEmitters.get(e))||void 0===s?void 0:s.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",t),console.error(t)}}))}async resetPasswordForEmail(e,t={}){let r=null,s=null;"pkce"===this.flowType&&([r,s]=await Je(this.storage,this.storageKey,!0));try{return await ut(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:r,code_challenge_method:s,gotrue_meta_security:{captcha_token:t.captchaToken}},headers:this.headers,redirectTo:t.redirectTo})}catch(e){if(Ze(e))return{data:null,error:e};throw e}}async getUserIdentities(){var e;try{const{data:t,error:r}=await this.getUser();if(r)throw r;return{data:{identities:null!==(e=t.user.identities)&&void 0!==e?e:[]},error:null}}catch(e){if(Ze(e))return{data:null,error:e};throw e}}async linkIdentity(e){var t;try{const{data:r,error:s}=await this._useSession((async t=>{var r,s,n,i,o;const{data:a,error:l}=t;if(l)throw l;const c=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:null===(r=e.options)||void 0===r?void 0:r.redirectTo,scopes:null===(s=e.options)||void 0===s?void 0:s.scopes,queryParams:null===(n=e.options)||void 0===n?void 0:n.queryParams,skipBrowserRedirect:!0});return await ut(this.fetch,"GET",c,{headers:this.headers,jwt:null!==(o=null===(i=a.session)||void 0===i?void 0:i.access_token)&&void 0!==o?o:void 0})}));if(s)throw s;return Me()&&!(null===(t=e.options)||void 0===t?void 0:t.skipBrowserRedirect)&&window.location.assign(null==r?void 0:r.url),{data:{provider:e.provider,url:null==r?void 0:r.url},error:null}}catch(t){if(Ze(t))return{data:{provider:e.provider,url:null},error:t};throw t}}async unlinkIdentity(e){try{return await this._useSession((async t=>{var r,s;const{data:n,error:i}=t;if(i)throw i;return await ut(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:null!==(s=null===(r=n.session)||void 0===r?void 0:r.access_token)&&void 0!==s?s:void 0})}))}catch(e){if(Ze(e))return{data:null,error:e};throw e}}async _refreshAccessToken(e){const t=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(t,"begin");try{const n=Date.now();return await(r=async r=>(r>0&&await async function(e){return await new Promise((t=>{setTimeout((()=>t(null)),e)}))}(200*Math.pow(2,r-1)),this._debug(t,"refreshing attempt",r),await ut(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:dt})),s=(e,t)=>{const r=200*Math.pow(2,e);return t&&ot(t)&&Date.now()+r-n<Pt},new Promise(((e,t)=>{(async()=>{for(let n=0;n<1/0;n++)try{const t=await r(n);if(!s(n,null))return void e(t)}catch(e){if(!s(n,e))return void t(e)}})()})))}catch(e){if(this._debug(t,"error",e),Ze(e))return{data:{session:null,user:null},error:e};throw e}finally{this._debug(t,"end")}var r,s}_isValidSession(e){return"object"==typeof e&&null!==e&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,t){const r=await this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:t.redirectTo,scopes:t.scopes,queryParams:t.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",t,"url",r),Me()&&!t.skipBrowserRedirect&&window.location.assign(r),{data:{provider:e,url:r},error:null}}async _recoverAndRefresh(){var e;const t="#_recoverAndRefresh()";this._debug(t,"begin");try{const r=await Be(this.storage,this.storageKey);if(this._debug(t,"session from storage",r),!this._isValidSession(r))return this._debug(t,"session is not valid"),void(null!==r&&await this._removeSession());const s=Math.round(Date.now()/1e3),n=(null!==(e=r.expires_at)&&void 0!==e?e:1/0)<s+10;if(this._debug(t,`session has${n?"":" not"} expired with margin of 10s`),n){if(this.autoRefreshToken&&r.refresh_token){const{error:e}=await this._callRefreshToken(r.refresh_token);e&&(console.error(e),ot(e)||(this._debug(t,"refresh failed with a non-retryable error, removing the session",e),await this._removeSession()))}}else await this._notifyAllSubscribers("SIGNED_IN",r)}catch(e){return this._debug(t,"error",e),void console.error(e)}finally{this._debug(t,"end")}}async _callRefreshToken(e){var t,r;if(!e)throw new et;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const s=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(s,"begin");try{this.refreshingDeferred=new Ve;const{data:t,error:r}=await this._refreshAccessToken(e);if(r)throw r;if(!t.session)throw new et;await this._saveSession(t.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",t.session);const s={session:t.session,error:null};return this.refreshingDeferred.resolve(s),s}catch(e){if(this._debug(s,"error",e),Ze(e)){const r={session:null,error:e};return ot(e)||await this._removeSession(),null===(t=this.refreshingDeferred)||void 0===t||t.resolve(r),r}throw null===(r=this.refreshingDeferred)||void 0===r||r.reject(e),e}finally{this.refreshingDeferred=null,this._debug(s,"end")}}async _notifyAllSubscribers(e,t,r=!0){const s=`#_notifyAllSubscribers(${e})`;this._debug(s,"begin",t,`broadcast = ${r}`);try{this.broadcastChannel&&r&&this.broadcastChannel.postMessage({event:e,session:t});const s=[],n=Array.from(this.stateChangeEmitters.values()).map((async r=>{try{await r.callback(e,t)}catch(e){s.push(e)}}));if(await Promise.all(n),s.length>0){for(let e=0;e<s.length;e+=1)console.error(s[e]);throw s[0]}}finally{this._debug(s,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0,await He(this.storage,this.storageKey,e)}async _removeSession(){this._debug("#_removeSession()"),await ze(this.storage,this.storageKey),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&Me()&&(null===window||void 0===window?void 0:window.removeEventListener)&&window.removeEventListener("visibilitychange",e)}catch(e){console.error("removing visibilitychange callback failed",e)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval((()=>this._autoRefreshTokenTick()),Pt);this.autoRefreshTicker=e,e&&"object"==typeof e&&"function"==typeof e.unref?e.unref():"undefined"!=typeof Deno&&"function"==typeof Deno.unrefTimer&&Deno.unrefTimer(e),setTimeout((async()=>{await this.initializePromise,await this._autoRefreshTokenTick()}),0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,(async()=>{try{const e=Date.now();try{return await this._useSession((async t=>{const{data:{session:r}}=t;if(!r||!r.refresh_token||!r.expires_at)return void this._debug("#_autoRefreshTokenTick()","no session");const s=Math.floor((1e3*r.expires_at-e)/Pt);this._debug("#_autoRefreshTokenTick()",`access token expires in ${s} ticks, a tick lasts 30000ms, refresh threshold is 3 ticks`),s<=3&&await this._callRefreshToken(r.refresh_token)}))}catch(e){console.error("Auto refresh tick failed with error. This is likely a transient error.",e)}}finally{this._debug("#_autoRefreshTokenTick()","end")}}))}catch(e){if(!(e.isAcquireTimeout||e instanceof kt))throw e;this._debug("auto refresh token tick lock not available")}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!Me()||!(null===window||void 0===window?void 0:window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),null===window||void 0===window||window.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){const t=`#_onVisibilityChanged(${e})`;this._debug(t,"visibilityState",document.visibilityState),"visible"===document.visibilityState?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(-1,(async()=>{"visible"===document.visibilityState?await this._recoverAndRefresh():this._debug(t,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting")})))):"hidden"===document.visibilityState&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,t,r){const s=[`provider=${encodeURIComponent(t)}`];if((null==r?void 0:r.redirectTo)&&s.push(`redirect_to=${encodeURIComponent(r.redirectTo)}`),(null==r?void 0:r.scopes)&&s.push(`scopes=${encodeURIComponent(r.scopes)}`),"pkce"===this.flowType){const[e,t]=await Je(this.storage,this.storageKey),r=new URLSearchParams({code_challenge:`${encodeURIComponent(e)}`,code_challenge_method:`${encodeURIComponent(t)}`});s.push(r.toString())}if(null==r?void 0:r.queryParams){const e=new URLSearchParams(r.queryParams);s.push(e.toString())}return(null==r?void 0:r.skipBrowserRedirect)&&s.push(`skip_http_redirect=${r.skipBrowserRedirect}`),`${e}?${s.join("&")}`}async _unenroll(e){try{return await this._useSession((async t=>{var r;const{data:s,error:n}=t;return n?{data:null,error:n}:await ut(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:null===(r=null==s?void 0:s.session)||void 0===r?void 0:r.access_token})}))}catch(e){if(Ze(e))return{data:null,error:e};throw e}}async _enroll(e){try{return await this._useSession((async t=>{var r,s;const{data:n,error:i}=t;if(i)return{data:null,error:i};const o=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},"phone"===e.factorType?{phone:e.phone}:{issuer:e.issuer}),{data:a,error:l}=await ut(this.fetch,"POST",`${this.url}/factors`,{body:o,headers:this.headers,jwt:null===(r=null==n?void 0:n.session)||void 0===r?void 0:r.access_token});return l?{data:null,error:l}:("totp"===e.factorType&&(null===(s=null==a?void 0:a.totp)||void 0===s?void 0:s.qr_code)&&(a.totp.qr_code=`data:image/svg+xml;utf-8,${a.totp.qr_code}`),{data:a,error:null})}))}catch(e){if(Ze(e))return{data:null,error:e};throw e}}async _verify(e){return this._acquireLock(-1,(async()=>{try{return await this._useSession((async t=>{var r;const{data:s,error:n}=t;if(n)return{data:null,error:n};const{data:i,error:o}=await ut(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:{code:e.code,challenge_id:e.challengeId},headers:this.headers,jwt:null===(r=null==s?void 0:s.session)||void 0===r?void 0:r.access_token});return o?{data:null,error:o}:(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+i.expires_in},i)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",i),{data:i,error:o})}))}catch(e){if(Ze(e))return{data:null,error:e};throw e}}))}async _challenge(e){return this._acquireLock(-1,(async()=>{try{return await this._useSession((async t=>{var r;const{data:s,error:n}=t;return n?{data:null,error:n}:await ut(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{body:{channel:e.channel},headers:this.headers,jwt:null===(r=null==s?void 0:s.session)||void 0===r?void 0:r.access_token})}))}catch(e){if(Ze(e))return{data:null,error:e};throw e}}))}async _challengeAndVerify(e){const{data:t,error:r}=await this._challenge({factorId:e.factorId});return r?{data:null,error:r}:await this._verify({factorId:e.factorId,challengeId:t.id,code:e.code})}async _listFactors(){const{data:{user:e},error:t}=await this.getUser();if(t)return{data:null,error:t};const r=(null==e?void 0:e.factors)||[],s=r.filter((e=>"totp"===e.factor_type&&"verified"===e.status)),n=r.filter((e=>"phone"===e.factor_type&&"verified"===e.status));return{data:{all:r,totp:s,phone:n},error:null}}async _getAuthenticatorAssuranceLevel(){return this._acquireLock(-1,(async()=>await this._useSession((async e=>{var t,r;const{data:{session:s},error:n}=e;if(n)return{data:null,error:n};if(!s)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const i=this._decodeJWT(s.access_token);let o=null;i.aal&&(o=i.aal);let a=o;return(null!==(r=null===(t=s.user.factors)||void 0===t?void 0:t.filter((e=>"verified"===e.status)))&&void 0!==r?r:[]).length>0&&(a="aal2"),{data:{currentLevel:o,nextLevel:a,currentAuthenticationMethods:i.amr||[]},error:null}}))))}}xt.nextInstanceID=0;const jt=xt;class Ot extends jt{constructor(e){super(e)}}const $t=new class{constructor(e,t,r){var s,n,i;if(this.supabaseUrl=e,this.supabaseKey=t,!e)throw new Error("supabaseUrl is required.");if(!t)throw new Error("supabaseKey is required.");const o=e.replace(/\/$/,"");this.realtimeUrl=`${o}/realtime/v1`.replace(/^http/i,"ws"),this.authUrl=`${o}/auth/v1`,this.storageUrl=`${o}/storage/v1`,this.functionsUrl=`${o}/functions/v1`;const a=`sb-${new URL(this.authUrl).hostname.split(".")[0]}-auth-token`,l=function(e,t){const{db:r,auth:s,realtime:n,global:i}=e,{db:o,auth:a,realtime:l,global:c}=t,h={db:Object.assign(Object.assign({},o),r),auth:Object.assign(Object.assign({},a),s),realtime:Object.assign(Object.assign({},l),n),global:Object.assign(Object.assign({},c),i),accessToken:()=>{return e=this,t=void 0,s=function*(){return""},new((r=void 0)||(r=Promise))((function(n,i){function o(e){try{l(s.next(e))}catch(e){i(e)}}function a(e){try{l(s.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(o,a)}l((s=s.apply(e,t||[])).next())}));var e,t,r,s}};return e.accessToken?h.accessToken=e.accessToken:delete h.accessToken,h}(null!=r?r:{},{db:Se,realtime:Te,auth:Object.assign(Object.assign({},Pe),{storageKey:a}),global:Ee});this.storageKey=null!==(s=l.auth.storageKey)&&void 0!==s?s:"",this.headers=null!==(n=l.global.headers)&&void 0!==n?n:{},l.accessToken?(this.accessToken=l.accessToken,this.auth=new Proxy({},{get:(e,t)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(t)} is not possible`)}})):this.auth=this._initSupabaseAuthClient(null!==(i=l.auth)&&void 0!==i?i:{},this.headers,l.global.fetch),this.fetch=Oe(t,this._getAccessToken.bind(this),l.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers},l.realtime)),this.rest=new _(`${o}/rest/v1`,{headers:this.headers,schema:l.db.schema,fetch:this.fetch}),l.accessToken||this._listenForAuthEvents()}get functions(){return new w(this.functionsUrl,{headers:this.headers,customFetch:this.fetch})}get storage(){return new ke(this.storageUrl,this.headers,this.fetch)}from(e){return this.rest.from(e)}schema(e){return this.rest.schema(e)}rpc(e,t={},r={}){return this.rest.rpc(e,t,r)}channel(e,t={config:{}}){return this.realtime.channel(e,t)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){var e,t,r,s,n,i;return r=this,s=void 0,i=function*(){if(this.accessToken)return yield this.accessToken();const{data:r}=yield this.auth.getSession();return null!==(t=null===(e=r.session)||void 0===e?void 0:e.access_token)&&void 0!==t?t:null},new((n=void 0)||(n=Promise))((function(e,t){function o(e){try{l(i.next(e))}catch(e){t(e)}}function a(e){try{l(i.throw(e))}catch(e){t(e)}}function l(t){var r;t.done?e(t.value):(r=t.value,r instanceof n?r:new n((function(e){e(r)}))).then(o,a)}l((i=i.apply(r,s||[])).next())}))}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:t,detectSessionInUrl:r,storage:s,storageKey:n,flowType:i,lock:o,debug:a},l,c){var h;const u={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new Ot({url:this.authUrl,headers:Object.assign(Object.assign({},u),l),storageKey:n,autoRefreshToken:e,persistSession:t,detectSessionInUrl:r,storage:s,flowType:i,lock:o,debug:a,fetch:c,hasCustomAuthorizationHeader:null!==(h="Authorization"in this.headers)&&void 0!==h&&h})}_initRealtimeClient(e){return new ee(this.realtimeUrl,Object.assign(Object.assign({},e),{params:Object.assign({apikey:this.supabaseKey},null==e?void 0:e.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange(((e,t)=>{this._handleTokenChanged(e,"CLIENT",null==t?void 0:t.access_token)}))}_handleTokenChanged(e,t,r){"TOKEN_REFRESHED"!==e&&"SIGNED_IN"!==e||this.changedAccessToken===r?"SIGNED_OUT"===e&&(this.realtime.setAuth(this.supabaseKey),"STORAGE"==t&&this.auth.signOut(),this.changedAccessToken=void 0):(this.realtime.setAuth(null!=r?r:null),this.changedAccessToken=r)}}("https://vttiicmlzxzxrcyyewfn.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZ0dGlpY21senh6eHJjeXlld2ZuIiwicm9sZSI6ImFub24iLCJpYXQiOjE2OTgwNTgwNzUsImV4cCI6MjAxMzYzNDA3NX0.Pxu-gsXoxazhKDcT1VvbzfYA2kyjiG07rphZmWvCEAg",undefined);const It=(0,u.createContext)(),At=function(e){const[t,r]=(0,u.useState)(!1),[s,n]=(0,u.useState)([]),[i,o]=(0,u.useState)(!1),[l,c]=(0,u.useState)(""),[h,d]=(0,u.useState)(!1),[p,f]=(0,u.useState)(!1),[m,g]=(0,u.useState)(!1),[v,w]=(0,u.useState)([]),[y,_]=(0,u.useState)([]),[b,k]=(0,u.useState)(""),[C,E]=(0,u.useState)([]),[S,P]=(0,u.useState)([]),[T,x]=(0,u.useState)([]),[j,O]=(0,u.useState)([]),[$,I]=(0,u.useState)([]),[A,R]=(0,u.useState)([]),[L,M]=(0,u.useState)([]),[N,F]=(0,u.useState)("ascending"),[D,U]=(0,u.useState)("slug"),[H,B]=(0,u.useState)(!1),[z,V]=(0,u.useState)(!1),[q,G]=(0,u.useState)(!1),[J,K]=(0,u.useState)(!1);async function W(e){try{const{data:t,error:r}=await $t.from("patterns").select("*").eq("id",e);if(r)throw r;return t[0]}catch(e){c(e.message)}}return(0,u.useEffect)((()=>{!0===e.isModalOpen&&(t||async function(){const{data:{user:e}}=await $t.auth.getUser();try{return e.id}catch(e){c(e.message)}}().then((e=>{e&&r(e)})),C&&!C.length>0&&E(ollie_pattern_options.downloaded_patterns),S.length&&(E([...C,...S]),P([])),T.length&&(E(C.filter((e=>!T.includes(e)))),x([])),t&&(A&&!A.length>0&&(async function(e){try{const{data:t,error:r}=await $t.from("relations_pattern_favorite").select("*").eq("user_id",e);if(r)throw r;return t}catch(e){c(e.message)}}(t).then((e=>{R(e)})),async function(e){try{const{data:t,error:r}=await $t.from("relations_pattern_favorite").select("*").eq("user_id",e);if(r)throw r;let s=[];return t.forEach((e=>{W(e.pattern_id).then((e=>{e&&s.push(e.slug.replace("/","-"))}))})),s}catch(e){c(e.message)}}(t).then((e=>{M(e)}))),j.length&&(M([...L,...j]),O([])),$.length&&(M(L.filter((e=>!$.includes(e)))),I([]))))}),[e,A,L,C,t,S,T,j,$]),(0,a.createElement)(It.Provider,{value:{setPatternsToAdd:P,setPatternsToDelete:x,setPatternsToAddFavorites:O,setPatternsToDeleteFavorites:I,patternsToAddFavorites:j,patternsToDeleteFavorites:$,loadPatterns:J,patterns:s,userId:t,getPattern:W,setPatterns:n,errorMessage:l,showAddPattern:i,setShowAddPattern:o,getPatterns:async function(){K(!0);try{let e={ascending:"ascending"===N},t=$t.from("patterns").select().order(D,e);p&&(t=t.select("*,relations_pattern_collection (collection_id)").eq("relations_pattern_collection.collection_id",p).order(D,e)),m&&(t=t.select("*,relations_pattern_category (category_id)").eq("relations_pattern_category.category_id",m).order(D,e)),b&&(t=t.textSearch("title_content",`${b}*`));let{data:r,error:s}=await t;if(s)throw s;if(H||z){let e=[];r.forEach((t=>{if(z&&A.find((e=>e.pattern_id===t.id))&&e.push(t),H){let r=t.slug.replace("/","-");C.find((e=>e===r))&&e.push(t)}})),r=e}if(p){let e=[];r.forEach((t=>{t.relations_pattern_collection&&t.relations_pattern_collection.forEach((r=>{r.collection_id===p&&e.push(t)}))})),e.length>0?(n(e),K(!1)):(n(r),K(!1))}else if(m){let e=[];r.forEach((t=>{t.relations_pattern_category&&t.relations_pattern_category.forEach((r=>{r.category_id===m&&e.push(t)}))})),e.length>0?(n(e),K(!1)):(n(r),K(!1))}else n(r),K(!1)}catch(e){c(e.message)}},getPatternMeta:async function(e){try{const{data:t,error:r}=await $t.from("patterns_meta").select("*").eq("pattern_id",e);if(r)throw r;return t[0]}catch(e){c(e.message)}},downloadedPatterns:C,setDownloadedPatterns:E,selectedPatterns:v,setSelectedPatterns:w,selectedPatternsBlocks:y,setSelectedPatternsBlocks:_,getCollection:async function(e){try{const{data:t,error:r}=await $t.from("patterns_collections").select("*").eq("id",e);if(r)throw r;return t[0]}catch(e){c(e.message)}},getCollections:async function(){try{let e={ascending:"ascending"===N};const{data:t,error:r}=await $t.from("patterns_collections").select("*").order(D,e);if(r)throw r;return t}catch(e){c(e.message)}},selectedCollection:p,setSelectedCollection:f,getRelatedCollection:async function(e){try{const{data:t,error:r}=await $t.from("relations_pattern_collection").select("*").eq("pattern_id",e);if(r)throw r;return t[0]}catch(e){c(e.message)}},getCategories:async function(){try{let e={ascending:"ascending"===N};const{data:t,error:r}=await $t.from("patterns_categories").select("*").order(D,e);if(r)throw r;return t}catch(e){c(e.message)}},getCategory:async function(e){try{const{data:t,error:r}=await $t.from("patterns_categories").select("*").eq("id",e);if(r)throw r;return t[0]}catch(e){c(e.message)}},getRelatedCategories:async function(e){try{const{data:t,error:r}=await $t.from("relations_pattern_category").select("*").eq("pattern_id",e);if(r)throw r;return t}catch(e){c(e.message)}},selectedCategory:m,setSelectedCategory:g,favoritePatterns:A,setFavoritePatterns:R,favoritePatternsSlugs:L,setFavoritePatternsSlugs:M,saveFavorite:async function(e){try{const{data:r,error:s}=await $t.from("relations_pattern_favorite").insert([{pattern_id:e,user_id:t}]).select();if(s)throw s;return r}catch(e){c(e.message)}},searchTerm:b,setSearchTerm:k,filterByFavorite:z,setFilterByFavorite:V,removeFavorite:async function(e){try{const{data:r,error:s}=await $t.from("relations_pattern_favorite").delete().eq("pattern_id",e).eq("user_id",t);if(s)throw s;return r}catch(e){c(e.message)}},filterByDownload:H,setFilterByDownload:B,sortingDirection:N,setSortingDirection:F,sortingField:D,setSortingField:U,isPreview:h,setIsPreview:d,previewPattern:q,setPreviewPattern:G}},e.children)},Rt=window.wp.apiFetch;var Lt=o.n(Rt);const Mt=window.wp.data;function Nt(e){Lt()({path:"/ollie/v1/patterns/download",method:"POST",data:e}).then((e=>e))}function Ft(e){Lt()({path:"/ollie/v1/patterns/delete",method:"POST",data:e}).then((e=>e))}function Dt(e,t){let r=wp.data.select("core/block-editor").getSelectedBlock(),s=(0,l.parse)(e.content);t&&(s=(0,l.parse)(e.dynamic_content)),(0,Mt.dispatch)("core/block-editor").replaceBlock(r.clientId,s)}const Ut=window.wp.primitives,Ht=(0,a.createElement)(Ut.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},(0,a.createElement)(Ut.Path,{d:"M12 4.75a7.25 7.25 0 100 14.5 7.25 7.25 0 000-14.5zM3.25 12a8.75 8.75 0 1117.5 0 8.75 8.75 0 01-17.5 0zM12 8.75a1.5 1.5 0 01.167 2.99c-.465.052-.917.44-.917 1.01V14h1.5v-.845A3 3 0 109 10.25h1.5a1.5 1.5 0 011.5-1.5zM11.25 15v1.5h1.5V15h-1.5z"})),{__}=wp.i18n,Bt=function(e){const{getPatternMeta:t,getRelatedCategories:r,getCategory:s,downloadedPatterns:n,setDownloadedPatterns:i,favoritePatterns:o,favoritePatternsSlugs:l,setFavoritePatterns:c,setFavoritePatternsSlugs:h,saveFavorite:p,removeFavorite:f}=(0,u.useContext)(It),[m,g]=(0,u.useState)(!1),v=(e,t)=>{Dt(e,t)},w=e=>{let t=e.slug.replace("/","-");return n.includes(t)},y=()=>{w(e.pattern)?(e=>{let t=e.slug.replace("/","-");i(n.filter((e=>e!==t))),Ft(e)})(e.pattern):(e=>{let o=e.slug.replace("/","-");i([...n,o]),e.categories=[],r(e.id).then((t=>{t.forEach((t=>{s(t.category_id).then((t=>{e.categories.push(t.slug)}))}))})).then((()=>{t(e.id).then((t=>{t.description&&(e.description=t.description),t.keywords&&(e.keywords=t.keywords)})).then((()=>{Nt(e)}))}))})(e.pattern)};return(0,a.createElement)(d.Flex,{className:"ollie-pattern-actions"},(0,a.createElement)(d.FlexItem,null,(0,a.createElement)(d.Flex,{direction:"column",gap:"5"},(0,a.createElement)("h3",{style:{marginBottom:0}},__("Pattern Actions","ollie-pro")),(0,a.createElement)(d.FlexItem,{className:"ollie-pattern-action-entry"},(0,a.createElement)(d.Flex,{justify:"flex-start",gap:1},(0,a.createElement)("strong",null,__("Insert on current page","ollie-pro")," ")),(0,a.createElement)(d.Button,{variant:"secondary",className:"pattern-insert",onClick:()=>{v(e.pattern,!1)},text:__("Insert Pattern","ollie-pro")})),e.pattern.dynamic_content&&(0,a.createElement)(d.FlexItem,{className:"ollie-pattern-action-entry"},(0,a.createElement)(d.Flex,{justify:"flex-start",gap:1},(0,a.createElement)("strong",null,__("Insert dynamic pattern","ollie-pro")," ")),(0,a.createElement)(d.Button,{variant:"secondary",className:"pattern-insert",onClick:()=>{v(e.pattern,!0)},text:__("Insert Dynamic Pattern","ollie-pro")})),(0,a.createElement)(d.FlexItem,{className:"ollie-pattern-action-entry"},(0,a.createElement)(d.Flex,{justify:"flex-start",gap:1},(0,a.createElement)("strong",null,__("Copy pattern blocks","ollie-pro")," ")),(0,a.createElement)(d.ClipboardButton,{variant:"secondary",text:e.pattern.content,onCopy:()=>g(!0),onFinishCopy:()=>g(!1)},m?"Copied!":"Copy Pattern Blocks")),(0,a.createElement)(d.FlexItem,{className:"ollie-pattern-action-entry"},(0,a.createElement)(d.Flex,{justify:"flex-start",gap:1},(0,a.createElement)("strong",null,__("Download pattern to theme","ollie-pro")," "),(0,a.createElement)(d.Tooltip,{text:__("Download the pattern to your theme's pattern library to edit and customize","ollie-pro"),delay:0},(0,a.createElement)(d.Icon,{icon:Ht,size:18}))),(0,a.createElement)(d.Button,{variant:"secondary",className:"pattern-insert",onClick:()=>{w(e.pattern)?window.confirm(__("Heads up, this will remove the pattern file from your theme. If you've customized the pattern, the changes will be lost.","ollie-pro"))&&y():(console.log(e.pattern),y())},text:w(e.pattern)?__("Remove Pattern","ollie-pro"):__("Download Pattern","ollie-pro")})),(e=>{let t=e.slug.replace("/","-");return l.includes(t)})(e.pattern)?(0,a.createElement)(d.FlexItem,{className:"ollie-pattern-action-entry"},(0,a.createElement)(d.Flex,{justify:"flex-start",gap:1},(0,a.createElement)("strong",null,__("Remove from favorites","ollie-pro")," ")),(0,a.createElement)(d.Button,{variant:"secondary",className:"pattern-insert",onClick:()=>{(e=>{let t=e.id,r=e.slug.replace("/","-");f(t),c(o.filter((e=>e.pattern_id!==t))),h(l.filter((e=>e.slug!==r)))})(e.pattern)},text:__("Remove from Favorites","ollie-pro")})):(0,a.createElement)(d.FlexItem,{className:"ollie-pattern-action-entry"},(0,a.createElement)(d.Flex,{justify:"flex-start",gap:1},(0,a.createElement)("strong",null,__("Add To Favorites","ollie-pro")," ")),(0,a.createElement)(d.Button,{variant:"secondary",className:"pattern-insert",onClick:()=>{(e=>{let t=e.id,r=e.slug.replace("/","-");p(t),c([...o,{pattern_id:t}]),h([...l,r])})(e.pattern)},text:__("Add to Favorites","ollie-pro")})))))},zt=(0,a.createElement)(Ut.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},(0,a.createElement)(Ut.Path,{d:"M14.6 7l-1.2-1L8 12l5.4 6 1.2-1-4.6-5z"})),Vt=(0,a.createElement)(Ut.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},(0,a.createElement)(Ut.Path,{d:"M10.8622 8.04053L14.2805 12.0286L10.8622 16.0167L9.72327 15.0405L12.3049 12.0286L9.72327 9.01672L10.8622 8.04053Z"})),{__:qt}=wp.i18n,Gt=function({pattern:e}){const{getCollection:t,selectedCollection:r,setSelectedCollection:s,getCategories:n,getCategory:i,setSelectedCategory:o,selectedCategory:l,getCollections:c,isPreview:h,setIsPreview:p}=(0,u.useContext)(It),[f,m]=(0,u.useState)([]),[g,v]=(0,u.useState)([]),[w,y]=(0,u.useState)([]),[_,b]=(0,u.useState)(!1),[k,C]=(0,u.useState)(!1),[E,S]=(0,u.useState)(null),P=(e,t)=>{s(!!e&&e.id),o(!!t&&t.id)};return(0,u.useEffect)((()=>{var s,o;0===f.length&&c().then((e=>{e&&m(e)})),0===g.length&&n().then((e=>{e&&v(e)})),r&&((s=r)?t(s).then((e=>{b(e)})):b(!1)),l&&((o=l)?i(o).then((e=>{C(e)})):C(!1)),e.categories&&0===w.length&&(e=>{e.forEach((e=>{i(e.category_id).then((e=>{y((t=>[...t,e]))}))}))})(e.categories)}),[f,r,g,l,w,e]),(0,a.createElement)("div",{className:"ollie-patterns-sidebar "+(r||l||h?"ollie-patterns-sidebar-single":"")},r&&!h?(0,a.createElement)(a.Fragment,null,(0,a.createElement)(d.Button,{variant:"secondary",className:"ollie-back-overview has-text",onClick:()=>{P(!1,!1)},icon:zt,text:qt("Go Back","ollie-pro")}),(0,a.createElement)(d.Flex,{direction:"column",gap:5,expanded:!1},(0,a.createElement)(d.Flex,{direction:"column",gap:0},(0,a.createElement)("h2",null,_.title),_.description&&(0,a.createElement)("p",null,_.description)),(0,a.createElement)(d.__experimentalDivider,{margin:"2",style:{color:"#d8d8d8"}}),(0,a.createElement)(d.Flex,{direction:"column",gap:0},(0,a.createElement)("p",null,qt("This collection uses the","ollie-pro")," ",_.title," ",qt("style variation in the Ollie theme.","ollie-pro")),(0,a.createElement)("p",null,(0,a.createElement)(d.ExternalLink,{href:"https://olliewp.com/docs"},qt("Learn about style variations","ollie-pro")))))):(0,a.createElement)(a.Fragment,null,l&&!h?(0,a.createElement)(a.Fragment,null,(0,a.createElement)(d.Button,{variant:"secondary",className:"ollie-back-overview has-text",onClick:()=>{P(!1,!1)},icon:zt,text:qt("Go Back","ollie-pro")}),(0,a.createElement)("h2",null,k.title),k.description&&(0,a.createElement)("p",null,k.description)):(0,a.createElement)(a.Fragment,null,h?(0,a.createElement)(a.Fragment,null,(0,a.createElement)(d.Button,{variant:"secondary",className:"ollie-back-overview has-text",onClick:()=>p(!1),icon:zt,text:qt("Go Back","ollie-pro")}),(0,a.createElement)(d.Flex,{direction:"column",gap:5,expanded:!1},(0,a.createElement)(d.Flex,{direction:"column",gap:0},(0,a.createElement)("h2",null,e.title),e.description&&(0,a.createElement)("p",null,e.description),e.collection&&(0,a.createElement)("p",null,(0,a.createElement)("b",null,"Collection: "),(0,a.createElement)(d.Button,{isLink:!0,onClick:()=>{return t=e.collection,p(!1),o(!1),s(t.id),void P(t,!1);var t}},e.collection.title))),(0,a.createElement)(d.__experimentalDivider,{margin:"2",style:{color:"#d8d8d8"}}),(0,a.createElement)(Bt,{pattern:e}),(0,a.createElement)(d.__experimentalDivider,{margin:"2",style:{color:"#d8d8d8"}}),(0,a.createElement)(d.Flex,{direction:"column",gap:1,className:"ollie-pattern-meta"},w&&(0,a.createElement)("div",null,(0,a.createElement)("h3",null,qt("Pattern Categories","ollie-pro")),(0,a.createElement)("ul",{className:"ollie-category-buttons"},w.map((e=>(0,a.createElement)("li",{key:e.id},(0,a.createElement)(d.Button,{variant:"tertiary",className:"has-text block-editor-block-patterns-explorer__sidebar__categories-list__item",onClick:()=>{(e=>{p(!1),o(!1),y([]),P(!1,e)})(e)},text:e.title,icon:Vt,iconPosition:"right"}))))))))):(0,a.createElement)(d.Flex,{direction:"column",gap:5,expanded:!1},(0,a.createElement)(d.FlexItem,null,(0,a.createElement)("h3",null,qt("Pattern Collections","ollie-pro")),(0,a.createElement)("ul",{className:"ollie-category-buttons"},f&&f.map((e=>(0,a.createElement)("li",{key:e.id},(0,a.createElement)(d.Button,{variant:"tertiary",className:"has-text block-editor-block-patterns-explorer__sidebar__categories-list__item",onClick:()=>{P(e,!1)},text:e.title,icon:Vt,iconPosition:"right"})))))),(0,a.createElement)(d.FlexItem,null,(0,a.createElement)("h3",null,qt("Pattern Categories","ollie-pro")),(0,a.createElement)("ul",{className:"ollie-category-buttons"},g&&g.map((e=>(0,a.createElement)("li",{key:e.id},(0,a.createElement)(d.Button,{variant:"tertiary",className:"has-text block-editor-block-patterns-explorer__sidebar__categories-list__item",onClick:()=>{P(!1,e)},text:e.title,icon:Vt,iconPosition:"right"}))))))))))},Jt=(0,a.createElement)(Ut.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},(0,a.createElement)(Ut.Path,{d:"M15 4H9c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h6c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm.5 14c0 .3-.2.5-.5.5H9c-.3 0-.5-.2-.5-.5V6c0-.3.2-.5.5-.5h6c.3 0 .5.2.5.5v12zm-4.5-.5h2V16h-2v1.5z"})),Kt=(0,a.createElement)(Ut.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},(0,a.createElement)(Ut.Path,{d:"M17 4H7c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h10c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm.5 14c0 .3-.2.5-.5.5H7c-.3 0-.5-.2-.5-.5V6c0-.3.2-.5.5-.5h10c.3 0 .5.2.5.5v12zm-7.5-.5h4V16h-4v1.5z"})),Wt=(0,a.createElement)(Ut.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},(0,a.createElement)(Ut.Path,{d:"M20.5 16h-.7V8c0-1.1-.9-2-2-2H6.2c-1.1 0-2 .9-2 2v8h-.7c-.8 0-1.5.7-1.5 1.5h20c0-.8-.7-1.5-1.5-1.5zM5.7 8c0-.3.2-.5.5-.5h11.6c.3 0 .5.2.5.5v7.6H5.7V8z"})),{__:Zt}=wp.i18n,Yt=function(e){const{isPreview:t}=(0,u.useContext)(It),[r,s]=(0,u.useState)("100%"),[n,i]=(0,u.useState)("desktop");return(0,a.createElement)(a.Fragment,null,t&&(0,a.createElement)(a.Fragment,null,(0,a.createElement)(d.Flex,{justify:"center",align:"center",className:"ollie-pattern-iframe-resize",gap:"4px"},(0,a.createElement)(d.FlexItem,null,(0,a.createElement)(d.Button,{className:"mobile"===n?"ollie-resize-active":"",variant:"tertiary",label:Zt("Preview mobile design","ollie-pro"),text:Zt("Mobile","ollie-pro"),icon:Jt,onClick:()=>{s("500px"),i("mobile")}})),(0,a.createElement)(d.FlexItem,null,(0,a.createElement)(d.Button,{className:"tablet"===n?"ollie-resize-active":"",variant:"tertiary",label:Zt("Preview tablet design","ollie-pro"),text:Zt("Tablet","ollie-pro"),icon:Kt,onClick:()=>{s("781px"),i("tablet")}})),(0,a.createElement)(d.FlexItem,null,(0,a.createElement)(d.Button,{className:"desktop"===n?"ollie-resize-active":"",variant:"tertiary",label:Zt("Preview desktop design","ollie-pro"),text:Zt("Desktop","ollie-pro"),icon:Wt,onClick:()=>{s("100%"),i("desktop")}}))),(0,a.createElement)(d.Flex,{className:"ollie-pattern-single"},(0,a.createElement)(d.FlexItem,{isBlock:!0},(0,a.createElement)("iframe",{src:`https://patterns.olliewp.com/${e.pattern.slug}/`,style:{width:r,transition:"width 0.3s"}})))))},Xt=(0,a.createElement)(Ut.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},(0,a.createElement)(Ut.Path,{d:"M13 19h-2v-2h2v2zm0-6h-2v-2h2v2zm0-6h-2V5h2v2z"}));function Qt({fillColor:e}){return(0,a.createElement)("svg",{width:"30",height:"26",viewBox:"0 0 30 26",fill:"none",xmlns:"http://www.w3.org/2000/svg"},(0,a.createElement)("path",{d:"M27.4604 2.45287C26.0088 1.00559 24.0435 0.191518 21.9937 0.188473C19.9439 0.185428 17.9762 0.993654 16.5204 2.43662L15.2304 3.63412L13.9404 2.43662C12.485 0.984891 10.5125 0.170767 8.45688 0.173346C6.40124 0.175925 4.43083 0.994995 2.9791 2.45037C1.52737 3.90575 0.713248 5.87821 0.715826 7.93384C0.718405 9.98948 1.53748 11.9599 2.99285 13.4116L14.1616 24.7429C14.3012 24.8846 14.4675 24.9971 14.651 25.074C14.8345 25.1508 15.0314 25.1904 15.2304 25.1904C15.4293 25.1904 15.6262 25.1508 15.8097 25.074C15.9932 24.9971 16.1595 24.8846 16.2991 24.7429L27.4604 13.4191C28.1804 12.6994 28.7515 11.8449 29.1412 10.9044C29.5309 9.96394 29.7314 8.95589 29.7314 7.93787C29.7314 6.91985 29.5309 5.9118 29.1412 4.97131C28.7515 4.03082 28.1804 3.17632 27.4604 2.45662V2.45287ZM25.3354 11.3016L15.2304 21.5491L5.1216 11.2929C4.23385 10.4014 3.73601 9.19423 3.73731 7.93616C3.73862 6.67809 4.23896 5.47191 5.12855 4.58232C6.01814 3.69273 7.22432 3.19239 8.48239 3.19108C9.74046 3.18978 10.9477 3.68762 11.8391 4.57537C11.8516 4.58787 11.8641 4.60037 11.8779 4.61162L14.2079 6.78162C14.4855 7.0403 14.8509 7.18413 15.2304 7.18413C15.6098 7.18413 15.9752 7.0403 16.2528 6.78162L18.5829 4.61162C18.5966 4.60037 18.6091 4.58787 18.6216 4.57537C19.0633 4.13479 19.5874 3.7855 20.164 3.54747C20.7406 3.30944 21.3585 3.18731 21.9823 3.18806C22.6062 3.18882 23.2238 3.31244 23.7998 3.55187C24.3759 3.7913 24.8991 4.14184 25.3397 4.5835C25.7803 5.02515 26.1296 5.54925 26.3676 6.12589C26.6057 6.70253 26.7278 7.3204 26.727 7.94424C26.7263 8.56808 26.6027 9.18565 26.3632 9.76171C26.1238 10.3378 25.7733 10.861 25.3316 11.3016H25.3354Z",fill:e}))}function er({fillColor:e}){return(0,a.createElement)("svg",{width:"28",height:"28",viewBox:"0 0 28 28",fill:"none",xmlns:"http://www.w3.org/2000/svg"},(0,a.createElement)("path",{d:"M14 0.5C11.33 0.5 8.71987 1.29176 6.49981 2.77516C4.27974 4.25856 2.54942 6.36697 1.52763 8.83377C0.505849 11.3006 0.238504 14.015 0.759405 16.6337C1.28031 19.2525 2.56606 21.6579 4.45406 23.5459C6.34207 25.434 8.74754 26.7197 11.3663 27.2406C13.985 27.7615 16.6994 27.4942 19.1662 26.4724C21.633 25.4506 23.7414 23.7203 25.2248 21.5002C26.7082 19.2801 27.5 16.67 27.5 14C27.496 10.4208 26.0724 6.98932 23.5416 4.45844C21.0107 1.92756 17.5792 0.50397 14 0.5ZM14 24.5C11.9233 24.5 9.89323 23.8842 8.16652 22.7304C6.4398 21.5767 5.09399 19.9368 4.29927 18.0182C3.50455 16.0996 3.29662 13.9884 3.70176 11.9516C4.10691 9.91475 5.10693 8.04383 6.57538 6.57538C8.04384 5.10693 9.91476 4.1069 11.9516 3.70175C13.9884 3.29661 16.0996 3.50454 18.0182 4.29926C19.9368 5.09399 21.5767 6.4398 22.7304 8.16651C23.8842 9.89323 24.5 11.9233 24.5 14C24.497 16.7839 23.3898 19.4528 21.4213 21.4213C19.4529 23.3898 16.7839 24.497 14 24.5ZM19.0613 13.9388C19.2011 14.0781 19.3121 14.2437 19.3878 14.426C19.4635 14.6083 19.5024 14.8038 19.5024 15.0012C19.5024 15.1987 19.4635 15.3941 19.3878 15.5765C19.3121 15.7588 19.2011 15.9244 19.0613 16.0637L15.0613 20.0637C14.9219 20.2036 14.7563 20.3145 14.574 20.3903C14.3917 20.466 14.1962 20.5049 13.9988 20.5049C13.8013 20.5049 13.6059 20.466 13.4235 20.3903C13.2412 20.3145 13.0756 20.2036 12.9363 20.0637L8.93626 16.0637C8.79673 15.9242 8.68605 15.7586 8.61053 15.5763C8.53502 15.394 8.49615 15.1986 8.49615 15.0012C8.49615 14.8039 8.53502 14.6085 8.61053 14.4262C8.68605 14.2439 8.79673 14.0783 8.93626 13.9388C9.07578 13.7992 9.24143 13.6885 9.42373 13.613C9.60604 13.5375 9.80143 13.4986 9.99876 13.4986C10.1961 13.4986 10.3915 13.5375 10.5738 13.613C10.7561 13.6885 10.9217 13.7992 11.0613 13.9388L12.5 15.375V9C12.5 8.60218 12.658 8.22064 12.9393 7.93934C13.2206 7.65804 13.6022 7.5 14 7.5C14.3978 7.5 14.7794 7.65804 15.0607 7.93934C15.342 8.22064 15.5 8.60218 15.5 9V15.375L16.9388 13.935C17.0783 13.7958 17.2439 13.6854 17.4262 13.6103C17.6084 13.5351 17.8037 13.4966 18.0008 13.4969C18.1979 13.4973 18.393 13.5365 18.575 13.6123C18.757 13.6881 18.9222 13.799 19.0613 13.9388Z",fill:e}))}const tr=o.p+"images/ollie-placeholder.76176486.webp",{__:rr}=wp.i18n,sr=function({pattern:e,isPatternSelected:t,preparePreview:r,gridView:s}){const{getPatternMeta:n,getRelatedCategories:i,getCategory:o,downloadedPatterns:c,setDownloadedPatterns:h,favoritePatterns:p,setFavoritePatterns:f,favoritePatternsSlugs:m,setFavoritePatternsSlugs:g,saveFavorite:v,removeFavorite:w,selectedPatterns:y,setSelectedPatterns:_,selectedPatternsBlocks:b,setSelectedPatternsBlocks:k}=(0,u.useContext)(It),C=e=>{let t=e.slug.replace("/","-");return m.includes(t)},E=e=>{let t=e.slug.replace("/","-");return c.includes(t)};return(0,u.useEffect)((()=>{}),[s]),(0,a.createElement)(d.__experimentalVStack,{spacing:"0",className:"ollie-pattern "+(t(e.id)?"ollie-pattern-selected":""),key:e.id,"data-id":e.id},(0,a.createElement)("div",{className:"ollie-pattern-preview",onClick:()=>{r(e)}},(0,a.createElement)("div",{className:"ollie-pattern-preview-inside"},(0,a.createElement)("object",{data:`https://vttiicmlzxzxrcyyewfn.supabase.co/storage/v1/object/public/screenshots/${e.slug}.webp`,type:"image/webp"},(0,a.createElement)("img",{loading:"lazy",src:tr,alt:rr("Ollie Pattern Preview","ollie-pro")})))),(0,a.createElement)(d.__experimentalHStack,{className:"ollie-pattern-header"},(0,a.createElement)(d.CheckboxControl,{className:"ollie-pattern-checkbox",checked:t(e.id),onChange:t=>{t?(_([...y,e.id]),k([...b,(0,l.parse)(e.content)])):(_(y.filter((t=>t!==e.id))),k(b.filter((t=>t!==(0,l.parse)(e.content)))))}}),(0,a.createElement)(d.__experimentalHStack,{alignment:"center",justify:"flex-start",spacing:2},(0,a.createElement)(d.Flex,{as:"div",gap:0,justify:"left",className:"ollie-pattern-title"},(0,a.createElement)(d.Button,{variant:"link",label:rr("Pattern Details","ollie-pro"),text:e.title,tabIndex:"-1",onClick:()=>{r(e)}}))),(0,a.createElement)(d.__experimentalHStack,{className:"ollie-pattern-status",alignment:"right",expanded:!1,spacing:"5px"},C(e)?(0,a.createElement)(d.Tooltip,{text:rr("Added to favorites","ollie-pro")},(0,a.createElement)("span",null,(0,a.createElement)(d.Icon,{icon:Qt}))):"",E(e)?(0,a.createElement)(d.Tooltip,{text:rr("Added to theme","ollie-pro")},(0,a.createElement)("span",null,(0,a.createElement)(d.Icon,{icon:er}))):""),(0,a.createElement)(d.DropdownMenu,{icon:Xt,iconSize:24,label:rr("Pattern Actions","ollie-pro")},(({onClose:t})=>(0,a.createElement)(a.Fragment,null,(0,a.createElement)(d.MenuGroup,{className:"ollie-pattern-action-drop"},(0,a.createElement)(d.MenuItem,{onClick:()=>{r(e)}},rr("Pattern Details","ollie-pro")),(0,a.createElement)(d.MenuItem,{onClick:()=>{(e=>{Dt(e,!1)})(e)}},rr("Insert Into Page","ollie-pro")),E(e)?(0,a.createElement)(d.MenuItem,{onClick:()=>{(e=>{let t=e.slug.replace("/","-");h(c.filter((e=>e!==t))),Ft(e)})(e)}},rr("Remove from Theme","ollie-pro")):(0,a.createElement)(d.MenuItem,{onClick:()=>{(e=>{let t=e.slug.replace("/","-");h([...c,t]),e.categories=[],i(e.id).then((t=>{t.forEach((t=>{o(t.category_id).then((t=>{e.categories.push(t.slug)}))}))})).then((()=>{n(e.id).then((t=>{t.description&&(e.description=t.description),t.keywords&&(e.keywords=t.keywords)})).then((()=>{Nt(e)}))}))})(e)}},rr("Add To Theme","ollie-pro")),C(e)?(0,a.createElement)(d.MenuItem,{onClick:()=>{(e=>{let t=e.id,r=e.slug.replace("/","-");w(t),f(p.filter((e=>e.pattern_id!==t))),g(m.filter((e=>e!==r)))})(e)}},rr("Remove from Favorites","ollie-pro")):(0,a.createElement)(d.MenuItem,{onClick:()=>{(e=>{let t=e.id,r=e.slug.replace("/","-");v(t),f([...p,{pattern_id:t}]),g([...m,r])})(e)}},rr("Add to Favorites","ollie-pro"))))))))};function nr({fillColor:e}){return(0,a.createElement)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"},(0,a.createElement)("path",{d:"M80 80v96h96V80H80zM32 32H80h96 48V80v96 48H176 80 32V176 80 32zM80 336v96h96V336H80zM32 288H80h96 48v48 96 48H176 80 32V432 336 288zM432 80H336v96h96V80zM336 32h96 48V80v96 48H432 336 288V176 80 32h48zm0 304v96h96V336H336zm-48-48h48 96 48v48 96 48H432 336 288V432 336 288z"}))}function ir({fillColor:e}){return(0,a.createElement)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 448 512"},(0,a.createElement)("path",{d:"M88 72v48H40V72H88zM40 32H0V72v48 40H40 88h40V120 72 32H88 40zM88 232v48H40V232H88zM40 192H0v40 48 40H40 88h40V280 232 192H88 40zm0 200H88v48H40V392zM0 352v40 48 40H40 88h40V440 392 352H88 40 0zM248 72v48H200V72h48zM200 32H160V72v48 40h40 48 40V120 72 32H248 200zm0 200h48v48H200V232zm-40-40v40 48 40h40 48 40V280 232 192H248 200 160zm88 200v48H200V392h48zm-48-40H160v40 48 40h40 48 40V440 392 352H248 200zM360 72h48v48H360V72zM320 32V72v48 40h40 48 40V120 72 32H408 360 320zm88 200v48H360V232h48zm-48-40H320v40 48 40h40 48 40V280 232 192H408 360zm0 200h48v48H360V392zm-40-40v40 48 40h40 48 40V440 392 352H408 360 320z"}))}function or({fillColor:e}){return(0,a.createElement)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 448 512"},(0,a.createElement)("path",{d:"M0 32H89.6v89.6H0V32zM0 151.5H89.6v89.6H0V151.5zM89.6 270.9v89.6H0V270.9H89.6zM0 390.4H89.6V480H0V390.4zM119.5 32h89.6v89.6H119.5V32zm0 119.5h89.6v89.6H119.5V151.5zm89.6 119.5v89.6H119.5V270.9h89.6zM119.5 390.4h89.6V480H119.5V390.4zM328.5 32v89.6H238.9V32h89.6zm0 119.5v89.6H238.9V151.5h89.6zM238.9 270.9h89.6v89.6H238.9V270.9zm89.6 119.5V480H238.9V390.4h89.6zM358.4 32H448v89.6H358.4V32zm0 119.5H448v89.6H358.4V151.5zM448 270.9v89.6H358.4V270.9H448zM358.4 390.4H448V480H358.4V390.4z"}))}function ar({fillColor:e}){return(0,a.createElement)("svg",{width:"26",height:"22",viewBox:"0 0 26 22",fill:"none",xmlns:"http://www.w3.org/2000/svg"},(0,a.createElement)("path",{d:"M12 10C12 10.3978 11.842 10.7794 11.5607 11.0607C11.2794 11.342 10.8978 11.5 10.5 11.5H2C1.60218 11.5 1.22064 11.342 0.93934 11.0607C0.658035 10.7794 0.5 10.3978 0.5 10C0.5 9.60218 0.658035 9.22064 0.93934 8.93934C1.22064 8.65804 1.60218 8.5 2 8.5H10.5C10.8978 8.5 11.2794 8.65804 11.5607 8.93934C11.842 9.22064 12 9.60218 12 10ZM2 3.5H18.5C18.8978 3.5 19.2794 3.34196 19.5607 3.06066C19.842 2.77936 20 2.39782 20 2C20 1.60218 19.842 1.22064 19.5607 0.93934C19.2794 0.658035 18.8978 0.5 18.5 0.5H2C1.60218 0.5 1.22064 0.658035 0.93934 0.93934C0.658035 1.22064 0.5 1.60218 0.5 2C0.5 2.39782 0.658035 2.77936 0.93934 3.06066C1.22064 3.34196 1.60218 3.5 2 3.5ZM8.5 16.5H2C1.60218 16.5 1.22064 16.658 0.93934 16.9393C0.658035 17.2206 0.5 17.6022 0.5 18C0.5 18.3978 0.658035 18.7794 0.93934 19.0607C1.22064 19.342 1.60218 19.5 2 19.5H8.5C8.89782 19.5 9.27936 19.342 9.56066 19.0607C9.84196 18.7794 10 18.3978 10 18C10 17.6022 9.84196 17.2206 9.56066 16.9393C9.27936 16.658 8.89782 16.5 8.5 16.5ZM25.0613 13.9387C24.9219 13.7989 24.7563 13.688 24.574 13.6122C24.3917 13.5365 24.1962 13.4976 23.9988 13.4976C23.8013 13.4976 23.6059 13.5365 23.4235 13.6122C23.2412 13.688 23.0756 13.7989 22.9363 13.9387L20.5 16.375V8C20.5 7.60218 20.342 7.22064 20.0607 6.93934C19.7794 6.65804 19.3978 6.5 19 6.5C18.6022 6.5 18.2206 6.65804 17.9393 6.93934C17.658 7.22064 17.5 7.60218 17.5 8V16.375L15.0613 13.935C14.7795 13.6532 14.3973 13.4949 13.9988 13.4949C13.6002 13.4949 13.218 13.6532 12.9363 13.935C12.6545 14.2168 12.4961 14.599 12.4961 14.9975C12.4961 15.396 12.6545 15.7782 12.9363 16.06L17.9363 21.06C18.0756 21.1998 18.2412 21.3108 18.4235 21.3865C18.6059 21.4622 18.8013 21.5012 18.9988 21.5012C19.1962 21.5012 19.3917 21.4622 19.574 21.3865C19.7563 21.3108 19.9219 21.1998 20.0613 21.06L25.0613 16.06C25.3425 15.7787 25.5006 15.3972 25.5006 14.9994C25.5006 14.6016 25.3425 14.2201 25.0613 13.9387Z",fill:e}))}function lr({fillColor:e}){return(0,a.createElement)("svg",{width:"28",height:"26",viewBox:"0 0 28 26",fill:"none",xmlns:"http://www.w3.org/2000/svg"},(0,a.createElement)("path",{d:"M26.8378 2.41941C26.6419 1.97647 26.3215 1.59997 25.9156 1.33568C25.5098 1.07139 25.0359 0.930682 24.5515 0.930664H2.55152C2.06726 0.930711 1.59344 1.0714 1.18763 1.33563C0.781816 1.59987 0.46148 1.97628 0.265542 2.41912C0.0696046 2.86197 0.00649979 3.35219 0.0838951 3.83022C0.16129 4.30825 0.375854 4.75352 0.701517 5.11191L0.716516 5.12941L9.05152 14.0244V23.4307C9.05145 23.8833 9.17425 24.3274 9.40683 24.7157C9.63941 25.104 9.97303 25.4218 10.3721 25.6353C10.7712 25.8489 11.2207 25.9501 11.6728 25.9281C12.1249 25.9061 12.5625 25.7619 12.939 25.5107L16.939 22.8444C17.2815 22.6159 17.5622 22.3064 17.7563 21.9433C17.9504 21.5802 18.0518 21.1749 18.0515 20.7632V14.0244L26.3853 5.12941L26.4003 5.11191C26.7261 4.75371 26.9409 4.30857 27.0186 3.83059C27.0963 3.35261 27.0334 2.86237 26.8378 2.41941ZM15.7278 12.1169C15.2925 12.5798 15.0506 13.1915 15.0515 13.8269V20.4957L12.0515 22.4957V13.8269C12.0524 13.1915 11.8105 12.5798 11.3753 12.1169L3.70527 3.93066H23.3978L15.7278 12.1169Z",fill:e}))}function cr({fillColor:e}){return(0,a.createElement)("svg",{width:"33",height:"33",viewBox:"0 0 33 33",fill:"none",xmlns:"http://www.w3.org/2000/svg"},(0,a.createElement)("path",{d:"M28.997 8.88085L23.412 3.2946C23.1798 3.06235 22.9042 2.87811 22.6008 2.75241C22.2974 2.62671 21.9723 2.56201 21.6439 2.56201C21.3155 2.56201 20.9903 2.62671 20.6869 2.75241C20.3836 2.87811 20.1079 3.06235 19.8758 3.2946L4.462 18.7096C4.22901 18.9411 4.04428 19.2165 3.91854 19.5199C3.7928 19.8233 3.72854 20.1487 3.7295 20.4771V26.0634C3.7295 26.7264 3.99289 27.3623 4.46174 27.8311C4.93058 28.3 5.56646 28.5634 6.2295 28.5634H11.8158C12.1442 28.5642 12.4695 28.5 12.7729 28.3742C13.0763 28.2485 13.3517 28.0638 13.5833 27.8309L28.997 12.4159C29.4657 11.947 29.729 11.3113 29.729 10.6484C29.729 9.98544 29.4657 9.34967 28.997 8.88085ZM11.6045 25.5634H6.7295V20.6884L17.2295 10.1884L22.1045 15.0634L11.6045 25.5634ZM24.2295 12.9384L19.3545 8.06335L21.647 5.77085L26.522 10.6459L24.2295 12.9384Z",fill:e}))}const{__:hr}=wp.i18n,ur=function({gridView:e,setTwoColumn:t,setThreeColumn:r,setFourColumn:s,IconComponent:n,selectedCategory:i,selectedCollection:o}){const{patterns:c,getPattern:h,getPatternMeta:p,searchTerm:f,setSearchTerm:m,selectedPatterns:g,setSelectedPatterns:v,selectedPatternsBlocks:w,setSelectedPatternsBlocks:y,patternsToDelete:_,patternsToAdd:b,patternsToAddFavorites:k,patternsToDeleteFavorites:C,loadPatterns:E,setPatternsToAdd:S,setPatternsToDelete:P,setPatternsToAddFavorites:T,setPatternsToDeleteFavorites:x,getCollection:j,getCategory:O,setSortingDirection:$,setSortingField:I,setFilterByDownload:A,setFilterByFavorite:R,saveFavorite:L,removeFavorite:M}=(0,u.useContext)(It),[N,F]=(0,u.useState)(!1),[D,U]=(0,u.useState)(hr("Search patterns","ollie-pro")),H=(e,t)=>{$(e),I(t)},B=(e,t)=>{A(e),R(t)};return(0,u.useEffect)((()=>{o&&j(o).then((e=>{U(hr("Search in","ollie-pro")+" "+e.title)})),i&&O(i).then((e=>{U(hr("Search in","ollie-pro")+" "+e.title)})),i||o||U(hr("Search patterns","ollie-pro")),g.length>0?F(!0):F(!1)}),[g,i,o]),(0,a.createElement)("div",{className:"ollie-pattern-multiselect-actions"},(0,a.createElement)(d.Flex,{gap:6},(0,a.createElement)(d.__experimentalHStack,{spacing:"0",expanded:!1,justify:"flex-start"},(0,a.createElement)(d.SearchControl,{label:hr("Search patterns","ollie-pro"),placeholder:D,value:f,onChange:e=>{e.length>3?m(e.toLowerCase()):m("")}}),(0,a.createElement)(d.__experimentalHStack,{spacing:"0",expanded:!1,justify:"flex-start",className:`ollie-loading-status ${E&&"ollie-loading-status-visible"}`},(0,a.createElement)(d.Spinner,null),(0,a.createElement)("span",null,hr("Loading...","ollie-pro")))),(0,a.createElement)(d.FlexItem,null,(0,a.createElement)(d.Flex,{justify:"left",align:"center",className:"ollie-pattern-column-size",gap:"4px"},(0,a.createElement)(d.FlexItem,null,(0,a.createElement)(d.DropdownMenu,{className:"ollie-pattern-column-drop",icon:(0,a.createElement)(cr,null),text:hr("Bulk Edit","ollie-pro")},(({onClose:e})=>(0,a.createElement)(a.Fragment,null,(0,a.createElement)(d.MenuGroup,{className:"ollie-pattern-action-drop"},(0,a.createElement)(d.MenuItem,{onClick:()=>{g.forEach((e=>{h(e).then((e=>{p(e.id).then((t=>{t.description&&(e.description=t.description),t.keywords&&(e.keywords=t.keywords);let r=e.slug.replace("/","-");S(b?[...b,r]:[r]),Nt(e)}))}))})),v([])},disabled:!N,iconPosition:"left"},hr("Add to theme","ollie-pro")),(0,a.createElement)(d.MenuItem,{onClick:()=>{g.forEach((e=>{h(e).then((e=>{let t=e.slug.replace("/","-");P(_?[..._,t]:[t]),Ft(e)}))})),v([])},disabled:!N,iconPosition:"left"},hr("Remove from theme","ollie-pro")),(0,a.createElement)(d.MenuItem,{onClick:()=>{(()=>{let e=wp.data.select("core/block-editor").getSelectedBlock(),t=[];w.forEach((e=>{t.push(e[0])})),(0,Mt.dispatch)("core/block-editor").replaceBlock(e.clientId,t),v([])})()},disabled:!N,iconPosition:"left"},hr("Insert into current page","ollie-pro"))),(0,a.createElement)(d.MenuGroup,{className:"ollie-pattern-action-drop"},(0,a.createElement)(d.MenuItem,{onClick:()=>{(()=>{for(const e of g)h(e).then((t=>{let r=t.slug.replace("/","-");L(e),T([...k,r])}));v([])})()},disabled:!N,iconPosition:"left"},hr("Add to favorites","ollie-pro")),(0,a.createElement)(d.MenuItem,{onClick:()=>{(()=>{for(const e of g)h(e).then((t=>{let r=t.slug.replace("/","-");M(e),x([...C,r])}));v([])})()},disabled:!N,iconPosition:"left"},hr("Remove from favorites","ollie-pro"))),(0,a.createElement)(d.MenuGroup,{className:"ollie-pattern-action-drop"},(0,a.createElement)(d.MenuItem,{onClick:()=>{(()=>{let e=[],t=[];c.forEach((r=>{e.push(r.id),t.push((0,l.parse)(r.content))})),v(e),y(t)})()},iconPosition:"left"},hr("Select All","ollie-pro")),(0,a.createElement)(d.MenuItem,{onClick:()=>{v([]),y([])},disabled:!N,iconPosition:"left"},hr("Deselect","ollie-pro"))))))),(0,a.createElement)(d.FlexItem,null,(0,a.createElement)(d.DropdownMenu,{className:"ollie-pattern-column-drop",icon:(0,a.createElement)(ar,null),text:hr("Sort By","ollie-pro")},(()=>(0,a.createElement)(a.Fragment,null,(0,a.createElement)(d.MenuGroup,{className:"ollie-pattern-action-drop"},(0,a.createElement)(d.MenuItem,{onClick:()=>{H("ascending","title")}},hr("Ascending","ollie-pro")),(0,a.createElement)(d.MenuItem,{onClick:()=>{H("descending","title")}},hr("Descending","ollie-pro")),(0,a.createElement)(d.MenuItem,{onClick:()=>{H("descending","id")}},hr("Latest","ollie-pro"))),(0,a.createElement)(d.MenuGroup,{className:"ollie-pattern-action-drop"},(0,a.createElement)(d.MenuItem,{onClick:()=>{H("ascending","slug")}},hr("Clear sort","ollie-pro"))))))),(0,a.createElement)(d.FlexItem,null,(0,a.createElement)(d.DropdownMenu,{className:"ollie-pattern-column-drop",icon:lr,text:hr("Filter","ollie-pro")},(({onClose:e})=>(0,a.createElement)(a.Fragment,null,(0,a.createElement)(d.MenuGroup,{className:"ollie-pattern-action-drop ollie-pattern-action-drop-filter"},(0,a.createElement)(d.MenuItem,{onClick:()=>{B(!1,!0)}},hr("My Favorites","ollie-pro")),(0,a.createElement)(d.MenuItem,{onClick:()=>{B(!0,!1)}},hr("Downloaded to theme","ollie-pro"))),(0,a.createElement)(d.MenuGroup,{className:"ollie-pattern-action-drop ollie-pattern-action-drop-filter"},(0,a.createElement)(d.MenuItem,{onClick:()=>{B(!1,!1)}},hr("Clear filter","ollie-pro"))))))),(0,a.createElement)(d.FlexItem,null,(0,a.createElement)(d.DropdownMenu,{className:"ollie-pattern-column-drop",icon:n,text:hr("Grid View","ollie-pro")},(({onClose:n})=>(0,a.createElement)(a.Fragment,null,(0,a.createElement)(d.MenuGroup,{className:"ollie-pattern-action-drop"},(0,a.createElement)(d.MenuItem,{icon:(0,a.createElement)(nr,null),iconPosition:"left",onClick:t,className:2===e?"ollie-menu-active":""},hr("2 Column","ollie-pro")),(0,a.createElement)(d.MenuItem,{icon:(0,a.createElement)(ir,null),iconPosition:"left",onClick:r,className:3===e?"ollie-menu-active":""},hr("3 Column","ollie-pro")),(0,a.createElement)(d.MenuItem,{icon:(0,a.createElement)(or,null),iconPosition:"left",onClick:s,className:4===e?"ollie-menu-active":""},hr("4 Column","ollie-pro")))))))))))},{__:dr}=wp.i18n,pr=function(){const{getPatterns:e,selectedCollection:t,selectedCategory:r,filterByFavorite:s,filterByDownload:n,sortingDirection:i,sortingField:o,searchTerm:l,patterns:c,getPatternMeta:h,selectedPatterns:p,getRelatedCategories:f,getRelatedCollection:m,getCollection:g,setIsPreview:v,isPreview:w,previewPattern:y,setPreviewPattern:_}=(0,u.useContext)(It),[b,k]=(0,u.useState)((()=>{const e=localStorage.getItem("ollie-pattern-view");return null!==e?Number(e):3}));let C;switch(b){case 2:C=(0,a.createElement)(nr,null);break;case 3:default:C=(0,a.createElement)(ir,null);break;case 4:C=(0,a.createElement)(or,null)}const E=e=>{h(e.id).then((t=>{t.description&&(e.description=t.description),t.keywords&&(e.keywords=t.keywords),m(e.id).then((t=>{g(t.collection_id).then((t=>{e.collection={id:t.id,title:t.title},f(e.id).then((t=>{e.categories=t,_(e),v(!0)}))}))}))}))},S=e=>!!p.includes(e);return(0,u.useEffect)((()=>{localStorage.setItem("ollie-pattern-view",b),e()}),[b,r,t,l,o,i,n,s]),(0,a.createElement)("div",{class:"ollie-pattern-columns"},c&&(0,a.createElement)(a.Fragment,null,w?(0,a.createElement)(a.Fragment,null,(0,a.createElement)(Gt,{pattern:y}),(0,a.createElement)("div",{style:{width:"100%"}},(0,a.createElement)(Yt,{pattern:y}))):(0,a.createElement)(a.Fragment,null,(0,a.createElement)(Gt,{pattern:!1}),(0,a.createElement)("div",{style:{width:"100%"}},(0,a.createElement)("div",{id:"ollie-grid-area"},(0,a.createElement)(ur,{setTwoColumn:()=>{k(2)},setThreeColumn:()=>{k(3)},setFourColumn:()=>{k(4)},gridView:b,IconComponent:C,selectedCategory:r,selectedCollection:t}),l&&0===c.length&&(0,a.createElement)("p",null,dr("No patterns found.","ollie-pro")),(0,a.createElement)(d.__experimentalGrid,{id:"ollie-pattern-grid",className:`ollie-pattern-grid ollie-pattern-column-${b}`,columns:b,gap:8},c.map((e=>(0,a.createElement)(sr,{pattern:e,key:e.id,isPatternSelected:S,preparePreview:E,gridView:b})))))))))},fr=(0,a.createElement)(Ut.SVG,{viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},(0,a.createElement)(Ut.Path,{fillRule:"evenodd",clipRule:"evenodd",d:"M18.5 5.5V8H20V5.5H22.5V4H20V1.5H18.5V4H16V5.5H18.5ZM13.9624 4H6C4.89543 4 4 4.89543 4 6V18C4 19.1046 4.89543 20 6 20H18C19.1046 20 20 19.1046 20 18V10.0391H18.5V18C18.5 18.2761 18.2761 18.5 18 18.5H10L10 10.4917L16.4589 10.5139L16.4641 9.01389L5.5 8.97618V6C5.5 5.72386 5.72386 5.5 6 5.5H13.9624V4ZM5.5 10.4762V18C5.5 18.2761 5.72386 18.5 6 18.5H8.5L8.5 10.4865L5.5 10.4762Z"})),mr=(0,a.createElement)(Ut.SVG,{viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},(0,a.createElement)(Ut.Path,{d:"M3.99961 13C4.67043 13.3354 4.6703 13.3357 4.67017 13.3359L4.67298 13.3305C4.67621 13.3242 4.68184 13.3135 4.68988 13.2985C4.70595 13.2686 4.7316 13.2218 4.76695 13.1608C4.8377 13.0385 4.94692 12.8592 5.09541 12.6419C5.39312 12.2062 5.84436 11.624 6.45435 11.0431C7.67308 9.88241 9.49719 8.75 11.9996 8.75C14.502 8.75 16.3261 9.88241 17.5449 11.0431C18.1549 11.624 18.6061 12.2062 18.9038 12.6419C19.0523 12.8592 19.1615 13.0385 19.2323 13.1608C19.2676 13.2218 19.2933 13.2686 19.3093 13.2985C19.3174 13.3135 19.323 13.3242 19.3262 13.3305L19.3291 13.3359C19.3289 13.3357 19.3288 13.3354 19.9996 13C20.6704 12.6646 20.6703 12.6643 20.6701 12.664L20.6697 12.6632L20.6688 12.6614L20.6662 12.6563L20.6583 12.6408C20.6517 12.6282 20.6427 12.6108 20.631 12.5892C20.6078 12.5459 20.5744 12.4852 20.5306 12.4096C20.4432 12.2584 20.3141 12.0471 20.1423 11.7956C19.7994 11.2938 19.2819 10.626 18.5794 9.9569C17.1731 8.61759 14.9972 7.25 11.9996 7.25C9.00203 7.25 6.82614 8.61759 5.41987 9.9569C4.71736 10.626 4.19984 11.2938 3.85694 11.7956C3.68511 12.0471 3.55605 12.2584 3.4686 12.4096C3.42484 12.4852 3.39142 12.5459 3.36818 12.5892C3.35656 12.6108 3.34748 12.6282 3.34092 12.6408L3.33297 12.6563L3.33041 12.6614L3.32948 12.6632L3.32911 12.664C3.32894 12.6643 3.32879 12.6646 3.99961 13ZM11.9996 16C13.9326 16 15.4996 14.433 15.4996 12.5C15.4996 10.567 13.9326 9 11.9996 9C10.0666 9 8.49961 10.567 8.49961 12.5C8.49961 14.433 10.0666 16 11.9996 16Z"}));function gr({fillColor:e}){return(0,a.createElement)("svg",{className:"ollie-logo-black",width:"24",height:"20.03",viewBox:"0 0 248 207",fill:e,xmlns:"http://www.w3.org/2000/svg"},(0,a.createElement)("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M186.963 32.3614C175.252 28.5786 162.576 26.7996 148.982 26.7996C147.733 26.7996 146.494 26.8141 145.264 26.8431H88.2559C86.9334 26.8287 85.5382 26.8375 84.0822 26.8467C70.002 26.9355 50.2409 27.0602 35.6614 6.5925C19.1009 -12.1879 -20.4076 11.8225 13.046 45.0456C39.2176 67.152 46.9673 70.603 80.138 70.5416V70.5422H151.716C160.828 70.7983 168.813 72.362 175.67 75.233C183.199 78.3853 189.159 83.5341 193.551 90.6794C197.943 97.6145 200.139 106.336 200.139 116.844C200.139 132.395 195.538 144.059 186.336 151.834C177.134 159.4 164.69 163.183 149.005 163.183C133.111 163.183 120.563 159.505 111.361 152.15C102.368 144.584 97.8718 132.921 97.8718 117.159C97.8718 108.47 99.2024 101.026 101.864 94.8249C103.447 91.1351 101.007 86.2324 97.0087 86.2324H58.6548C56.5896 86.2324 54.7505 87.575 54.2096 89.5778C51.9475 97.9528 50.8165 107.041 50.8165 116.844C50.8165 131.765 53.4307 145.109 58.659 156.878C63.8874 168.437 70.998 177.894 79.9908 185.249C88.9836 192.394 99.3358 197.858 111.047 201.641C122.759 205.214 135.412 207 149.005 207C162.599 207 175.252 205.214 186.963 201.641C198.675 197.858 209.027 192.394 218.02 185.249C227.013 178.104 234.123 168.752 239.352 157.193C244.58 145.425 247.194 131.975 247.194 116.844C247.194 101.923 244.58 88.6829 239.352 77.1244C234.123 65.3558 227.013 55.8988 218.02 48.7536C209.027 41.6083 198.675 36.1442 186.963 32.3614Z",fill:e}))}const{__:vr}=wp.i18n,wr=function({openModal:e}){const{getPatterns:t,getPatternMeta:r,getRelatedCategories:s,patterns:n,searchTerm:i,setSearchTerm:o,setIsPreview:l,setPreviewPattern:c}=(0,u.useContext)(It);return(0,u.useEffect)((()=>{t()}),[i]),(0,a.createElement)(d.Placeholder,{icon:(0,a.createElement)(gr,null),instructions:vr("Browse the patterns available in Ollie pattern library and download them to your site.","ollie-pro"),label:vr("Ollie Pattern Library","ollie-pro"),className:"ollie-quick-inserter"},(0,a.createElement)(d.__experimentalVStack,{spacing:"6"},(0,a.createElement)("div",null,(0,a.createElement)(d.Button,{className:"has-text",icon:fr,iconSize:18,variant:"primary",onClick:e,text:vr("Open Ollie Pattern Library","ollie-pro")})),(0,a.createElement)("div",{className:"ollie-quick-inserter-search"},(0,a.createElement)(d.SearchControl,{label:vr("Instant Search"),hideLabelFromVision:!1,help:vr("Use the instant search to quickly find a specific pattern from the Ollie pattern library.","ollie-pro"),value:i,onChange:e=>{e.length>3?o(e.toLowerCase()):o("")}}),n&&i.length>3&&(0,a.createElement)("div",{className:"ollie-quick-insert-list"},n.map((t=>(0,a.createElement)(a.Fragment,null,(0,a.createElement)(d.Flex,{key:t.id},(0,a.createElement)(d.FlexItem,null,(0,a.createElement)("span",null,t.title)),(0,a.createElement)(d.FlexItem,null,(0,a.createElement)(d.Button,{className:"has-text",icon:mr,iconSize:"18px",variant:"link",onClick:()=>{(e=>{r(e.id).then((t=>{t.description&&(e.description=t.description),t.keywords&&(e.keywords=t.keywords),s(e.id).then((t=>{e.categories=t,c(e),l(!0)}))}))})(t),e()},text:vr("Preview")}))))))),i&&0===n.length&&(0,a.createElement)("p",null,vr("No patterns found.","ollie-pro")))))},{__:yr}=wp.i18n,_r=function(){const[e,t]=(0,u.useState)(!1);return(0,a.createElement)(a.Fragment,null,(0,a.createElement)(At,{isModalOpen:e},e?(0,a.createElement)(d.Modal,{className:"ollie-pattern-modal",title:"Ollie Pro Patterns",onRequestClose:()=>t(!1)},(0,a.createElement)("div",{className:"ollie-modal-container"},(0,a.createElement)(pr,null))):(0,a.createElement)(wr,{openModal:()=>t(!0)})))},{__:br}=wp.i18n;let kr=localStorage.getItem("ollie-pro-activated");!(0,l.getBlockType)("ollie/pattern-block")&&kr&&(0,l.registerBlockType)(c.UU,{title:"Ollie Pattern Library",icon:{src:(0,a.createElement)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},(0,a.createElement)("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M16.2078 7.11304C15.4431 6.86609 14.6154 6.74993 13.7278 6.74993C13.6463 6.74993 13.5654 6.75084 13.485 6.75274H9.76269C9.67185 6.75206 9.581 6.75214 9.49015 6.753C8.5708 6.75874 7.2805 6.76691 6.32856 5.43045C5.24721 4.2042 2.66746 5.77194 4.85185 7.9413C6.56075 9.38472 7.06672 9.61005 9.23263 9.60607H13.9063C14.5013 9.62279 15.0227 9.72491 15.4704 9.91237C15.962 10.1182 16.3512 10.4544 16.6379 10.9209C16.9247 11.3738 17.0681 11.9432 17.0681 12.6294C17.0681 13.6448 16.7677 14.4064 16.1668 14.914C15.566 15.4081 14.7535 15.6551 13.7293 15.6551C12.6915 15.6551 11.8722 15.4149 11.2713 14.9347C10.6841 14.4407 10.3905 13.679 10.3905 12.6499C10.3905 12.0826 10.4774 11.5965 10.6512 11.1916C10.7546 10.9507 10.5953 10.6306 10.3342 10.6306H7.82989C7.69506 10.6306 7.57498 10.7182 7.53966 10.849C7.39189 11.3959 7.31805 11.9893 7.31805 12.6294C7.31805 13.6036 7.48879 14.4749 7.83015 15.2434C8.17152 15.9981 8.63583 16.6156 9.22303 17.0959C9.81023 17.5624 10.4862 17.9192 11.2508 18.1662C12.0156 18.3995 12.8418 18.5161 13.7293 18.5161C14.6169 18.5161 15.4431 18.3995 16.2078 18.1662C16.9725 17.9192 17.6485 17.5624 18.2357 17.0959C18.8229 16.6293 19.2871 16.0187 19.6285 15.264C19.9699 14.4956 20.1406 13.6173 20.1406 12.6294C20.1406 11.6551 19.9699 10.7906 19.6285 10.0358C19.2871 9.26745 18.8229 8.64995 18.2357 8.18342C17.6485 7.71682 16.9725 7.36005 16.2078 7.11304Z",fill:"currentColor"}))},edit:function(){return(0,a.createElement)("div",{...(0,h.useBlockProps)()},(0,a.createElement)(_r,null))},save:function(){return null}})})();